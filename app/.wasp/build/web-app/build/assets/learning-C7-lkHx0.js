import{j as e}from"./ui-DicmwEmA.js";import{r as t,g as n,d as o,a as r}from"./vendor-BedhWeEz.js";var i,a,s;(a=i||(i={})).assertEqual=e=>{},a.assertIs=function(e){},a.assertNever=function(e){throw new Error},a.arrayToEnum=e=>{const t={};for(const n of e)t[n]=n;return t},a.getValidEnumValues=e=>{const t=a.objectKeys(e).filter(t=>"number"!=typeof e[e[t]]),n={};for(const o of t)n[o]=e[o];return a.objectValues(n)},a.objectValues=e=>a.objectKeys(e).map(function(t){return e[t]}),a.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},a.find=(e,t)=>{for(const n of e)if(t(n))return n},a.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,a.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},a.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(s||(s={})).mergeShapes=(e,t)=>({...e,...t});const l=i.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),u=e=>{switch(typeof e){case"undefined":return l.undefined;case"string":return l.string;case"number":return Number.isNaN(e)?l.nan:l.number;case"boolean":return l.boolean;case"function":return l.function;case"bigint":return l.bigint;case"symbol":return l.symbol;case"object":return Array.isArray(e)?l.array:null===e?l.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?l.promise:"undefined"!=typeof Map&&e instanceof Map?l.map:"undefined"!=typeof Set&&e instanceof Set?l.set:"undefined"!=typeof Date&&e instanceof Date?l.date:l.object;default:return l.unknown}},c=i.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class d extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},n={_errors:[]},o=e=>{for(const r of e.issues)if("invalid_union"===r.code)r.unionErrors.map(o);else if("invalid_return_type"===r.code)o(r.returnTypeError);else if("invalid_arguments"===r.code)o(r.argumentsError);else if(0===r.path.length)n._errors.push(t(r));else{let e=n,o=0;for(;o<r.path.length;){const n=r.path[o];o===r.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(r))):e[n]=e[n]||{_errors:[]},e=e[n],o++}}};return o(this),n}static assert(e){if(!(e instanceof d))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,i.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},n=[];for(const o of this.issues)if(o.path.length>0){const n=o.path[0];t[n]=t[n]||[],t[n].push(e(o))}else n.push(e(o));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}d.create=e=>new d(e);const p=(e,t)=>{let n;switch(e.code){case c.invalid_type:n=e.received===l.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case c.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,i.jsonStringifyReplacer)}`;break;case c.unrecognized_keys:n=`Unrecognized key(s) in object: ${i.joinValues(e.keys,", ")}`;break;case c.invalid_union:n="Invalid input";break;case c.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${i.joinValues(e.options)}`;break;case c.invalid_enum_value:n=`Invalid enum value. Expected ${i.joinValues(e.options)}, received '${e.received}'`;break;case c.invalid_arguments:n="Invalid function arguments";break;case c.invalid_return_type:n="Invalid function return type";break;case c.invalid_date:n="Invalid date";break;case c.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:i.assertNever(e.validation):n="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case c.too_small:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type||"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case c.too_big:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case c.custom:n="Invalid input";break;case c.invalid_intersection_types:n="Intersection results could not be merged";break;case c.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case c.not_finite:n="Number must be finite";break;default:n=t.defaultError,i.assertNever(e)}return{message:n}};let h=p;function f(e,t){const n=h,o=(e=>{const{data:t,path:n,errorMaps:o,issueData:r}=e,i=[...n,...r.path||[]],a={...r,path:i};if(void 0!==r.message)return{...r,path:i,message:r.message};let s="";const l=o.filter(e=>!!e).slice().reverse();for(const u of l)s=u(a,{data:t,defaultError:s}).message;return{...r,path:i,message:s}})({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===p?void 0:p].filter(e=>!!e)});e.common.issues.push(o)}class m{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const o of t){if("aborted"===o.status)return g;"dirty"===o.status&&e.dirty(),n.push(o.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const o of t){const e=await o.key,t=await o.value;n.push({key:e,value:t})}return m.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const o of t){const{key:t,value:r}=o;if("aborted"===t.status)return g;if("aborted"===r.status)return g;"dirty"===t.status&&e.dirty(),"dirty"===r.status&&e.dirty(),"__proto__"===t.value||void 0===r.value&&!o.alwaysSet||(n[t.value]=r.value)}return{status:e.value,value:n}}}const g=Object.freeze({status:"aborted"}),y=e=>({status:"dirty",value:e}),v=e=>({status:"valid",value:e}),b=e=>"aborted"===e.status,_=e=>"dirty"===e.status,w=e=>"valid"===e.status,x=e=>"undefined"!=typeof Promise&&e instanceof Promise;var k,S;(S=k||(k={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},S.toString=e=>"string"==typeof e?e:null==e?void 0:e.message;class E{constructor(e,t,n,o){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=o}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const C=(e,t)=>{if(w(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new d(e.common.issues);return this._error=t,this._error}}};function N(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:o,description:r}=e;if(t&&(n||o))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:r};return{errorMap:(t,r)=>{const{message:i}=e;return"invalid_enum_value"===t.code?{message:i??r.defaultError}:void 0===r.data?{message:i??o??r.defaultError}:"invalid_type"!==t.code?{message:r.defaultError}:{message:i??n??r.defaultError}},description:r}}let I=class{get description(){return this._def.description}_getType(e){return u(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:u(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new m,ctx:{common:e.parent.common,data:e.data,parsedType:u(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(x(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){const n={common:{issues:[],async:(null==t?void 0:t.async)??!1,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:u(e)},o=this._parseSync({data:e,path:n.path,parent:n});return C(n,o)}"~validate"(e){var t,n;const o={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:u(e)};if(!this["~standard"].async)try{const t=this._parseSync({data:e,path:[],parent:o});return w(t)?{value:t.value}:{issues:o.common.issues}}catch(r){(null==(n=null==(t=null==r?void 0:r.message)?void 0:t.toLowerCase())?void 0:n.includes("encountered"))&&(this["~standard"].async=!0),o.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:o}).then(e=>w(e)?{value:e.value}:{issues:o.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:u(e)},o=this._parse({data:e,path:n.path,parent:n}),r=await(x(o)?o:Promise.resolve(o));return C(n,r)}refine(e,t){const n=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,o)=>{const r=e(t),i=()=>o.addIssue({code:c.custom,...n(t)});return"undefined"!=typeof Promise&&r instanceof Promise?r.then(e=>!!e||(i(),!1)):!!r||(i(),!1)})}refinement(e,t){return this._refinement((n,o)=>!!e(n)||(o.addIssue("function"==typeof t?t(n,o):t),!1))}_refinement(e){return new Ce({schema:this,typeName:$e.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Ne.create(this,this._def)}nullable(){return Ie.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return de.create(this)}promise(){return Ee.create(this,this._def)}or(e){return fe.create([this,e],this._def)}and(e){return ge.create(this,e,this._def)}transform(e){return new Ce({...N(this._def),schema:this,typeName:$e.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new Oe({...N(this._def),innerType:this,defaultValue:t,typeName:$e.ZodDefault})}brand(){return new Te({typeName:$e.ZodBranded,type:this,...N(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new Ae({...N(this._def),innerType:this,catchValue:t,typeName:$e.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return Me.create(this,e)}readonly(){return ze.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const O=/^c[^\s-]{8,}$/i,A=/^[0-9a-z]+$/,P=/^[0-9A-HJKMNP-TV-Z]{26}$/i,T=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,M=/^[a-z0-9_-]{21}$/i,z=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,$=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,R=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let Z;const j=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,D=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,L=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,V=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,B=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,F=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,H="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",U=new RegExp(`^${H}$`);function Y(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${e.precision?"+":"?"}`}function K(e){return new RegExp(`^${Y(e)}$`)}function W(e){let t=`${H}T${Y(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function X(e,t){return!("v4"!==t&&t||!j.test(e))||!("v6"!==t&&t||!L.test(e))}function q(e,t){if(!z.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const o=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),r=JSON.parse(atob(o));return"object"==typeof r&&null!==r&&((!("typ"in r)||"JWT"===(null==r?void 0:r.typ))&&(!!r.alg&&(!t||r.alg===t)))}catch{return!1}}function G(e,t){return!("v4"!==t&&t||!D.test(e))||!("v6"!==t&&t||!V.test(e))}let J=class e extends I{_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==l.string){const t=this._getOrReturnCtx(e);return f(t,{code:c.invalid_type,expected:l.string,received:t.parsedType}),g}const t=new m;let n;for(const o of this._def.checks)if("min"===o.kind)e.data.length<o.value&&(n=this._getOrReturnCtx(e,n),f(n,{code:c.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),t.dirty());else if("max"===o.kind)e.data.length>o.value&&(n=this._getOrReturnCtx(e,n),f(n,{code:c.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),t.dirty());else if("length"===o.kind){const r=e.data.length>o.value,i=e.data.length<o.value;(r||i)&&(n=this._getOrReturnCtx(e,n),r?f(n,{code:c.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):i&&f(n,{code:c.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),t.dirty())}else if("email"===o.kind)R.test(e.data)||(n=this._getOrReturnCtx(e,n),f(n,{validation:"email",code:c.invalid_string,message:o.message}),t.dirty());else if("emoji"===o.kind)Z||(Z=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Z.test(e.data)||(n=this._getOrReturnCtx(e,n),f(n,{validation:"emoji",code:c.invalid_string,message:o.message}),t.dirty());else if("uuid"===o.kind)T.test(e.data)||(n=this._getOrReturnCtx(e,n),f(n,{validation:"uuid",code:c.invalid_string,message:o.message}),t.dirty());else if("nanoid"===o.kind)M.test(e.data)||(n=this._getOrReturnCtx(e,n),f(n,{validation:"nanoid",code:c.invalid_string,message:o.message}),t.dirty());else if("cuid"===o.kind)O.test(e.data)||(n=this._getOrReturnCtx(e,n),f(n,{validation:"cuid",code:c.invalid_string,message:o.message}),t.dirty());else if("cuid2"===o.kind)A.test(e.data)||(n=this._getOrReturnCtx(e,n),f(n,{validation:"cuid2",code:c.invalid_string,message:o.message}),t.dirty());else if("ulid"===o.kind)P.test(e.data)||(n=this._getOrReturnCtx(e,n),f(n,{validation:"ulid",code:c.invalid_string,message:o.message}),t.dirty());else if("url"===o.kind)try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),f(n,{validation:"url",code:c.invalid_string,message:o.message}),t.dirty()}else if("regex"===o.kind){o.regex.lastIndex=0;o.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),f(n,{validation:"regex",code:c.invalid_string,message:o.message}),t.dirty())}else if("trim"===o.kind)e.data=e.data.trim();else if("includes"===o.kind)e.data.includes(o.value,o.position)||(n=this._getOrReturnCtx(e,n),f(n,{code:c.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),t.dirty());else if("toLowerCase"===o.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===o.kind)e.data=e.data.toUpperCase();else if("startsWith"===o.kind)e.data.startsWith(o.value)||(n=this._getOrReturnCtx(e,n),f(n,{code:c.invalid_string,validation:{startsWith:o.value},message:o.message}),t.dirty());else if("endsWith"===o.kind)e.data.endsWith(o.value)||(n=this._getOrReturnCtx(e,n),f(n,{code:c.invalid_string,validation:{endsWith:o.value},message:o.message}),t.dirty());else if("datetime"===o.kind){W(o).test(e.data)||(n=this._getOrReturnCtx(e,n),f(n,{code:c.invalid_string,validation:"datetime",message:o.message}),t.dirty())}else if("date"===o.kind){U.test(e.data)||(n=this._getOrReturnCtx(e,n),f(n,{code:c.invalid_string,validation:"date",message:o.message}),t.dirty())}else if("time"===o.kind){K(o).test(e.data)||(n=this._getOrReturnCtx(e,n),f(n,{code:c.invalid_string,validation:"time",message:o.message}),t.dirty())}else"duration"===o.kind?$.test(e.data)||(n=this._getOrReturnCtx(e,n),f(n,{validation:"duration",code:c.invalid_string,message:o.message}),t.dirty()):"ip"===o.kind?X(e.data,o.version)||(n=this._getOrReturnCtx(e,n),f(n,{validation:"ip",code:c.invalid_string,message:o.message}),t.dirty()):"jwt"===o.kind?q(e.data,o.alg)||(n=this._getOrReturnCtx(e,n),f(n,{validation:"jwt",code:c.invalid_string,message:o.message}),t.dirty()):"cidr"===o.kind?G(e.data,o.version)||(n=this._getOrReturnCtx(e,n),f(n,{validation:"cidr",code:c.invalid_string,message:o.message}),t.dirty()):"base64"===o.kind?B.test(e.data)||(n=this._getOrReturnCtx(e,n),f(n,{validation:"base64",code:c.invalid_string,message:o.message}),t.dirty()):"base64url"===o.kind?F.test(e.data)||(n=this._getOrReturnCtx(e,n),f(n,{validation:"base64url",code:c.invalid_string,message:o.message}),t.dirty()):i.assertNever(o);return{status:t.value,value:e.data}}_regex(e,t,n){return this.refinement(t=>e.test(t),{validation:t,code:c.invalid_string,...k.errToObj(n)})}_addCheck(t){return new e({...this._def,checks:[...this._def.checks,t]})}email(e){return this._addCheck({kind:"email",...k.errToObj(e)})}url(e){return this._addCheck({kind:"url",...k.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...k.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...k.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...k.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...k.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...k.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...k.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...k.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...k.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...k.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...k.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...k.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:(null==e?void 0:e.offset)??!1,local:(null==e?void 0:e.local)??!1,...k.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...k.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...k.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...k.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...k.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...k.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...k.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...k.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...k.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...k.errToObj(t)})}nonempty(e){return this.min(1,k.errToObj(e))}trim(){return new e({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new e({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new e({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}};function Q(e,t){const n=(e.toString().split(".")[1]||"").length,o=(t.toString().split(".")[1]||"").length,r=n>o?n:o;return Number.parseInt(e.toFixed(r).replace(".",""))%Number.parseInt(t.toFixed(r).replace(".",""))/10**r}J.create=e=>new J({checks:[],typeName:$e.ZodString,coerce:(null==e?void 0:e.coerce)??!1,...N(e)});let ee=class e extends I{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==l.number){const t=this._getOrReturnCtx(e);return f(t,{code:c.invalid_type,expected:l.number,received:t.parsedType}),g}let t;const n=new m;for(const o of this._def.checks)if("int"===o.kind)i.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),f(t,{code:c.invalid_type,expected:"integer",received:"float",message:o.message}),n.dirty());else if("min"===o.kind){(o.inclusive?e.data<o.value:e.data<=o.value)&&(t=this._getOrReturnCtx(e,t),f(t,{code:c.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),n.dirty())}else if("max"===o.kind){(o.inclusive?e.data>o.value:e.data>=o.value)&&(t=this._getOrReturnCtx(e,t),f(t,{code:c.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),n.dirty())}else"multipleOf"===o.kind?0!==Q(e.data,o.value)&&(t=this._getOrReturnCtx(e,t),f(t,{code:c.not_multiple_of,multipleOf:o.value,message:o.message}),n.dirty()):"finite"===o.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),f(t,{code:c.not_finite,message:o.message}),n.dirty()):i.assertNever(o);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,k.toString(t))}gt(e,t){return this.setLimit("min",e,!1,k.toString(t))}lte(e,t){return this.setLimit("max",e,!0,k.toString(t))}lt(e,t){return this.setLimit("max",e,!1,k.toString(t))}setLimit(t,n,o,r){return new e({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:o,message:k.toString(r)}]})}_addCheck(t){return new e({...this._def,checks:[...this._def.checks,t]})}int(e){return this._addCheck({kind:"int",message:k.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:k.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:k.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:k.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:k.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:k.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:k.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:k.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:k.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&i.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===t||n.value>t)&&(t=n.value):"max"===n.kind&&(null===e||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}};ee.create=e=>new ee({checks:[],typeName:$e.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...N(e)});class te extends I{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==l.bigint)return this._getInvalidInput(e);let t;const n=new m;for(const o of this._def.checks)if("min"===o.kind){(o.inclusive?e.data<o.value:e.data<=o.value)&&(t=this._getOrReturnCtx(e,t),f(t,{code:c.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),n.dirty())}else if("max"===o.kind){(o.inclusive?e.data>o.value:e.data>=o.value)&&(t=this._getOrReturnCtx(e,t),f(t,{code:c.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),n.dirty())}else"multipleOf"===o.kind?e.data%o.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),f(t,{code:c.not_multiple_of,multipleOf:o.value,message:o.message}),n.dirty()):i.assertNever(o);return{status:n.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return f(t,{code:c.invalid_type,expected:l.bigint,received:t.parsedType}),g}gte(e,t){return this.setLimit("min",e,!0,k.toString(t))}gt(e,t){return this.setLimit("min",e,!1,k.toString(t))}lte(e,t){return this.setLimit("max",e,!0,k.toString(t))}lt(e,t){return this.setLimit("max",e,!1,k.toString(t))}setLimit(e,t,n,o){return new te({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:k.toString(o)}]})}_addCheck(e){return new te({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:k.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:k.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:k.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:k.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:k.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}te.create=e=>new te({checks:[],typeName:$e.ZodBigInt,coerce:(null==e?void 0:e.coerce)??!1,...N(e)});let ne=class extends I{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==l.boolean){const t=this._getOrReturnCtx(e);return f(t,{code:c.invalid_type,expected:l.boolean,received:t.parsedType}),g}return v(e.data)}};ne.create=e=>new ne({typeName:$e.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...N(e)});class oe extends I{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==l.date){const t=this._getOrReturnCtx(e);return f(t,{code:c.invalid_type,expected:l.date,received:t.parsedType}),g}if(Number.isNaN(e.data.getTime())){return f(this._getOrReturnCtx(e),{code:c.invalid_date}),g}const t=new m;let n;for(const o of this._def.checks)"min"===o.kind?e.data.getTime()<o.value&&(n=this._getOrReturnCtx(e,n),f(n,{code:c.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),t.dirty()):"max"===o.kind?e.data.getTime()>o.value&&(n=this._getOrReturnCtx(e,n),f(n,{code:c.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),t.dirty()):i.assertNever(o);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new oe({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:k.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:k.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}oe.create=e=>new oe({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:$e.ZodDate,...N(e)});class re extends I{_parse(e){if(this._getType(e)!==l.symbol){const t=this._getOrReturnCtx(e);return f(t,{code:c.invalid_type,expected:l.symbol,received:t.parsedType}),g}return v(e.data)}}re.create=e=>new re({typeName:$e.ZodSymbol,...N(e)});class ie extends I{_parse(e){if(this._getType(e)!==l.undefined){const t=this._getOrReturnCtx(e);return f(t,{code:c.invalid_type,expected:l.undefined,received:t.parsedType}),g}return v(e.data)}}ie.create=e=>new ie({typeName:$e.ZodUndefined,...N(e)});let ae=class extends I{_parse(e){if(this._getType(e)!==l.null){const t=this._getOrReturnCtx(e);return f(t,{code:c.invalid_type,expected:l.null,received:t.parsedType}),g}return v(e.data)}};ae.create=e=>new ae({typeName:$e.ZodNull,...N(e)});let se=class extends I{constructor(){super(...arguments),this._any=!0}_parse(e){return v(e.data)}};se.create=e=>new se({typeName:$e.ZodAny,...N(e)});let le=class extends I{constructor(){super(...arguments),this._unknown=!0}_parse(e){return v(e.data)}};le.create=e=>new le({typeName:$e.ZodUnknown,...N(e)});let ue=class extends I{_parse(e){const t=this._getOrReturnCtx(e);return f(t,{code:c.invalid_type,expected:l.never,received:t.parsedType}),g}};ue.create=e=>new ue({typeName:$e.ZodNever,...N(e)});class ce extends I{_parse(e){if(this._getType(e)!==l.undefined){const t=this._getOrReturnCtx(e);return f(t,{code:c.invalid_type,expected:l.void,received:t.parsedType}),g}return v(e.data)}}ce.create=e=>new ce({typeName:$e.ZodVoid,...N(e)});let de=class e extends I{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),o=this._def;if(t.parsedType!==l.array)return f(t,{code:c.invalid_type,expected:l.array,received:t.parsedType}),g;if(null!==o.exactLength){const e=t.data.length>o.exactLength.value,r=t.data.length<o.exactLength.value;(e||r)&&(f(t,{code:e?c.too_big:c.too_small,minimum:r?o.exactLength.value:void 0,maximum:e?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),n.dirty())}if(null!==o.minLength&&t.data.length<o.minLength.value&&(f(t,{code:c.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),n.dirty()),null!==o.maxLength&&t.data.length>o.maxLength.value&&(f(t,{code:c.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((e,n)=>o.type._parseAsync(new E(t,e,t.path,n)))).then(e=>m.mergeArray(n,e));const r=[...t.data].map((e,n)=>o.type._parseSync(new E(t,e,t.path,n)));return m.mergeArray(n,r)}get element(){return this._def.type}min(t,n){return new e({...this._def,minLength:{value:t,message:k.toString(n)}})}max(t,n){return new e({...this._def,maxLength:{value:t,message:k.toString(n)}})}length(t,n){return new e({...this._def,exactLength:{value:t,message:k.toString(n)}})}nonempty(e){return this.min(1,e)}};function pe(e){if(e instanceof he){const t={};for(const n in e.shape){const o=e.shape[n];t[n]=Ne.create(pe(o))}return new he({...e._def,shape:()=>t})}return e instanceof de?new de({...e._def,type:pe(e.element)}):e instanceof Ne?Ne.create(pe(e.unwrap())):e instanceof Ie?Ie.create(pe(e.unwrap())):e instanceof ye?ye.create(e.items.map(e=>pe(e))):e}de.create=(e,t)=>new de({type:e,minLength:null,maxLength:null,exactLength:null,typeName:$e.ZodArray,...N(t)});let he=class e extends I{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=i.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==l.object){const t=this._getOrReturnCtx(e);return f(t,{code:c.invalid_type,expected:l.object,received:t.parsedType}),g}const{status:t,ctx:n}=this._processInputParams(e),{shape:o,keys:r}=this._getCached(),i=[];if(!(this._def.catchall instanceof ue&&"strip"===this._def.unknownKeys))for(const s in n.data)r.includes(s)||i.push(s);const a=[];for(const s of r){const e=o[s],t=n.data[s];a.push({key:{status:"valid",value:s},value:e._parse(new E(n,t,n.path,s)),alwaysSet:s in n.data})}if(this._def.catchall instanceof ue){const e=this._def.unknownKeys;if("passthrough"===e)for(const t of i)a.push({key:{status:"valid",value:t},value:{status:"valid",value:n.data[t]}});else if("strict"===e)i.length>0&&(f(n,{code:c.unrecognized_keys,keys:i}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of i){const o=n.data[t];a.push({key:{status:"valid",value:t},value:e._parse(new E(n,o,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const e=[];for(const t of a){const n=await t.key,o=await t.value;e.push({key:n,value:o,alwaysSet:t.alwaysSet})}return e}).then(e=>m.mergeObjectSync(t,e)):m.mergeObjectSync(t,a)}get shape(){return this._def.shape()}strict(t){return k.errToObj,new e({...this._def,unknownKeys:"strict",...void 0!==t?{errorMap:(e,n)=>{var o,r;const i=(null==(r=(o=this._def).errorMap)?void 0:r.call(o,e,n).message)??n.defaultError;return"unrecognized_keys"===e.code?{message:k.errToObj(t).message??i}:{message:i}}}:{}})}strip(){return new e({...this._def,unknownKeys:"strip"})}passthrough(){return new e({...this._def,unknownKeys:"passthrough"})}extend(t){return new e({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new e({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:$e.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(t){return new e({...this._def,catchall:t})}pick(t){const n={};for(const e of i.objectKeys(t))t[e]&&this.shape[e]&&(n[e]=this.shape[e]);return new e({...this._def,shape:()=>n})}omit(t){const n={};for(const e of i.objectKeys(this.shape))t[e]||(n[e]=this.shape[e]);return new e({...this._def,shape:()=>n})}deepPartial(){return pe(this)}partial(t){const n={};for(const e of i.objectKeys(this.shape)){const o=this.shape[e];t&&!t[e]?n[e]=o:n[e]=o.optional()}return new e({...this._def,shape:()=>n})}required(t){const n={};for(const e of i.objectKeys(this.shape))if(t&&!t[e])n[e]=this.shape[e];else{let t=this.shape[e];for(;t instanceof Ne;)t=t._def.innerType;n[e]=t}return new e({...this._def,shape:()=>n})}keyof(){return xe(i.objectKeys(this.shape))}};he.create=(e,t)=>new he({shape:()=>e,unknownKeys:"strip",catchall:ue.create(),typeName:$e.ZodObject,...N(t)}),he.strictCreate=(e,t)=>new he({shape:()=>e,unknownKeys:"strict",catchall:ue.create(),typeName:$e.ZodObject,...N(t)}),he.lazycreate=(e,t)=>new he({shape:e,unknownKeys:"strip",catchall:ue.create(),typeName:$e.ZodObject,...N(t)});let fe=class extends I{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;if(t.common.async)return Promise.all(n.map(async e=>{const n={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}})).then(function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const o of e)if("dirty"===o.result.status)return t.common.issues.push(...o.ctx.common.issues),o.result;const n=e.map(e=>new d(e.ctx.common.issues));return f(t,{code:c.invalid_union,unionErrors:n}),g});{let e;const o=[];for(const i of n){const n={...t,common:{...t.common,issues:[]},parent:null},r=i._parseSync({data:t.data,path:t.path,parent:n});if("valid"===r.status)return r;"dirty"!==r.status||e||(e={result:r,ctx:n}),n.common.issues.length&&o.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const r=o.map(e=>new d(e));return f(t,{code:c.invalid_union,unionErrors:r}),g}}get options(){return this._def.options}};function me(e,t){const n=u(e),o=u(t);if(e===t)return{valid:!0,data:e};if(n===l.object&&o===l.object){const n=i.objectKeys(t),o=i.objectKeys(e).filter(e=>-1!==n.indexOf(e)),r={...e,...t};for(const i of o){const n=me(e[i],t[i]);if(!n.valid)return{valid:!1};r[i]=n.data}return{valid:!0,data:r}}if(n===l.array&&o===l.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let o=0;o<e.length;o++){const r=me(e[o],t[o]);if(!r.valid)return{valid:!1};n.push(r.data)}return{valid:!0,data:n}}return n===l.date&&o===l.date&&+e===+t?{valid:!0,data:e}:{valid:!1}}fe.create=(e,t)=>new fe({options:e,typeName:$e.ZodUnion,...N(t)});let ge=class extends I{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),o=(e,o)=>{if(b(e)||b(o))return g;const r=me(e.value,o.value);return r.valid?((_(e)||_(o))&&t.dirty(),{status:t.value,value:r.data}):(f(n,{code:c.invalid_intersection_types}),g)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([e,t])=>o(e,t)):o(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};ge.create=(e,t,n)=>new ge({left:e,right:t,typeName:$e.ZodIntersection,...N(n)});class ye extends I{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==l.array)return f(n,{code:c.invalid_type,expected:l.array,received:n.parsedType}),g;if(n.data.length<this._def.items.length)return f(n,{code:c.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),g;!this._def.rest&&n.data.length>this._def.items.length&&(f(n,{code:c.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const o=[...n.data].map((e,t)=>{const o=this._def.items[t]||this._def.rest;return o?o._parse(new E(n,e,n.path,t)):null}).filter(e=>!!e);return n.common.async?Promise.all(o).then(e=>m.mergeArray(t,e)):m.mergeArray(t,o)}get items(){return this._def.items}rest(e){return new ye({...this._def,rest:e})}}ye.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ye({items:e,typeName:$e.ZodTuple,rest:null,...N(t)})};class ve extends I{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==l.map)return f(n,{code:c.invalid_type,expected:l.map,received:n.parsedType}),g;const o=this._def.keyType,r=this._def.valueType,i=[...n.data.entries()].map(([e,t],i)=>({key:o._parse(new E(n,e,n.path,[i,"key"])),value:r._parse(new E(n,t,n.path,[i,"value"]))}));if(n.common.async){const e=new Map;return Promise.resolve().then(async()=>{for(const n of i){const o=await n.key,r=await n.value;if("aborted"===o.status||"aborted"===r.status)return g;"dirty"!==o.status&&"dirty"!==r.status||t.dirty(),e.set(o.value,r.value)}return{status:t.value,value:e}})}{const e=new Map;for(const n of i){const o=n.key,r=n.value;if("aborted"===o.status||"aborted"===r.status)return g;"dirty"!==o.status&&"dirty"!==r.status||t.dirty(),e.set(o.value,r.value)}return{status:t.value,value:e}}}}ve.create=(e,t,n)=>new ve({valueType:t,keyType:e,typeName:$e.ZodMap,...N(n)});class be extends I{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==l.set)return f(n,{code:c.invalid_type,expected:l.set,received:n.parsedType}),g;const o=this._def;null!==o.minSize&&n.data.size<o.minSize.value&&(f(n,{code:c.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),t.dirty()),null!==o.maxSize&&n.data.size>o.maxSize.value&&(f(n,{code:c.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),t.dirty());const r=this._def.valueType;function i(e){const n=new Set;for(const o of e){if("aborted"===o.status)return g;"dirty"===o.status&&t.dirty(),n.add(o.value)}return{status:t.value,value:n}}const a=[...n.data.values()].map((e,t)=>r._parse(new E(n,e,n.path,t)));return n.common.async?Promise.all(a).then(e=>i(e)):i(a)}min(e,t){return new be({...this._def,minSize:{value:e,message:k.toString(t)}})}max(e,t){return new be({...this._def,maxSize:{value:e,message:k.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}be.create=(e,t)=>new be({valueType:e,minSize:null,maxSize:null,typeName:$e.ZodSet,...N(t)});let _e=class extends I{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};_e.create=(e,t)=>new _e({getter:e,typeName:$e.ZodLazy,...N(t)});let we=class extends I{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return f(t,{received:t.data,code:c.invalid_literal,expected:this._def.value}),g}return{status:"valid",value:e.data}}get value(){return this._def.value}};function xe(e,t){return new ke({values:e,typeName:$e.ZodEnum,...N(t)})}we.create=(e,t)=>new we({value:e,typeName:$e.ZodLiteral,...N(t)});let ke=class e extends I{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),n=this._def.values;return f(t,{expected:i.joinValues(n),received:t.parsedType,code:c.invalid_type}),g}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return f(t,{received:t.data,code:c.invalid_enum_value,options:n}),g}return v(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(t,n=this._def){return e.create(t,{...this._def,...n})}exclude(t,n=this._def){return e.create(this.options.filter(e=>!t.includes(e)),{...this._def,...n})}};ke.create=xe;class Se extends I{_parse(e){const t=i.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==l.string&&n.parsedType!==l.number){const e=i.objectValues(t);return f(n,{expected:i.joinValues(e),received:n.parsedType,code:c.invalid_type}),g}if(this._cache||(this._cache=new Set(i.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const e=i.objectValues(t);return f(n,{received:n.data,code:c.invalid_enum_value,options:e}),g}return v(e.data)}get enum(){return this._def.values}}Se.create=(e,t)=>new Se({values:e,typeName:$e.ZodNativeEnum,...N(t)});class Ee extends I{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==l.promise&&!1===t.common.async)return f(t,{code:c.invalid_type,expected:l.promise,received:t.parsedType}),g;const n=t.parsedType===l.promise?t.data:Promise.resolve(t.data);return v(n.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Ee.create=(e,t)=>new Ee({type:e,typeName:$e.ZodPromise,...N(t)});class Ce extends I{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===$e.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),o=this._def.effect||null,r={addIssue:e=>{f(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(r.addIssue=r.addIssue.bind(r),"preprocess"===o.type){const e=o.transform(n.data,r);if(n.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return g;const o=await this._def.schema._parseAsync({data:e,path:n.path,parent:n});return"aborted"===o.status?g:"dirty"===o.status||"dirty"===t.value?y(o.value):o});{if("aborted"===t.value)return g;const o=this._def.schema._parseSync({data:e,path:n.path,parent:n});return"aborted"===o.status?g:"dirty"===o.status||"dirty"===t.value?y(o.value):o}}if("refinement"===o.type){const e=e=>{const t=o.refinement(e,r);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===n.common.async){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===o.status?g:("dirty"===o.status&&t.dirty(),e(o.value),{status:t.value,value:o.value})}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(n=>"aborted"===n.status?g:("dirty"===n.status&&t.dirty(),e(n.value).then(()=>({status:t.value,value:n.value}))))}if("transform"===o.type){if(!1===n.common.async){const e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!w(e))return g;const i=o.transform(e.value,r);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(e=>w(e)?Promise.resolve(o.transform(e.value,r)).then(e=>({status:t.value,value:e})):g)}i.assertNever(o)}}Ce.create=(e,t,n)=>new Ce({schema:e,typeName:$e.ZodEffects,effect:t,...N(n)}),Ce.createWithPreprocess=(e,t,n)=>new Ce({schema:t,effect:{type:"preprocess",transform:e},typeName:$e.ZodEffects,...N(n)});let Ne=class extends I{_parse(e){return this._getType(e)===l.undefined?v(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ne.create=(e,t)=>new Ne({innerType:e,typeName:$e.ZodOptional,...N(t)});let Ie=class extends I{_parse(e){return this._getType(e)===l.null?v(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ie.create=(e,t)=>new Ie({innerType:e,typeName:$e.ZodNullable,...N(t)});let Oe=class extends I{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===l.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Oe.create=(e,t)=>new Oe({innerType:e,typeName:$e.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...N(t)});let Ae=class extends I{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},o=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return x(o)?o.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new d(n.common.issues)},input:n.data})})):{status:"valid",value:"valid"===o.status?o.value:this._def.catchValue({get error(){return new d(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Ae.create=(e,t)=>new Ae({innerType:e,typeName:$e.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...N(t)});class Pe extends I{_parse(e){if(this._getType(e)!==l.nan){const t=this._getOrReturnCtx(e);return f(t,{code:c.invalid_type,expected:l.nan,received:t.parsedType}),g}return{status:"valid",value:e.data}}}Pe.create=e=>new Pe({typeName:$e.ZodNaN,...N(e)});class Te extends I{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class Me extends I{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async){return(async()=>{const e=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?g:"dirty"===e.status?(t.dirty(),y(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})()}{const e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?g:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(e,t){return new Me({in:e,out:t,typeName:$e.ZodPipeline})}}let ze=class extends I{_parse(e){const t=this._def.innerType._parse(e),n=e=>(w(e)&&(e.value=Object.freeze(e.value)),e);return x(t)?t.then(e=>n(e)):n(t)}unwrap(){return this._def.innerType}};var $e,Re;ze.create=(e,t)=>new ze({innerType:e,typeName:$e.ZodReadonly,...N(t)}),(Re=$e||($e={})).ZodString="ZodString",Re.ZodNumber="ZodNumber",Re.ZodNaN="ZodNaN",Re.ZodBigInt="ZodBigInt",Re.ZodBoolean="ZodBoolean",Re.ZodDate="ZodDate",Re.ZodSymbol="ZodSymbol",Re.ZodUndefined="ZodUndefined",Re.ZodNull="ZodNull",Re.ZodAny="ZodAny",Re.ZodUnknown="ZodUnknown",Re.ZodNever="ZodNever",Re.ZodVoid="ZodVoid",Re.ZodArray="ZodArray",Re.ZodObject="ZodObject",Re.ZodUnion="ZodUnion",Re.ZodDiscriminatedUnion="ZodDiscriminatedUnion",Re.ZodIntersection="ZodIntersection",Re.ZodTuple="ZodTuple",Re.ZodRecord="ZodRecord",Re.ZodMap="ZodMap",Re.ZodSet="ZodSet",Re.ZodFunction="ZodFunction",Re.ZodLazy="ZodLazy",Re.ZodLiteral="ZodLiteral",Re.ZodEnum="ZodEnum",Re.ZodEffects="ZodEffects",Re.ZodNativeEnum="ZodNativeEnum",Re.ZodOptional="ZodOptional",Re.ZodNullable="ZodNullable",Re.ZodDefault="ZodDefault",Re.ZodCatch="ZodCatch",Re.ZodPromise="ZodPromise",Re.ZodBranded="ZodBranded",Re.ZodPipeline="ZodPipeline",Re.ZodReadonly="ZodReadonly";const Ze=J.create;ue.create,de.create;const je=he.create;fe.create,ge.create,ye.create,ke.create,Ee.create,Ne.create,Ie.create;var De,Le,Ve={exports:{}},Be={};function Fe(){return Le||(Le=1,Ve.exports=function(){if(De)return Be;De=1;var e=t(),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=e.useState,r=e.useEffect,i=e.useLayoutEffect,a=e.useDebugValue;function s(e){var t=e.getSnapshot;e=e.value;try{var o=t();return!n(e,o)}catch(r){return!0}}var l="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),l=o({inst:{value:n,getSnapshot:t}}),u=l[0].inst,c=l[1];return i(function(){u.value=n,u.getSnapshot=t,s(u)&&c({inst:u})},[e,n,t]),r(function(){return s(u)&&c({inst:u}),e(function(){s(u)&&c({inst:u})})},[e]),a(n),n};return Be.useSyncExternalStore=void 0!==e.useSyncExternalStore?e.useSyncExternalStore:l,Be}()),Ve.exports}var He,Ue="vercel.ai.error",Ye=Symbol.for(Ue),Ke=class e extends Error{constructor({name:e,message:t,cause:n}){super(t),this[He]=!0,this.name=e,this.cause=n}static isInstance(t){return e.hasMarker(t,Ue)}static hasMarker(e,t){const n=Symbol.for(t);return null!=e&&"object"==typeof e&&n in e&&"boolean"==typeof e[n]&&!0===e[n]}};He=Ye;var We,Xe=Ke,qe="AI_APICallError",Ge=`vercel.ai.error.${qe}`,Je=Symbol.for(Ge),Qe=class extends Xe{constructor({message:e,url:t,requestBodyValues:n,statusCode:o,responseHeaders:r,responseBody:i,cause:a,isRetryable:s=null!=o&&(408===o||409===o||429===o||o>=500),data:l}){super({name:qe,message:e,cause:a}),this[We]=!0,this.url=t,this.requestBodyValues=n,this.statusCode=o,this.responseHeaders=r,this.responseBody=i,this.isRetryable=s,this.data=l}static isInstance(e){return Xe.hasMarker(e,Ge)}};We=Je;var et,tt="AI_EmptyResponseBodyError",nt=`vercel.ai.error.${tt}`,ot=Symbol.for(nt),rt=class extends Xe{constructor({message:e="Empty response body"}={}){super({name:tt,message:e}),this[et]=!0}static isInstance(e){return Xe.hasMarker(e,nt)}};function it(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}et=ot;var at,st="AI_InvalidArgumentError",lt=`vercel.ai.error.${st}`,ut=Symbol.for(lt),ct=class extends Xe{constructor({message:e,cause:t,argument:n}){super({name:st,message:e,cause:t}),this[at]=!0,this.argument=n}static isInstance(e){return Xe.hasMarker(e,lt)}};at=ut;var dt,pt="AI_InvalidPromptError",ht=`vercel.ai.error.${pt}`,ft=Symbol.for(ht),mt=class extends Xe{constructor({prompt:e,message:t,cause:n}){super({name:pt,message:`Invalid prompt: ${t}`,cause:n}),this[dt]=!0,this.prompt=e}static isInstance(e){return Xe.hasMarker(e,ht)}};dt=ft;var gt,yt="AI_InvalidResponseDataError",vt=`vercel.ai.error.${yt}`,bt=Symbol.for(vt),_t=class extends Xe{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:yt,message:t}),this[gt]=!0,this.data=e}static isInstance(e){return Xe.hasMarker(e,vt)}};gt=bt;var wt,xt="AI_JSONParseError",kt=`vercel.ai.error.${xt}`,St=Symbol.for(kt),Et=class extends Xe{constructor({text:e,cause:t}){super({name:xt,message:`JSON parsing failed: Text: ${e}.\nError message: ${it(t)}`,cause:t}),this[wt]=!0,this.text=e}static isInstance(e){return Xe.hasMarker(e,kt)}};wt=St;var Ct,Nt="AI_LoadAPIKeyError",It=`vercel.ai.error.${Nt}`,Ot=Symbol.for(It),At=class extends Xe{constructor({message:e}){super({name:Nt,message:e}),this[Ct]=!0}static isInstance(e){return Xe.hasMarker(e,It)}};Ct=Ot;var Pt,Tt="AI_NoSuchModelError",Mt=`vercel.ai.error.${Tt}`,zt=Symbol.for(Mt),$t=class extends Xe{constructor({errorName:e=Tt,modelId:t,modelType:n,message:o=`No such ${n}: ${t}`}){super({name:e,message:o}),this[Pt]=!0,this.modelId=t,this.modelType=n}static isInstance(e){return Xe.hasMarker(e,Mt)}};Pt=zt;var Rt,Zt="AI_TooManyEmbeddingValuesForCallError",jt=`vercel.ai.error.${Zt}`,Dt=Symbol.for(jt),Lt=class extends Xe{constructor(e){super({name:Zt,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[Rt]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return Xe.hasMarker(e,jt)}};Rt=Dt;var Vt,Bt="AI_TypeValidationError",Ft=`vercel.ai.error.${Bt}`,Ht=Symbol.for(Ft);Vt=Ht;var Ut,Yt=class e extends Xe{constructor({value:e,cause:t}){super({name:Bt,message:`Type validation failed: Value: ${JSON.stringify(e)}.\nError message: ${it(t)}`,cause:t}),this[Vt]=!0,this.value=e}static isInstance(e){return Xe.hasMarker(e,Ft)}static wrap({value:t,cause:n}){return e.isInstance(n)&&n.value===t?n:new e({value:t,cause:n})}},Kt="AI_UnsupportedFunctionalityError",Wt=`vercel.ai.error.${Kt}`,Xt=Symbol.for(Wt),qt=class extends Xe{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:Kt,message:t}),this[Ut]=!0,this.functionality=e}static isInstance(e){return Xe.hasMarker(e,Wt)}};Ut=Xt;class Gt extends Error{constructor(e,t){super(e),this.name="ParseError",this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}}function Jt(e){}function Qt(e){if("function"==typeof e)throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:t=Jt,onError:n=Jt,onRetry:o=Jt,onComment:r}=e;let i,a="",s=!0,l="",u="";function c(e){if(""===e)return l.length>0&&t({id:i,event:u||void 0,data:l.endsWith("\n")?l.slice(0,-1):l}),i=void 0,l="",void(u="");if(e.startsWith(":"))return void(r&&r(e.slice(e.startsWith(": ")?2:1)));const n=e.indexOf(":");if(-1!==n){const t=e.slice(0,n),o=" "===e[n+1]?2:1;return void d(t,e.slice(n+o),e)}d(e,"",e)}function d(e,t,r){switch(e){case"event":u=t;break;case"data":l=`${l}${t}\n`;break;case"id":i=t.includes("\0")?void 0:t;break;case"retry":/^\d+$/.test(t)?o(parseInt(t,10)):n(new Gt(`Invalid \`retry\` value: "${t}"`,{type:"invalid-retry",value:t,line:r}));break;default:n(new Gt(`Unknown field "${e.length>20?`${e.slice(0,20)}…`:e}"`,{type:"unknown-field",field:e,value:t,line:r}))}}return{feed:function(e){const t=s?e.replace(/^\xEF\xBB\xBF/,""):e,[n,o]=function(e){const t=[];let n="",o=0;for(;o<e.length;){const r=e.indexOf("\r",o),i=e.indexOf("\n",o);let a=-1;if(-1!==r&&-1!==i?a=Math.min(r,i):-1!==r?a=r:-1!==i&&(a=i),-1===a){n=e.slice(o);break}{const n=e.slice(o,a);t.push(n),o=a+1,"\r"===e[o-1]&&"\n"===e[o]&&o++}}return[t,n]}(`${a}${t}`);for(const r of n)c(r);a=o,s=!1},reset:function(e={}){a&&e.consume&&c(a),s=!0,i=void 0,l="",u="",a=""}}}class en extends TransformStream{constructor({onError:e,onRetry:t,onComment:n}={}){let o;super({start(r){o=Qt({onEvent:e=>{r.enqueue(e)},onError(t){"terminate"===e?r.error(t):"function"==typeof e&&e(t)},onRetry:t,onComment:n})},transform(e){o.feed(e)}})}}function tn(e,t,n){function o(n,o){var r;Object.defineProperty(n,"_zod",{value:n._zod??{},enumerable:!1}),(r=n._zod).traits??(r.traits=new Set),n._zod.traits.add(e),t(n,o);for(const e in a.prototype)e in n||Object.defineProperty(n,e,{value:a.prototype[e].bind(n)});n._zod.constr=a,n._zod.def=o}const r=(null==n?void 0:n.Parent)??Object;class i extends r{}function a(e){var t;const r=(null==n?void 0:n.Parent)?new i:this;o(r,e),(t=r._zod).deferred??(t.deferred=[]);for(const n of r._zod.deferred)n();return r}return Object.defineProperty(i,"name",{value:e}),Object.defineProperty(a,"init",{value:o}),Object.defineProperty(a,Symbol.hasInstance,{value:t=>{var o,r;return!!((null==n?void 0:n.Parent)&&t instanceof n.Parent)||(null==(r=null==(o=null==t?void 0:t._zod)?void 0:o.traits)?void 0:r.has(e))}}),Object.defineProperty(a,"name",{value:e}),a}class nn extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const on={};function rn(e){return on}function an(e){const t=Object.values(e).filter(e=>"number"==typeof e);return Object.entries(e).filter(([e,n])=>-1===t.indexOf(+e)).map(([e,t])=>t)}function sn(e,t){return"bigint"==typeof t?t.toString():t}function ln(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function un(e){return null==e}function cn(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function dn(e,t,n){Object.defineProperty(e,t,{get(){{const o=n();return e[t]=o,o}},set(n){Object.defineProperty(e,t,{value:n})},configurable:!0})}function pn(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function hn(e){return JSON.stringify(e)}const fn=Error.captureStackTrace?Error.captureStackTrace:(...e)=>{};function mn(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}const gn=ln(()=>{var e;if("undefined"!=typeof navigator&&(null==(e=null==navigator?void 0:navigator.userAgent)?void 0:e.includes("Cloudflare")))return!1;try{return new Function(""),!0}catch(t){return!1}});function yn(e){if(!1===mn(e))return!1;const t=e.constructor;if(void 0===t)return!0;const n=t.prototype;return!1!==mn(n)&&!1!==Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")}const vn=new Set(["string","number","symbol"]);function bn(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function _n(e,t,n){const o=new e._zod.constr(t??e._zod.def);return t&&!(null==n?void 0:n.parent)||(o._zod.parent=e),o}function wn(e){const t=e;if(!t)return{};if("string"==typeof t)return{error:()=>t};if(void 0!==(null==t?void 0:t.message)){if(void 0!==(null==t?void 0:t.error))throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,"string"==typeof t.error?{...t,error:()=>t.error}:t}const xn={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function kn(e,t=0){var n;for(let o=t;o<e.issues.length;o++)if(!0!==(null==(n=e.issues[o])?void 0:n.continue))return!0;return!1}function Sn(e,t){return t.map(t=>{var n;return(n=t).path??(n.path=[]),t.path.unshift(e),t})}function En(e){return"string"==typeof e?e:null==e?void 0:e.message}function Cn(e,t,n){var o,r,i,a,s,l;const u={...e,path:e.path??[]};if(!e.message){const c=En(null==(i=null==(r=null==(o=e.inst)?void 0:o._zod.def)?void 0:r.error)?void 0:i.call(r,e))??En(null==(a=null==t?void 0:t.error)?void 0:a.call(t,e))??En(null==(s=n.customError)?void 0:s.call(n,e))??En(null==(l=n.localeError)?void 0:l.call(n,e))??"Invalid input";u.message=c}return delete u.inst,delete u.continue,(null==t?void 0:t.reportInput)||delete u.input,u}function Nn(e){return Array.isArray(e)?"array":"string"==typeof e?"string":"unknown"}function In(...e){const[t,n,o]=e;return"string"==typeof t?{message:t,code:"custom",input:n,inst:o}:{...t}}const On=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get:()=>JSON.stringify(t,sn,2),enumerable:!0}),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},An=tn("$ZodError",On),Pn=tn("$ZodError",On,{Parent:Error});const Tn=e=>(t,n,o,r)=>{const i=o?Object.assign(o,{async:!1}):{async:!1},a=t._zod.run({value:n,issues:[]},i);if(a instanceof Promise)throw new nn;if(a.issues.length){const t=new((null==r?void 0:r.Err)??e)(a.issues.map(e=>Cn(e,i,rn())));throw fn(t,null==r?void 0:r.callee),t}return a.value},Mn=e=>async(t,n,o,r)=>{const i=o?Object.assign(o,{async:!0}):{async:!0};let a=t._zod.run({value:n,issues:[]},i);if(a instanceof Promise&&(a=await a),a.issues.length){const t=new((null==r?void 0:r.Err)??e)(a.issues.map(e=>Cn(e,i,rn())));throw fn(t,null==r?void 0:r.callee),t}return a.value},zn=e=>(t,n,o)=>{const r=o?{...o,async:!1}:{async:!1},i=t._zod.run({value:n,issues:[]},r);if(i instanceof Promise)throw new nn;return i.issues.length?{success:!1,error:new(e??An)(i.issues.map(e=>Cn(e,r,rn())))}:{success:!0,data:i.value}},$n=zn(Pn),Rn=e=>async(t,n,o)=>{const r=o?Object.assign(o,{async:!0}):{async:!0};let i=t._zod.run({value:n,issues:[]},r);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new e(i.issues.map(e=>Cn(e,r,rn())))}:{success:!0,data:i.value}},Zn=Rn(Pn),jn=/^[cC][^\s-]{8,}$/,Dn=/^[0-9a-z]+$/,Ln=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Vn=/^[0-9a-vA-V]{20}$/,Bn=/^[A-Za-z0-9]{27}$/,Fn=/^[a-zA-Z0-9_-]{21}$/,Hn=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,Un=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Yn=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,Kn=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/;const Wn=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Xn=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,qn=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Gn=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Jn=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Qn=/^[A-Za-z0-9_-]*$/,eo=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,to=/^\+(?:[0-9]){6,14}[0-9]$/,no="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",oo=new RegExp(`^${no}$`);function ro(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return"number"==typeof e.precision?-1===e.precision?`${t}`:0===e.precision?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}const io=/^\d+$/,ao=/^-?\d+(?:\.\d+)?/i,so=/true|false/i,lo=/null/i,uo=/^[^A-Z]*$/,co=/^[^a-z]*$/,po=tn("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),ho={number:"number",bigint:"bigint",object:"date"},fo=tn("$ZodCheckLessThan",(e,t)=>{po.init(e,t);const n=ho[typeof t.value];e._zod.onattach.push(e=>{const n=e._zod.bag,o=(t.inclusive?n.maximum:n.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<o&&(t.inclusive?n.maximum=t.value:n.exclusiveMaximum=t.value)}),e._zod.check=o=>{(t.inclusive?o.value<=t.value:o.value<t.value)||o.issues.push({origin:n,code:"too_big",maximum:t.value,input:o.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),mo=tn("$ZodCheckGreaterThan",(e,t)=>{po.init(e,t);const n=ho[typeof t.value];e._zod.onattach.push(e=>{const n=e._zod.bag,o=(t.inclusive?n.minimum:n.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>o&&(t.inclusive?n.minimum=t.value:n.exclusiveMinimum=t.value)}),e._zod.check=o=>{(t.inclusive?o.value>=t.value:o.value>t.value)||o.issues.push({origin:n,code:"too_small",minimum:t.value,input:o.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),go=tn("$ZodCheckMultipleOf",(e,t)=>{po.init(e,t),e._zod.onattach.push(e=>{var n;(n=e._zod.bag).multipleOf??(n.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");("bigint"==typeof n.value?n.value%t.value===BigInt(0):0===function(e,t){const n=(e.toString().split(".")[1]||"").length,o=(t.toString().split(".")[1]||"").length,r=n>o?n:o;return Number.parseInt(e.toFixed(r).replace(".",""))%Number.parseInt(t.toFixed(r).replace(".",""))/10**r}(n.value,t.value))||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),yo=tn("$ZodCheckNumberFormat",(e,t)=>{var n;po.init(e,t),t.format=t.format||"float64";const o=null==(n=t.format)?void 0:n.includes("int"),r=o?"int":"number",[i,a]=xn[t.format];e._zod.onattach.push(e=>{const n=e._zod.bag;n.format=t.format,n.minimum=i,n.maximum=a,o&&(n.pattern=io)}),e._zod.check=n=>{const s=n.value;if(o){if(!Number.isInteger(s))return void n.issues.push({expected:r,format:t.format,code:"invalid_type",input:s,inst:e});if(!Number.isSafeInteger(s))return void(s>0?n.issues.push({input:s,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort}):n.issues.push({input:s,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort}))}s<i&&n.issues.push({origin:"number",input:s,code:"too_small",minimum:i,inclusive:!0,inst:e,continue:!t.abort}),s>a&&n.issues.push({origin:"number",input:s,code:"too_big",maximum:a,inst:e})}}),vo=tn("$ZodCheckMaxLength",(e,t)=>{var n;po.init(e,t),(n=e._zod.def).when??(n.when=e=>{const t=e.value;return!un(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{const n=e._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<n&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const o=n.value;if(o.length<=t.maximum)return;const r=Nn(o);n.issues.push({origin:r,code:"too_big",maximum:t.maximum,inclusive:!0,input:o,inst:e,continue:!t.abort})}}),bo=tn("$ZodCheckMinLength",(e,t)=>{var n;po.init(e,t),(n=e._zod.def).when??(n.when=e=>{const t=e.value;return!un(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{const n=e._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>n&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const o=n.value;if(o.length>=t.minimum)return;const r=Nn(o);n.issues.push({origin:r,code:"too_small",minimum:t.minimum,inclusive:!0,input:o,inst:e,continue:!t.abort})}}),_o=tn("$ZodCheckLengthEquals",(e,t)=>{var n;po.init(e,t),(n=e._zod.def).when??(n.when=e=>{const t=e.value;return!un(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{const n=e._zod.bag;n.minimum=t.length,n.maximum=t.length,n.length=t.length}),e._zod.check=n=>{const o=n.value,r=o.length;if(r===t.length)return;const i=Nn(o),a=r>t.length;n.issues.push({origin:i,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:n.value,inst:e,continue:!t.abort})}}),wo=tn("$ZodCheckStringFormat",(e,t)=>{var n,o;po.init(e,t),e._zod.onattach.push(e=>{const n=e._zod.bag;n.format=t.format,t.pattern&&(n.patterns??(n.patterns=new Set),n.patterns.add(t.pattern))}),t.pattern?(n=e._zod).check??(n.check=n=>{t.pattern.lastIndex=0,t.pattern.test(n.value)||n.issues.push({origin:"string",code:"invalid_format",format:t.format,input:n.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(o=e._zod).check??(o.check=()=>{})}),xo=tn("$ZodCheckRegex",(e,t)=>{wo.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,t.pattern.test(n.value)||n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),ko=tn("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=uo),wo.init(e,t)}),So=tn("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=co),wo.init(e,t)}),Eo=tn("$ZodCheckIncludes",(e,t)=>{po.init(e,t);const n=bn(t.includes),o=new RegExp("number"==typeof t.position?`^.{${t.position}}${n}`:n);t.pattern=o,e._zod.onattach.push(e=>{const t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(o)}),e._zod.check=n=>{n.value.includes(t.includes,t.position)||n.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:n.value,inst:e,continue:!t.abort})}}),Co=tn("$ZodCheckStartsWith",(e,t)=>{po.init(e,t);const n=new RegExp(`^${bn(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(e=>{const t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(n)}),e._zod.check=n=>{n.value.startsWith(t.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:n.value,inst:e,continue:!t.abort})}}),No=tn("$ZodCheckEndsWith",(e,t)=>{po.init(e,t);const n=new RegExp(`.*${bn(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(e=>{const t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(n)}),e._zod.check=n=>{n.value.endsWith(t.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:n.value,inst:e,continue:!t.abort})}}),Io=tn("$ZodCheckOverwrite",(e,t)=>{po.init(e,t),e._zod.check=e=>{e.value=t.tx(e.value)}});class Oo{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if("function"==typeof e)return e(this,{execution:"sync"}),void e(this,{execution:"async"});const t=e.split("\n").filter(e=>e),n=Math.min(...t.map(e=>e.length-e.trimStart().length)),o=t.map(e=>e.slice(n)).map(e=>" ".repeat(2*this.indent)+e);for(const r of o)this.content.push(r)}compile(){return new Function(...null==this?void 0:this.args,[...((null==this?void 0:this.content)??[""]).map(e=>`  ${e}`)].join("\n"))}}const Ao={major:4,minor:0,patch:0},Po=tn("$ZodType",(e,t)=>{var n,o;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=Ao;const r=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&r.unshift(e);for(const i of r)for(const t of i._zod.onattach)t(e);if(0===r.length)(o=e._zod).deferred??(o.deferred=[]),null==(n=e._zod.deferred)||n.push(()=>{e._zod.run=e._zod.parse});else{const t=(e,t,n)=>{let o,r=kn(e);for(const i of t){if(i._zod.def.when){if(!i._zod.def.when(e))continue}else if(r)continue;const t=e.issues.length,a=i._zod.check(e);if(a instanceof Promise&&!1===(null==n?void 0:n.async))throw new nn;if(o||a instanceof Promise)o=(o??Promise.resolve()).then(async()=>{await a;e.issues.length!==t&&(r||(r=kn(e,t)))});else{if(e.issues.length===t)continue;r||(r=kn(e,t))}}return o?o.then(()=>e):e};e._zod.run=(n,o)=>{const i=e._zod.parse(n,o);if(i instanceof Promise){if(!1===o.async)throw new nn;return i.then(e=>t(e,r,o))}return t(i,r,o)}}e["~standard"]={validate:t=>{var n;try{const o=$n(e,t);return o.success?{value:o.data}:{issues:null==(n=o.error)?void 0:n.issues}}catch(o){return Zn(e,t).then(e=>{var t;return e.success?{value:e.data}:{issues:null==(t=e.error)?void 0:t.issues}})}},vendor:"zod",version:1}}),To=tn("$ZodString",(e,t)=>{var n;Po.init(e,t),e._zod.pattern=[...(null==(n=null==e?void 0:e._zod.bag)?void 0:n.patterns)??[]].pop()??(e=>{const t=e?`[\\s\\S]{${(null==e?void 0:e.minimum)??0},${(null==e?void 0:e.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)})(e._zod.bag),e._zod.parse=(n,o)=>{if(t.coerce)try{n.value=String(n.value)}catch(r){}return"string"==typeof n.value||n.issues.push({expected:"string",code:"invalid_type",input:n.value,inst:e}),n}}),Mo=tn("$ZodStringFormat",(e,t)=>{wo.init(e,t),To.init(e,t)}),zo=tn("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=Un),Mo.init(e,t)}),$o=tn("$ZodUUID",(e,t)=>{if(t.version){const e={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(void 0===e)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=Yn(e))}else t.pattern??(t.pattern=Yn());Mo.init(e,t)}),Ro=tn("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=Kn),Mo.init(e,t)}),Zo=tn("$ZodURL",(e,t)=>{Mo.init(e,t),e._zod.check=n=>{try{const o=n.value,r=new URL(o),i=r.href;return t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(r.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:eo.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(r.protocol.endsWith(":")?r.protocol.slice(0,-1):r.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort})),void(!o.endsWith("/")&&i.endsWith("/")?n.value=i.slice(0,-1):n.value=i)}catch(o){n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e,continue:!t.abort})}}}),jo=tn("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Mo.init(e,t)}),Do=tn("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=Fn),Mo.init(e,t)}),Lo=tn("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=jn),Mo.init(e,t)}),Vo=tn("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=Dn),Mo.init(e,t)}),Bo=tn("$ZodULID",(e,t)=>{t.pattern??(t.pattern=Ln),Mo.init(e,t)}),Fo=tn("$ZodXID",(e,t)=>{t.pattern??(t.pattern=Vn),Mo.init(e,t)}),Ho=tn("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=Bn),Mo.init(e,t)}),Uo=tn("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=function(e){const t=ro({precision:e.precision}),n=["Z"];e.local&&n.push(""),e.offset&&n.push("([+-]\\d{2}:\\d{2})");const o=`${t}(?:${n.join("|")})`;return new RegExp(`^${no}T(?:${o})$`)}(t)),Mo.init(e,t)}),Yo=tn("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=oo),Mo.init(e,t)}),Ko=tn("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=new RegExp(`^${ro(t)}$`)),Mo.init(e,t)}),Wo=tn("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=Hn),Mo.init(e,t)}),Xo=tn("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=Wn),Mo.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.format="ipv4"})}),qo=tn("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=Xn),Mo.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.format="ipv6"}),e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e,continue:!t.abort})}}}),Go=tn("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=qn),Mo.init(e,t)}),Jo=tn("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=Gn),Mo.init(e,t),e._zod.check=n=>{const[o,r]=n.value.split("/");try{if(!r)throw new Error;const e=Number(r);if(`${e}`!==r)throw new Error;if(e<0||e>128)throw new Error;new URL(`http://[${o}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e,continue:!t.abort})}}});function Qo(e){if(""===e)return!0;if(e.length%4!=0)return!1;try{return atob(e),!0}catch{return!1}}const er=tn("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=Jn),Mo.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.contentEncoding="base64"}),e._zod.check=n=>{Qo(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e,continue:!t.abort})}});const tr=tn("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=Qn),Mo.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.contentEncoding="base64url"}),e._zod.check=n=>{(function(e){if(!Qn.test(e))return!1;const t=e.replace(/[-_]/g,e=>"-"===e?"+":"/");return Qo(t.padEnd(4*Math.ceil(t.length/4),"="))})(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e,continue:!t.abort})}}),nr=tn("$ZodE164",(e,t)=>{t.pattern??(t.pattern=to),Mo.init(e,t)});const or=tn("$ZodJWT",(e,t)=>{Mo.init(e,t),e._zod.check=n=>{(function(e,t=null){try{const n=e.split(".");if(3!==n.length)return!1;const[o]=n;if(!o)return!1;const r=JSON.parse(atob(o));return!("typ"in r&&"JWT"!==(null==r?void 0:r.typ)||!r.alg||t&&(!("alg"in r)||r.alg!==t))}catch{return!1}})(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e,continue:!t.abort})}}),rr=tn("$ZodNumber",(e,t)=>{Po.init(e,t),e._zod.pattern=e._zod.bag.pattern??ao,e._zod.parse=(n,o)=>{if(t.coerce)try{n.value=Number(n.value)}catch(a){}const r=n.value;if("number"==typeof r&&!Number.isNaN(r)&&Number.isFinite(r))return n;const i="number"==typeof r?Number.isNaN(r)?"NaN":Number.isFinite(r)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:r,inst:e,...i?{received:i}:{}}),n}}),ir=tn("$ZodNumber",(e,t)=>{yo.init(e,t),rr.init(e,t)}),ar=tn("$ZodBoolean",(e,t)=>{Po.init(e,t),e._zod.pattern=so,e._zod.parse=(n,o)=>{if(t.coerce)try{n.value=Boolean(n.value)}catch(i){}const r=n.value;return"boolean"==typeof r||n.issues.push({expected:"boolean",code:"invalid_type",input:r,inst:e}),n}}),sr=tn("$ZodNull",(e,t)=>{Po.init(e,t),e._zod.pattern=lo,e._zod.values=new Set([null]),e._zod.parse=(t,n)=>{const o=t.value;return null===o||t.issues.push({expected:"null",code:"invalid_type",input:o,inst:e}),t}}),lr=tn("$ZodAny",(e,t)=>{Po.init(e,t),e._zod.parse=e=>e}),ur=tn("$ZodUnknown",(e,t)=>{Po.init(e,t),e._zod.parse=e=>e}),cr=tn("$ZodNever",(e,t)=>{Po.init(e,t),e._zod.parse=(t,n)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:e}),t)});function dr(e,t,n){e.issues.length&&t.issues.push(...Sn(n,e.issues)),t.value[n]=e.value}const pr=tn("$ZodArray",(e,t)=>{Po.init(e,t),e._zod.parse=(n,o)=>{const r=n.value;if(!Array.isArray(r))return n.issues.push({expected:"array",code:"invalid_type",input:r,inst:e}),n;n.value=Array(r.length);const i=[];for(let e=0;e<r.length;e++){const a=r[e],s=t.element._zod.run({value:a,issues:[]},o);s instanceof Promise?i.push(s.then(t=>dr(t,n,e))):dr(s,n,e)}return i.length?Promise.all(i).then(()=>n):n}});function hr(e,t,n){e.issues.length&&t.issues.push(...Sn(n,e.issues)),t.value[n]=e.value}function fr(e,t,n,o){e.issues.length?void 0===o[n]?t.value[n]=n in o?void 0:e.value:t.issues.push(...Sn(n,e.issues)):void 0===e.value?n in o&&(t.value[n]=void 0):t.value[n]=e.value}const mr=tn("$ZodObject",(e,t)=>{Po.init(e,t);const n=ln(()=>{const e=Object.keys(t.shape);for(const r of e)if(!(t.shape[r]instanceof Po))throw new Error(`Invalid element at key "${r}": expected a Zod schema`);const n=(o=t.shape,Object.keys(o).filter(e=>"optional"===o[e]._zod.optin&&"optional"===o[e]._zod.optout));var o;return{shape:t.shape,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(n)}});dn(e._zod,"propValues",()=>{const e=t.shape,n={};for(const t in e){const o=e[t]._zod;if(o.values){n[t]??(n[t]=new Set);for(const e of o.values)n[t].add(e)}}return n});let o;const r=mn,i=!on.jitless,a=i&&gn.value,s=t.catchall;let l;e._zod.parse=(u,c)=>{l??(l=n.value);const d=u.value;if(!r(d))return u.issues.push({expected:"object",code:"invalid_type",input:d,inst:e}),u;const p=[];if(i&&a&&!1===(null==c?void 0:c.async)&&!0!==c.jitless)o||(o=(e=>{const t=new Oo(["shape","payload","ctx"]),o=n.value,r=e=>{const t=hn(e);return`shape[${t}]._zod.run({ value: input[${t}], issues: [] }, ctx)`};t.write("const input = payload.value;");const i=Object.create(null);let a=0;for(const n of o.keys)i[n]="key_"+a++;t.write("const newResult = {}");for(const n of o.keys)if(o.optionalKeys.has(n)){const e=i[n];t.write(`const ${e} = ${r(n)};`);const o=hn(n);t.write(`\n        if (${e}.issues.length) {\n          if (input[${o}] === undefined) {\n            if (${o} in input) {\n              newResult[${o}] = undefined;\n            }\n          } else {\n            payload.issues = payload.issues.concat(\n              ${e}.issues.map((iss) => ({\n                ...iss,\n                path: iss.path ? [${o}, ...iss.path] : [${o}],\n              }))\n            );\n          }\n        } else if (${e}.value === undefined) {\n          if (${o} in input) newResult[${o}] = undefined;\n        } else {\n          newResult[${o}] = ${e}.value;\n        }\n        `)}else{const e=i[n];t.write(`const ${e} = ${r(n)};`),t.write(`\n          if (${e}.issues.length) payload.issues = payload.issues.concat(${e}.issues.map(iss => ({\n            ...iss,\n            path: iss.path ? [${hn(n)}, ...iss.path] : [${hn(n)}]\n          })));`),t.write(`newResult[${hn(n)}] = ${e}.value`)}t.write("payload.value = newResult;"),t.write("return payload;");const s=t.compile();return(t,n)=>s(e,t,n)})(t.shape)),u=o(u,c);else{u.value={};const e=l.shape;for(const t of l.keys){const n=e[t],o=n._zod.run({value:d[t],issues:[]},c),r="optional"===n._zod.optin&&"optional"===n._zod.optout;o instanceof Promise?p.push(o.then(e=>r?fr(e,u,t,d):hr(e,u,t))):r?fr(o,u,t,d):hr(o,u,t)}}if(!s)return p.length?Promise.all(p).then(()=>u):u;const h=[],f=l.keySet,m=s._zod,g=m.def.type;for(const e of Object.keys(d)){if(f.has(e))continue;if("never"===g){h.push(e);continue}const t=m.run({value:d[e],issues:[]},c);t instanceof Promise?p.push(t.then(t=>hr(t,u,e))):hr(t,u,e)}return h.length&&u.issues.push({code:"unrecognized_keys",keys:h,input:d,inst:e}),p.length?Promise.all(p).then(()=>u):u}});function gr(e,t,n,o){for(const r of e)if(0===r.issues.length)return t.value=r.value,t;return t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(e=>e.issues.map(e=>Cn(e,o,rn())))}),t}const yr=tn("$ZodUnion",(e,t)=>{Po.init(e,t),dn(e._zod,"optin",()=>t.options.some(e=>"optional"===e._zod.optin)?"optional":void 0),dn(e._zod,"optout",()=>t.options.some(e=>"optional"===e._zod.optout)?"optional":void 0),dn(e._zod,"values",()=>{if(t.options.every(e=>e._zod.values))return new Set(t.options.flatMap(e=>Array.from(e._zod.values)))}),dn(e._zod,"pattern",()=>{if(t.options.every(e=>e._zod.pattern)){const e=t.options.map(e=>e._zod.pattern);return new RegExp(`^(${e.map(e=>cn(e.source)).join("|")})$`)}}),e._zod.parse=(n,o)=>{let r=!1;const i=[];for(const e of t.options){const t=e._zod.run({value:n.value,issues:[]},o);if(t instanceof Promise)i.push(t),r=!0;else{if(0===t.issues.length)return t;i.push(t)}}return r?Promise.all(i).then(t=>gr(t,n,e,o)):gr(i,n,e,o)}}),vr=tn("$ZodDiscriminatedUnion",(e,t)=>{yr.init(e,t);const n=e._zod.parse;dn(e._zod,"propValues",()=>{const e={};for(const n of t.options){const o=n._zod.propValues;if(!o||0===Object.keys(o).length)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(n)}"`);for(const[t,n]of Object.entries(o)){e[t]||(e[t]=new Set);for(const o of n)e[t].add(o)}}return e});const o=ln(()=>{const e=t.options,n=new Map;for(const o of e){const e=o._zod.propValues[t.discriminator];if(!e||0===e.size)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(o)}"`);for(const t of e){if(n.has(t))throw new Error(`Duplicate discriminator value "${String(t)}"`);n.set(t,o)}}return n});e._zod.parse=(r,i)=>{const a=r.value;if(!mn(a))return r.issues.push({code:"invalid_type",expected:"object",input:a,inst:e}),r;const s=o.value.get(null==a?void 0:a[t.discriminator]);return s?s._zod.run(r,i):t.unionFallback?n(r,i):(r.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",input:a,path:[t.discriminator],inst:e}),r)}}),br=tn("$ZodIntersection",(e,t)=>{Po.init(e,t),e._zod.parse=(e,n)=>{const o=e.value,r=t.left._zod.run({value:o,issues:[]},n),i=t.right._zod.run({value:o,issues:[]},n);return r instanceof Promise||i instanceof Promise?Promise.all([r,i]).then(([t,n])=>wr(e,t,n)):wr(e,r,i)}});function _r(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e===+t)return{valid:!0,data:e};if(yn(e)&&yn(t)){const n=Object.keys(t),o=Object.keys(e).filter(e=>-1!==n.indexOf(e)),r={...e,...t};for(const i of o){const n=_r(e[i],t[i]);if(!n.valid)return{valid:!1,mergeErrorPath:[i,...n.mergeErrorPath]};r[i]=n.data}return{valid:!0,data:r}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let o=0;o<e.length;o++){const r=_r(e[o],t[o]);if(!r.valid)return{valid:!1,mergeErrorPath:[o,...r.mergeErrorPath]};n.push(r.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function wr(e,t,n){if(t.issues.length&&e.issues.push(...t.issues),n.issues.length&&e.issues.push(...n.issues),kn(e))return e;const o=_r(t.value,n.value);if(!o.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(o.mergeErrorPath)}`);return e.value=o.data,e}const xr=tn("$ZodRecord",(e,t)=>{Po.init(e,t),e._zod.parse=(n,o)=>{const r=n.value;if(!yn(r))return n.issues.push({expected:"record",code:"invalid_type",input:r,inst:e}),n;const i=[];if(t.keyType._zod.values){const a=t.keyType._zod.values;n.value={};for(const e of a)if("string"==typeof e||"number"==typeof e||"symbol"==typeof e){const a=t.valueType._zod.run({value:r[e],issues:[]},o);a instanceof Promise?i.push(a.then(t=>{t.issues.length&&n.issues.push(...Sn(e,t.issues)),n.value[e]=t.value})):(a.issues.length&&n.issues.push(...Sn(e,a.issues)),n.value[e]=a.value)}let s;for(const e in r)a.has(e)||(s=s??[],s.push(e));s&&s.length>0&&n.issues.push({code:"unrecognized_keys",input:r,inst:e,keys:s})}else{n.value={};for(const a of Reflect.ownKeys(r)){if("__proto__"===a)continue;const s=t.keyType._zod.run({value:a,issues:[]},o);if(s instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(s.issues.length){n.issues.push({origin:"record",code:"invalid_key",issues:s.issues.map(e=>Cn(e,o,rn())),input:a,path:[a],inst:e}),n.value[s.value]=s.value;continue}const l=t.valueType._zod.run({value:r[a],issues:[]},o);l instanceof Promise?i.push(l.then(e=>{e.issues.length&&n.issues.push(...Sn(a,e.issues)),n.value[s.value]=e.value})):(l.issues.length&&n.issues.push(...Sn(a,l.issues)),n.value[s.value]=l.value)}}return i.length?Promise.all(i).then(()=>n):n}}),kr=tn("$ZodEnum",(e,t)=>{Po.init(e,t);const n=an(t.entries);e._zod.values=new Set(n),e._zod.pattern=new RegExp(`^(${n.filter(e=>vn.has(typeof e)).map(e=>"string"==typeof e?bn(e):e.toString()).join("|")})$`),e._zod.parse=(t,o)=>{const r=t.value;return e._zod.values.has(r)||t.issues.push({code:"invalid_value",values:n,input:r,inst:e}),t}}),Sr=tn("$ZodLiteral",(e,t)=>{Po.init(e,t),e._zod.values=new Set(t.values),e._zod.pattern=new RegExp(`^(${t.values.map(e=>"string"==typeof e?bn(e):e?e.toString():String(e)).join("|")})$`),e._zod.parse=(n,o)=>{const r=n.value;return e._zod.values.has(r)||n.issues.push({code:"invalid_value",values:t.values,input:r,inst:e}),n}}),Er=tn("$ZodTransform",(e,t)=>{Po.init(e,t),e._zod.parse=(e,n)=>{const o=t.transform(e.value,e);if(n.async){return(o instanceof Promise?o:Promise.resolve(o)).then(t=>(e.value=t,e))}if(o instanceof Promise)throw new nn;return e.value=o,e}}),Cr=tn("$ZodOptional",(e,t)=>{Po.init(e,t),e._zod.optin="optional",e._zod.optout="optional",dn(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),dn(e._zod,"pattern",()=>{const e=t.innerType._zod.pattern;return e?new RegExp(`^(${cn(e.source)})?$`):void 0}),e._zod.parse=(e,n)=>"optional"===t.innerType._zod.optin?t.innerType._zod.run(e,n):void 0===e.value?e:t.innerType._zod.run(e,n)}),Nr=tn("$ZodNullable",(e,t)=>{Po.init(e,t),dn(e._zod,"optin",()=>t.innerType._zod.optin),dn(e._zod,"optout",()=>t.innerType._zod.optout),dn(e._zod,"pattern",()=>{const e=t.innerType._zod.pattern;return e?new RegExp(`^(${cn(e.source)}|null)$`):void 0}),dn(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(e,n)=>null===e.value?e:t.innerType._zod.run(e,n)}),Ir=tn("$ZodDefault",(e,t)=>{Po.init(e,t),e._zod.optin="optional",dn(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,n)=>{if(void 0===e.value)return e.value=t.defaultValue,e;const o=t.innerType._zod.run(e,n);return o instanceof Promise?o.then(e=>Or(e,t)):Or(o,t)}});function Or(e,t){return void 0===e.value&&(e.value=t.defaultValue),e}const Ar=tn("$ZodPrefault",(e,t)=>{Po.init(e,t),e._zod.optin="optional",dn(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,n)=>(void 0===e.value&&(e.value=t.defaultValue),t.innerType._zod.run(e,n))}),Pr=tn("$ZodNonOptional",(e,t)=>{Po.init(e,t),dn(e._zod,"values",()=>{const e=t.innerType._zod.values;return e?new Set([...e].filter(e=>void 0!==e)):void 0}),e._zod.parse=(n,o)=>{const r=t.innerType._zod.run(n,o);return r instanceof Promise?r.then(t=>Tr(t,e)):Tr(r,e)}});function Tr(e,t){return e.issues.length||void 0!==e.value||e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const Mr=tn("$ZodCatch",(e,t)=>{Po.init(e,t),e._zod.optin="optional",dn(e._zod,"optout",()=>t.innerType._zod.optout),dn(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,n)=>{const o=t.innerType._zod.run(e,n);return o instanceof Promise?o.then(o=>(e.value=o.value,o.issues.length&&(e.value=t.catchValue({...e,error:{issues:o.issues.map(e=>Cn(e,n,rn()))},input:e.value}),e.issues=[]),e)):(e.value=o.value,o.issues.length&&(e.value=t.catchValue({...e,error:{issues:o.issues.map(e=>Cn(e,n,rn()))},input:e.value}),e.issues=[]),e)}}),zr=tn("$ZodPipe",(e,t)=>{Po.init(e,t),dn(e._zod,"values",()=>t.in._zod.values),dn(e._zod,"optin",()=>t.in._zod.optin),dn(e._zod,"optout",()=>t.out._zod.optout),e._zod.parse=(e,n)=>{const o=t.in._zod.run(e,n);return o instanceof Promise?o.then(e=>$r(e,t,n)):$r(o,t,n)}});function $r(e,t,n){return kn(e)?e:t.out._zod.run({value:e.value,issues:e.issues},n)}const Rr=tn("$ZodReadonly",(e,t)=>{Po.init(e,t),dn(e._zod,"propValues",()=>t.innerType._zod.propValues),dn(e._zod,"values",()=>t.innerType._zod.values),dn(e._zod,"optin",()=>t.innerType._zod.optin),dn(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(e,n)=>{const o=t.innerType._zod.run(e,n);return o instanceof Promise?o.then(Zr):Zr(o)}});function Zr(e){return e.value=Object.freeze(e.value),e}const jr=tn("$ZodLazy",(e,t)=>{Po.init(e,t),dn(e._zod,"innerType",()=>t.getter()),dn(e._zod,"pattern",()=>e._zod.innerType._zod.pattern),dn(e._zod,"propValues",()=>e._zod.innerType._zod.propValues),dn(e._zod,"optin",()=>e._zod.innerType._zod.optin),dn(e._zod,"optout",()=>e._zod.innerType._zod.optout),e._zod.parse=(t,n)=>e._zod.innerType._zod.run(t,n)}),Dr=tn("$ZodCustom",(e,t)=>{po.init(e,t),Po.init(e,t),e._zod.parse=(e,t)=>e,e._zod.check=n=>{const o=n.value,r=t.fn(o);if(r instanceof Promise)return r.then(t=>Lr(t,n,o,e));Lr(r,n,o,e)}});function Lr(e,t,n,o){if(!e){const e={code:"custom",input:n,inst:o,path:[...o._zod.def.path??[]],continue:!o._zod.def.abort};o._zod.def.params&&(e.params=o._zod.def.params),t.issues.push(In(e))}}class Vr{constructor(){this._map=new Map,this._idmap=new Map}add(e,...t){const n=t[0];if(this._map.set(e,n),n&&"object"==typeof n&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){const t=this._map.get(e);return t&&"object"==typeof t&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){const t=e._zod.parent;if(t){const n={...this.get(t)??{}};return delete n.id,{...n,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}function Br(){return new Vr}const Fr=Br();function Hr(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...wn(t)})}function Ur(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...wn(t)})}function Yr(e,t){return new fo({check:"less_than",...wn(t),value:e,inclusive:!1})}function Kr(e,t){return new fo({check:"less_than",...wn(t),value:e,inclusive:!0})}function Wr(e,t){return new mo({check:"greater_than",...wn(t),value:e,inclusive:!1})}function Xr(e,t){return new mo({check:"greater_than",...wn(t),value:e,inclusive:!0})}function qr(e,t){return new go({check:"multiple_of",...wn(t),value:e})}function Gr(e,t){return new vo({check:"max_length",...wn(t),maximum:e})}function Jr(e,t){return new bo({check:"min_length",...wn(t),minimum:e})}function Qr(e,t){return new _o({check:"length_equals",...wn(t),length:e})}function ei(e){return new Io({check:"overwrite",tx:e})}class ti{constructor(e){this.counter=0,this.metadataRegistry=(null==e?void 0:e.metadata)??Fr,this.target=(null==e?void 0:e.target)??"draft-2020-12",this.unrepresentable=(null==e?void 0:e.unrepresentable)??"throw",this.override=(null==e?void 0:e.override)??(()=>{}),this.io=(null==e?void 0:e.io)??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var n,o,r,i;const a=e._zod.def,s={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},l=this.seen.get(e);if(l){l.count++;return t.schemaPath.includes(e)&&(l.cycle=t.path),l.schema}const u={schema:{},count:1,cycle:void 0,path:t.path};this.seen.set(e,u);const c=null==(o=(n=e._zod).toJSONSchema)?void 0:o.call(n);if(c)u.schema=c;else{const n={...t,schemaPath:[...t.schemaPath,e],path:t.path},o=e._zod.parent;if(o)u.ref=o,this.process(o,n),this.seen.get(o).isParent=!0;else{const t=u.schema;switch(a.type){case"string":{const n=t;n.type="string";const{minimum:o,maximum:r,format:i,patterns:a,contentEncoding:l}=e._zod.bag;if("number"==typeof o&&(n.minLength=o),"number"==typeof r&&(n.maxLength=r),i&&(n.format=s[i]??i,""===n.format&&delete n.format),l&&(n.contentEncoding=l),a&&a.size>0){const e=[...a];1===e.length?n.pattern=e[0].source:e.length>1&&(u.schema.allOf=[...e.map(e=>({..."draft-7"===this.target?{type:"string"}:{},pattern:e.source}))])}break}case"number":{const n=t,{minimum:o,maximum:r,format:i,multipleOf:a,exclusiveMaximum:s,exclusiveMinimum:l}=e._zod.bag;"string"==typeof i&&i.includes("int")?n.type="integer":n.type="number","number"==typeof l&&(n.exclusiveMinimum=l),"number"==typeof o&&(n.minimum=o,"number"==typeof l&&(l>=o?delete n.minimum:delete n.exclusiveMinimum)),"number"==typeof s&&(n.exclusiveMaximum=s),"number"==typeof r&&(n.maximum=r,"number"==typeof s&&(s<=r?delete n.maximum:delete n.exclusiveMaximum)),"number"==typeof a&&(n.multipleOf=a);break}case"boolean":t.type="boolean";break;case"bigint":if("throw"===this.unrepresentable)throw new Error("BigInt cannot be represented in JSON Schema");break;case"symbol":if("throw"===this.unrepresentable)throw new Error("Symbols cannot be represented in JSON Schema");break;case"null":t.type="null";break;case"any":case"unknown":break;case"undefined":if("throw"===this.unrepresentable)throw new Error("Undefined cannot be represented in JSON Schema");break;case"void":if("throw"===this.unrepresentable)throw new Error("Void cannot be represented in JSON Schema");break;case"never":t.not={};break;case"date":if("throw"===this.unrepresentable)throw new Error("Date cannot be represented in JSON Schema");break;case"array":{const o=t,{minimum:r,maximum:i}=e._zod.bag;"number"==typeof r&&(o.minItems=r),"number"==typeof i&&(o.maxItems=i),o.type="array",o.items=this.process(a.element,{...n,path:[...n.path,"items"]});break}case"object":{const e=t;e.type="object",e.properties={};const o=a.shape;for(const t in o)e.properties[t]=this.process(o[t],{...n,path:[...n.path,"properties",t]});const i=new Set(Object.keys(o)),s=new Set([...i].filter(e=>{const t=a.shape[e]._zod;return"input"===this.io?void 0===t.optin:void 0===t.optout}));s.size>0&&(e.required=Array.from(s)),"never"===(null==(r=a.catchall)?void 0:r._zod.def.type)?e.additionalProperties=!1:a.catchall?a.catchall&&(e.additionalProperties=this.process(a.catchall,{...n,path:[...n.path,"additionalProperties"]})):"output"===this.io&&(e.additionalProperties=!1);break}case"union":t.anyOf=a.options.map((e,t)=>this.process(e,{...n,path:[...n.path,"anyOf",t]}));break;case"intersection":{const e=t,o=this.process(a.left,{...n,path:[...n.path,"allOf",0]}),r=this.process(a.right,{...n,path:[...n.path,"allOf",1]}),i=e=>"allOf"in e&&1===Object.keys(e).length,s=[...i(o)?o.allOf:[o],...i(r)?r.allOf:[r]];e.allOf=s;break}case"tuple":{const o=t;o.type="array";const r=a.items.map((e,t)=>this.process(e,{...n,path:[...n.path,"prefixItems",t]}));if("draft-2020-12"===this.target?o.prefixItems=r:o.items=r,a.rest){const e=this.process(a.rest,{...n,path:[...n.path,"items"]});"draft-2020-12"===this.target?o.items=e:o.additionalItems=e}a.rest&&(o.items=this.process(a.rest,{...n,path:[...n.path,"items"]}));const{minimum:i,maximum:s}=e._zod.bag;"number"==typeof i&&(o.minItems=i),"number"==typeof s&&(o.maxItems=s);break}case"record":{const e=t;e.type="object",e.propertyNames=this.process(a.keyType,{...n,path:[...n.path,"propertyNames"]}),e.additionalProperties=this.process(a.valueType,{...n,path:[...n.path,"additionalProperties"]});break}case"map":if("throw"===this.unrepresentable)throw new Error("Map cannot be represented in JSON Schema");break;case"set":if("throw"===this.unrepresentable)throw new Error("Set cannot be represented in JSON Schema");break;case"enum":{const e=t,n=an(a.entries);n.every(e=>"number"==typeof e)&&(e.type="number"),n.every(e=>"string"==typeof e)&&(e.type="string"),e.enum=n;break}case"literal":{const e=t,n=[];for(const t of a.values)if(void 0===t){if("throw"===this.unrepresentable)throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if("bigint"==typeof t){if("throw"===this.unrepresentable)throw new Error("BigInt literals cannot be represented in JSON Schema");n.push(Number(t))}else n.push(t);if(0===n.length);else if(1===n.length){const t=n[0];e.type=null===t?"null":typeof t,e.const=t}else n.every(e=>"number"==typeof e)&&(e.type="number"),n.every(e=>"string"==typeof e)&&(e.type="string"),n.every(e=>"boolean"==typeof e)&&(e.type="string"),n.every(e=>null===e)&&(e.type="null"),e.enum=n;break}case"file":{const n=t,o={type:"string",format:"binary",contentEncoding:"binary"},{minimum:r,maximum:i,mime:a}=e._zod.bag;void 0!==r&&(o.minLength=r),void 0!==i&&(o.maxLength=i),a?1===a.length?(o.contentMediaType=a[0],Object.assign(n,o)):n.anyOf=a.map(e=>({...o,contentMediaType:e})):Object.assign(n,o);break}case"transform":if("throw"===this.unrepresentable)throw new Error("Transforms cannot be represented in JSON Schema");break;case"nullable":{const e=this.process(a.innerType,n);t.anyOf=[e,{type:"null"}];break}case"nonoptional":case"promise":case"optional":this.process(a.innerType,n),u.ref=a.innerType;break;case"success":t.type="boolean";break;case"default":this.process(a.innerType,n),u.ref=a.innerType,t.default=JSON.parse(JSON.stringify(a.defaultValue));break;case"prefault":this.process(a.innerType,n),u.ref=a.innerType,"input"===this.io&&(t._prefault=JSON.parse(JSON.stringify(a.defaultValue)));break;case"catch":{let e;this.process(a.innerType,n),u.ref=a.innerType;try{e=a.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}t.default=e;break}case"nan":if("throw"===this.unrepresentable)throw new Error("NaN cannot be represented in JSON Schema");break;case"template_literal":{const n=t,o=e._zod.pattern;if(!o)throw new Error("Pattern not found in template literal");n.type="string",n.pattern=o.source;break}case"pipe":{const e="input"===this.io?"transform"===a.in._zod.def.type?a.out:a.in:a.out;this.process(e,n),u.ref=e;break}case"readonly":this.process(a.innerType,n),u.ref=a.innerType,t.readOnly=!0;break;case"lazy":{const t=e._zod.innerType;this.process(t,n),u.ref=t;break}case"custom":if("throw"===this.unrepresentable)throw new Error("Custom types cannot be represented in JSON Schema")}}}const d=this.metadataRegistry.get(e);d&&Object.assign(u.schema,d),"input"===this.io&&ni(e)&&(delete u.schema.examples,delete u.schema.default),"input"===this.io&&u.schema._prefault&&((i=u.schema).default??(i.default=u.schema._prefault)),delete u.schema._prefault;return this.seen.get(e).schema}emit(e,t){var n,o,r,i,a,s;const l={cycles:(null==t?void 0:t.cycles)??"ref",reused:(null==t?void 0:t.reused)??"inline",external:(null==t?void 0:t.external)??void 0},u=this.seen.get(e);if(!u)throw new Error("Unprocessed schema. This is a bug in Zod.");const c=e=>{var t;const n="draft-2020-12"===this.target?"$defs":"definitions";if(l.external){const o=null==(t=l.external.registry.get(e[0]))?void 0:t.id,r=l.external.uri??(e=>e);if(o)return{ref:r(o)};const i=e[1].defId??e[1].schema.id??"schema"+this.counter++;return e[1].defId=i,{defId:i,ref:`${r("__shared")}#/${n}/${i}`}}if(e[1]===u)return{ref:"#"};const o=`#/${n}/`,r=e[1].schema.id??"__schema"+this.counter++;return{defId:r,ref:o+r}},d=e=>{if(e[1].schema.$ref)return;const t=e[1],{ref:n,defId:o}=c(e);t.def={...t.schema},o&&(t.defId=o);const r=t.schema;for(const i in r)delete r[i];r.$ref=n};if("throw"===l.cycles)for(const g of this.seen.entries()){const e=g[1];if(e.cycle)throw new Error(`Cycle detected: #/${null==(n=e.cycle)?void 0:n.join("/")}/<root>\n\nSet the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const g of this.seen.entries()){const t=g[1];if(e===g[0]){d(g);continue}if(l.external){const t=null==(o=l.external.registry.get(g[0]))?void 0:o.id;if(e!==g[0]&&t){d(g);continue}}(null==(r=this.metadataRegistry.get(g[0]))?void 0:r.id)?d(g):(t.cycle||t.count>1&&"ref"===l.reused)&&d(g)}const p=(e,t)=>{const n=this.seen.get(e),o=n.def??n.schema,r={...o};if(null===n.ref)return;const i=n.ref;if(n.ref=null,i){p(i,t);const e=this.seen.get(i).schema;e.$ref&&"draft-7"===t.target?(o.allOf=o.allOf??[],o.allOf.push(e)):(Object.assign(o,e),Object.assign(o,r))}n.isParent||this.override({zodSchema:e,jsonSchema:o,path:n.path??[]})};for(const g of[...this.seen.entries()].reverse())p(g[0],{target:this.target});const h={};if("draft-2020-12"===this.target?h.$schema="https://json-schema.org/draft/2020-12/schema":"draft-7"===this.target&&(h.$schema="http://json-schema.org/draft-07/schema#"),null==(i=l.external)?void 0:i.uri){const t=null==(a=l.external.registry.get(e))?void 0:a.id;if(!t)throw new Error("Schema is missing an `id` property");h.$id=l.external.uri(t)}Object.assign(h,u.def);const f=(null==(s=l.external)?void 0:s.defs)??{};for(const g of this.seen.entries()){const e=g[1];e.def&&e.defId&&(f[e.defId]=e.def)}l.external||Object.keys(f).length>0&&("draft-2020-12"===this.target?h.$defs=f:h.definitions=f);try{return JSON.parse(JSON.stringify(h))}catch(m){throw new Error("Error converting schema to JSON.")}}}function ni(e,t){const n=t??{seen:new Set};if(n.seen.has(e))return!1;n.seen.add(e);const o=e._zod.def;switch(o.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":case"custom":case"success":case"catch":return!1;case"array":return ni(o.element,n);case"object":for(const e in o.shape)if(ni(o.shape[e],n))return!0;return!1;case"union":for(const e of o.options)if(ni(e,n))return!0;return!1;case"intersection":return ni(o.left,n)||ni(o.right,n);case"tuple":for(const e of o.items)if(ni(e,n))return!0;return!(!o.rest||!ni(o.rest,n));case"record":case"map":return ni(o.keyType,n)||ni(o.valueType,n);case"set":return ni(o.valueType,n);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":case"default":case"prefault":return ni(o.innerType,n);case"lazy":return ni(o.getter(),n);case"transform":return!0;case"pipe":return ni(o.in,n)||ni(o.out,n)}throw new Error(`Unknown schema type: ${o.type}`)}const oi=tn("ZodISODateTime",(e,t)=>{Uo.init(e,t),_i.init(e,t)});function ri(e){return function(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...wn(t)})}(oi,e)}const ii=tn("ZodISODate",(e,t)=>{Yo.init(e,t),_i.init(e,t)});function ai(e){return function(e,t){return new e({type:"string",format:"date",check:"string_format",...wn(t)})}(ii,e)}const si=tn("ZodISOTime",(e,t)=>{Ko.init(e,t),_i.init(e,t)});function li(e){return function(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...wn(t)})}(si,e)}const ui=tn("ZodISODuration",(e,t)=>{Wo.init(e,t),_i.init(e,t)});function ci(e){return function(e,t){return new e({type:"string",format:"duration",check:"string_format",...wn(t)})}(ui,e)}const di=tn("ZodError",(e,t)=>{An.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:t=>function(e,t){const n=t||function(e){return e.message},o={_errors:[]},r=e=>{for(const t of e.issues)if("invalid_union"===t.code&&t.errors.length)t.errors.map(e=>r({issues:e}));else if("invalid_key"===t.code)r({issues:t.issues});else if("invalid_element"===t.code)r({issues:t.issues});else if(0===t.path.length)o._errors.push(n(t));else{let e=o,r=0;for(;r<t.path.length;){const o=t.path[r];r===t.path.length-1?(e[o]=e[o]||{_errors:[]},e[o]._errors.push(n(t))):e[o]=e[o]||{_errors:[]},e=e[o],r++}}};return r(e),o}(e,t)},flatten:{value:t=>function(e,t=e=>e.message){const n={},o=[];for(const r of e.issues)r.path.length>0?(n[r.path[0]]=n[r.path[0]]||[],n[r.path[0]].push(t(r))):o.push(t(r));return{formErrors:o,fieldErrors:n}}(e,t)},addIssue:{value:t=>e.issues.push(t)},addIssues:{value:t=>e.issues.push(...t)},isEmpty:{get:()=>0===e.issues.length}})},{Parent:Error}),pi=Tn(di),hi=Mn(di),fi=zn(di),mi=Rn(di),gi=tn("ZodType",(e,t)=>(Po.init(e,t),e.def=t,Object.defineProperty(e,"_def",{value:t}),e.check=(...n)=>e.clone({...t,checks:[...t.checks??[],...n.map(e=>"function"==typeof e?{_zod:{check:e,def:{check:"custom"},onattach:[]}}:e)]}),e.clone=(t,n)=>_n(e,t,n),e.brand=()=>e,e.register=(t,n)=>(t.add(e,n),e),e.parse=(t,n)=>pi(e,t,n,{callee:e.parse}),e.safeParse=(t,n)=>fi(e,t,n),e.parseAsync=async(t,n)=>hi(e,t,n,{callee:e.parseAsync}),e.safeParseAsync=async(t,n)=>mi(e,t,n),e.spa=e.safeParseAsync,e.refine=(t,n)=>e.check(function(e,t={}){return function(e,t,n){return new e({type:"custom",check:"custom",fn:t,...wn(n)})}(Ta,e,t)}(t,n)),e.superRefine=t=>e.check(function(e){const t=function(e){const t=new po({check:"custom"});return t._zod.check=e,t}(n=>(n.addIssue=e=>{if("string"==typeof e)n.issues.push(In(e,n.value,t._zod.def));else{const o=e;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=n.value),o.inst??(o.inst=t),o.continue??(o.continue=!t._zod.def.abort),n.issues.push(In(o))}},e(n.value,n)));return t}(t)),e.overwrite=t=>e.check(ei(t)),e.optional=()=>_a(e),e.nullable=()=>xa(e),e.nullish=()=>_a(xa(e)),e.nonoptional=t=>function(e,t){return new Ea({type:"nonoptional",innerType:e,...wn(t)})}(e,t),e.array=()=>na(e),e.or=t=>la([e,t]),e.and=t=>new da({type:"intersection",left:e,right:t}),e.transform=t=>Ia(e,new va({type:"transform",transform:t})),e.default=t=>{return n=t,new ka({type:"default",innerType:e,get defaultValue(){return"function"==typeof n?n():n}});var n},e.prefault=t=>{return n=t,new Sa({type:"prefault",innerType:e,get defaultValue(){return"function"==typeof n?n():n}});var n},e.catch=t=>{return new Ca({type:"catch",innerType:e,catchValue:"function"==typeof(n=t)?n:()=>n});var n},e.pipe=t=>Ia(e,t),e.readonly=()=>new Oa({type:"readonly",innerType:e}),e.describe=t=>{const n=e.clone();return Fr.add(n,{description:t}),n},Object.defineProperty(e,"description",{get(){var t;return null==(t=Fr.get(e))?void 0:t.description},configurable:!0}),e.meta=(...t)=>{if(0===t.length)return Fr.get(e);const n=e.clone();return Fr.add(n,t[0]),n},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),yi=tn("_ZodString",(e,t)=>{To.init(e,t),gi.init(e,t);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...t)=>e.check(function(e,t){return new xo({check:"string_format",format:"regex",...wn(t),pattern:e})}(...t)),e.includes=(...t)=>e.check(function(e,t){return new Eo({check:"string_format",format:"includes",...wn(t),includes:e})}(...t)),e.startsWith=(...t)=>e.check(function(e,t){return new Co({check:"string_format",format:"starts_with",...wn(t),prefix:e})}(...t)),e.endsWith=(...t)=>e.check(function(e,t){return new No({check:"string_format",format:"ends_with",...wn(t),suffix:e})}(...t)),e.min=(...t)=>e.check(Jr(...t)),e.max=(...t)=>e.check(Gr(...t)),e.length=(...t)=>e.check(Qr(...t)),e.nonempty=(...t)=>e.check(Jr(1,...t)),e.lowercase=t=>e.check(function(e){return new ko({check:"string_format",format:"lowercase",...wn(e)})}(t)),e.uppercase=t=>e.check(function(e){return new So({check:"string_format",format:"uppercase",...wn(e)})}(t)),e.trim=()=>e.check(ei(e=>e.trim())),e.normalize=(...t)=>e.check(function(e){return ei(t=>t.normalize(e))}(...t)),e.toLowerCase=()=>e.check(ei(e=>e.toLowerCase())),e.toUpperCase=()=>e.check(ei(e=>e.toUpperCase()))}),vi=tn("ZodString",(e,t)=>{To.init(e,t),yi.init(e,t),e.email=t=>e.check(function(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...wn(t)})}(wi,t)),e.url=t=>e.check(function(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...wn(t)})}(Si,t)),e.jwt=t=>e.check(function(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...wn(t)})}(Li,t)),e.emoji=t=>e.check(function(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...wn(t)})}(Ei,t)),e.guid=t=>e.check(Hr(xi,t)),e.uuid=t=>e.check(function(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...wn(t)})}(ki,t)),e.uuidv4=t=>e.check(function(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...wn(t)})}(ki,t)),e.uuidv6=t=>e.check(function(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...wn(t)})}(ki,t)),e.uuidv7=t=>e.check(function(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...wn(t)})}(ki,t)),e.nanoid=t=>e.check(function(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...wn(t)})}(Ci,t)),e.guid=t=>e.check(Hr(xi,t)),e.cuid=t=>e.check(function(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...wn(t)})}(Ni,t)),e.cuid2=t=>e.check(function(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...wn(t)})}(Ii,t)),e.ulid=t=>e.check(function(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...wn(t)})}(Oi,t)),e.base64=t=>e.check(Ur(Ri,t)),e.base64url=t=>e.check(function(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...wn(t)})}(ji,t)),e.xid=t=>e.check(function(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...wn(t)})}(Ai,t)),e.ksuid=t=>e.check(function(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...wn(t)})}(Pi,t)),e.ipv4=t=>e.check(function(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...wn(t)})}(Ti,t)),e.ipv6=t=>e.check(function(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...wn(t)})}(Mi,t)),e.cidrv4=t=>e.check(function(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...wn(t)})}(zi,t)),e.cidrv6=t=>e.check(function(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...wn(t)})}($i,t)),e.e164=t=>e.check(function(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...wn(t)})}(Di,t)),e.datetime=t=>e.check(ri(t)),e.date=t=>e.check(ai(t)),e.time=t=>e.check(li(t)),e.duration=t=>e.check(ci(t))});function bi(e){return function(e,t){return new e({type:"string",...wn(t)})}(vi,e)}const _i=tn("ZodStringFormat",(e,t)=>{Mo.init(e,t),yi.init(e,t)}),wi=tn("ZodEmail",(e,t)=>{Ro.init(e,t),_i.init(e,t)}),xi=tn("ZodGUID",(e,t)=>{zo.init(e,t),_i.init(e,t)}),ki=tn("ZodUUID",(e,t)=>{$o.init(e,t),_i.init(e,t)}),Si=tn("ZodURL",(e,t)=>{Zo.init(e,t),_i.init(e,t)}),Ei=tn("ZodEmoji",(e,t)=>{jo.init(e,t),_i.init(e,t)}),Ci=tn("ZodNanoID",(e,t)=>{Do.init(e,t),_i.init(e,t)}),Ni=tn("ZodCUID",(e,t)=>{Lo.init(e,t),_i.init(e,t)}),Ii=tn("ZodCUID2",(e,t)=>{Vo.init(e,t),_i.init(e,t)}),Oi=tn("ZodULID",(e,t)=>{Bo.init(e,t),_i.init(e,t)}),Ai=tn("ZodXID",(e,t)=>{Fo.init(e,t),_i.init(e,t)}),Pi=tn("ZodKSUID",(e,t)=>{Ho.init(e,t),_i.init(e,t)}),Ti=tn("ZodIPv4",(e,t)=>{Xo.init(e,t),_i.init(e,t)}),Mi=tn("ZodIPv6",(e,t)=>{qo.init(e,t),_i.init(e,t)}),zi=tn("ZodCIDRv4",(e,t)=>{Go.init(e,t),_i.init(e,t)}),$i=tn("ZodCIDRv6",(e,t)=>{Jo.init(e,t),_i.init(e,t)}),Ri=tn("ZodBase64",(e,t)=>{er.init(e,t),_i.init(e,t)});function Zi(e){return Ur(Ri,e)}const ji=tn("ZodBase64URL",(e,t)=>{tr.init(e,t),_i.init(e,t)}),Di=tn("ZodE164",(e,t)=>{nr.init(e,t),_i.init(e,t)}),Li=tn("ZodJWT",(e,t)=>{or.init(e,t),_i.init(e,t)}),Vi=tn("ZodNumber",(e,t)=>{rr.init(e,t),gi.init(e,t),e.gt=(t,n)=>e.check(Wr(t,n)),e.gte=(t,n)=>e.check(Xr(t,n)),e.min=(t,n)=>e.check(Xr(t,n)),e.lt=(t,n)=>e.check(Yr(t,n)),e.lte=(t,n)=>e.check(Kr(t,n)),e.max=(t,n)=>e.check(Kr(t,n)),e.int=t=>e.check(Hi(t)),e.safe=t=>e.check(Hi(t)),e.positive=t=>e.check(Wr(0,t)),e.nonnegative=t=>e.check(Xr(0,t)),e.negative=t=>e.check(Yr(0,t)),e.nonpositive=t=>e.check(Kr(0,t)),e.multipleOf=(t,n)=>e.check(qr(t,n)),e.step=(t,n)=>e.check(qr(t,n)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function Bi(e){return function(e,t){return new e({type:"number",checks:[],...wn(t)})}(Vi,e)}const Fi=tn("ZodNumberFormat",(e,t)=>{ir.init(e,t),Vi.init(e,t)});function Hi(e){return function(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...wn(t)})}(Fi,e)}const Ui=tn("ZodBoolean",(e,t)=>{ar.init(e,t),gi.init(e,t)});function Yi(e){return function(e,t){return new e({type:"boolean",...wn(t)})}(Ui,e)}const Ki=tn("ZodNull",(e,t)=>{sr.init(e,t),gi.init(e,t)});function Wi(e){return function(e,t){return new e({type:"null",...wn(t)})}(Ki,e)}const Xi=tn("ZodAny",(e,t)=>{lr.init(e,t),gi.init(e,t)});function qi(){return new Xi({type:"any"})}const Gi=tn("ZodUnknown",(e,t)=>{ur.init(e,t),gi.init(e,t)});function Ji(){return new Gi({type:"unknown"})}const Qi=tn("ZodNever",(e,t)=>{cr.init(e,t),gi.init(e,t)});function ea(e){return function(e,t){return new e({type:"never",...wn(t)})}(Qi,e)}const ta=tn("ZodArray",(e,t)=>{pr.init(e,t),gi.init(e,t),e.element=t.element,e.min=(t,n)=>e.check(Jr(t,n)),e.nonempty=t=>e.check(Jr(1,t)),e.max=(t,n)=>e.check(Gr(t,n)),e.length=(t,n)=>e.check(Qr(t,n)),e.unwrap=()=>e.element});function na(e,t){return function(e,t,n){return new e({type:"array",element:t,...wn(n)})}(ta,e,t)}const oa=tn("ZodObject",(e,t)=>{mr.init(e,t),gi.init(e,t),dn(e,"shape",()=>t.shape),e.keyof=()=>ma(Object.keys(e._zod.def.shape)),e.catchall=t=>e.clone({...e._zod.def,catchall:t}),e.passthrough=()=>e.clone({...e._zod.def,catchall:Ji()}),e.loose=()=>e.clone({...e._zod.def,catchall:Ji()}),e.strict=()=>e.clone({...e._zod.def,catchall:ea()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=t=>function(e,t){if(!yn(t))throw new Error("Invalid input to extend: expected a plain object");const n={...e._zod.def,get shape(){const n={...e._zod.def.shape,...t};return pn(this,"shape",n),n},checks:[]};return _n(e,n)}(e,t),e.merge=t=>{return o=t,_n(n=e,{...n._zod.def,get shape(){const e={...n._zod.def.shape,...o._zod.def.shape};return pn(this,"shape",e),e},catchall:o._zod.def.catchall,checks:[]});var n,o},e.pick=t=>function(e,t){const n={},o=e._zod.def;for(const r in t){if(!(r in o.shape))throw new Error(`Unrecognized key: "${r}"`);t[r]&&(n[r]=o.shape[r])}return _n(e,{...e._zod.def,shape:n,checks:[]})}(e,t),e.omit=t=>function(e,t){const n={...e._zod.def.shape},o=e._zod.def;for(const r in t){if(!(r in o.shape))throw new Error(`Unrecognized key: "${r}"`);t[r]&&delete n[r]}return _n(e,{...e._zod.def,shape:n,checks:[]})}(e,t),e.partial=(...t)=>function(e,t,n){const o=t._zod.def.shape,r={...o};if(n)for(const i in n){if(!(i in o))throw new Error(`Unrecognized key: "${i}"`);n[i]&&(r[i]=e?new e({type:"optional",innerType:o[i]}):o[i])}else for(const i in o)r[i]=e?new e({type:"optional",innerType:o[i]}):o[i];return _n(t,{...t._zod.def,shape:r,checks:[]})}(ba,e,t[0]),e.required=(...t)=>function(e,t,n){const o=t._zod.def.shape,r={...o};if(n)for(const i in n){if(!(i in r))throw new Error(`Unrecognized key: "${i}"`);n[i]&&(r[i]=new e({type:"nonoptional",innerType:o[i]}))}else for(const i in o)r[i]=new e({type:"nonoptional",innerType:o[i]});return _n(t,{...t._zod.def,shape:r,checks:[]})}(Ea,e,t[0])});function ra(e,t){const n={type:"object",get shape(){return pn(this,"shape",{...e}),this.shape},...wn(t)};return new oa(n)}function ia(e,t){return new oa({type:"object",get shape(){return pn(this,"shape",{...e}),this.shape},catchall:ea(),...wn(t)})}function aa(e,t){return new oa({type:"object",get shape(){return pn(this,"shape",{...e}),this.shape},catchall:Ji(),...wn(t)})}const sa=tn("ZodUnion",(e,t)=>{yr.init(e,t),gi.init(e,t),e.options=t.options});function la(e,t){return new sa({type:"union",options:e,...wn(t)})}const ua=tn("ZodDiscriminatedUnion",(e,t)=>{sa.init(e,t),vr.init(e,t)});function ca(e,t,n){return new ua({type:"union",options:t,discriminator:e,...wn(n)})}const da=tn("ZodIntersection",(e,t)=>{br.init(e,t),gi.init(e,t)});const pa=tn("ZodRecord",(e,t)=>{xr.init(e,t),gi.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function ha(e,t,n){return new pa({type:"record",keyType:e,valueType:t,...wn(n)})}const fa=tn("ZodEnum",(e,t)=>{kr.init(e,t),gi.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(e,o)=>{const r={};for(const i of e){if(!n.has(i))throw new Error(`Key ${i} not found in enum`);r[i]=t.entries[i]}return new fa({...t,checks:[],...wn(o),entries:r})},e.exclude=(e,o)=>{const r={...t.entries};for(const t of e){if(!n.has(t))throw new Error(`Key ${t} not found in enum`);delete r[t]}return new fa({...t,checks:[],...wn(o),entries:r})}});function ma(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(e=>[e,e])):e;return new fa({type:"enum",entries:n,...wn(t)})}const ga=tn("ZodLiteral",(e,t)=>{Sr.init(e,t),gi.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function ya(e,t){return new ga({type:"literal",values:Array.isArray(e)?e:[e],...wn(t)})}const va=tn("ZodTransform",(e,t)=>{Er.init(e,t),gi.init(e,t),e._zod.parse=(n,o)=>{n.addIssue=o=>{if("string"==typeof o)n.issues.push(In(o,n.value,t));else{const t=o;t.fatal&&(t.continue=!1),t.code??(t.code="custom"),t.input??(t.input=n.value),t.inst??(t.inst=e),t.continue??(t.continue=!0),n.issues.push(In(t))}};const r=t.transform(n.value,n);return r instanceof Promise?r.then(e=>(n.value=e,n)):(n.value=r,n)}});const ba=tn("ZodOptional",(e,t)=>{Cr.init(e,t),gi.init(e,t),e.unwrap=()=>e._zod.def.innerType});function _a(e){return new ba({type:"optional",innerType:e})}const wa=tn("ZodNullable",(e,t)=>{Nr.init(e,t),gi.init(e,t),e.unwrap=()=>e._zod.def.innerType});function xa(e){return new wa({type:"nullable",innerType:e})}const ka=tn("ZodDefault",(e,t)=>{Ir.init(e,t),gi.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});const Sa=tn("ZodPrefault",(e,t)=>{Ar.init(e,t),gi.init(e,t),e.unwrap=()=>e._zod.def.innerType});const Ea=tn("ZodNonOptional",(e,t)=>{Pr.init(e,t),gi.init(e,t),e.unwrap=()=>e._zod.def.innerType});const Ca=tn("ZodCatch",(e,t)=>{Mr.init(e,t),gi.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});const Na=tn("ZodPipe",(e,t)=>{zr.init(e,t),gi.init(e,t),e.in=t.in,e.out=t.out});function Ia(e,t){return new Na({type:"pipe",in:e,out:t})}const Oa=tn("ZodReadonly",(e,t)=>{Rr.init(e,t),gi.init(e,t)});const Aa=tn("ZodLazy",(e,t)=>{jr.init(e,t),gi.init(e,t),e.unwrap=()=>e._zod.def.getter()});function Pa(e){return new Aa({type:"lazy",getter:e})}const Ta=tn("ZodCustom",(e,t)=>{Dr.init(e,t),gi.init(e,t)});function Ma(e,t={error:`Input not instance of ${e.name}`}){const n=new Ta({type:"custom",check:"custom",fn:t=>t instanceof e,abort:!0,...wn(t)});return n._zod.bag.Class=e,n}function za(e){return function(e,t){return new e({type:"number",coerce:!0,checks:[],...wn(t)})}(Vi,e)}const $a=Symbol("Let zodToJsonSchema decide on which parser to use"),Ra={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},Za=e=>{const t=(e=>"string"==typeof e?{...Ra,name:e}:{...Ra,...e})(e),n=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,n])=>[n._def,{def:n._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}};function ja(e,t,n,o){(null==o?void 0:o.errorMessages)&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function Da(e,t,n,o,r){e[t]=n,ja(e,t,o,r)}const La=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")};function Va(e){if("openAi"!==e.target)return{};const t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:"relative"===e.$refStrategy?La(t,e.currentPath):t.join("/")}}function Ba(e,t){return ms(e.type._def,t)}function Fa(e,t,n){const o=n??t.dateStrategy;if(Array.isArray(o))return{anyOf:o.map((n,o)=>Fa(e,t,n))};switch(o){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Ha(e,t)}}const Ha=(e,t)=>{const n={type:"integer",format:"unix-time"};if("openApi3"===t.target)return n;for(const o of e.checks)switch(o.kind){case"min":Da(n,"minimum",o.value,o.message,t);break;case"max":Da(n,"maximum",o.value,o.message,t)}return n};let Ua;const Ya=/^[cC][^\s-]{8,}$/,Ka=/^[0-9a-z]+$/,Wa=/^[0-9A-HJKMNP-TV-Z]{26}$/,Xa=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,qa=()=>(void 0===Ua&&(Ua=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ua),Ga=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Ja=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Qa=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,es=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ts=/^[a-zA-Z0-9_-]{21}$/,ns=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/;function os(e,t){const n={type:"string"};if(e.checks)for(const o of e.checks)switch(o.kind){case"min":Da(n,"minLength","number"==typeof n.minLength?Math.max(n.minLength,o.value):o.value,o.message,t);break;case"max":Da(n,"maxLength","number"==typeof n.maxLength?Math.min(n.maxLength,o.value):o.value,o.message,t);break;case"email":switch(t.emailStrategy){case"format:email":as(n,"email",o.message,t);break;case"format:idn-email":as(n,"idn-email",o.message,t);break;case"pattern:zod":ss(n,Xa,o.message,t)}break;case"url":as(n,"uri",o.message,t);break;case"uuid":as(n,"uuid",o.message,t);break;case"regex":ss(n,o.regex,o.message,t);break;case"cuid":ss(n,Ya,o.message,t);break;case"cuid2":ss(n,Ka,o.message,t);break;case"startsWith":ss(n,RegExp(`^${rs(o.value,t)}`),o.message,t);break;case"endsWith":ss(n,RegExp(`${rs(o.value,t)}$`),o.message,t);break;case"datetime":as(n,"date-time",o.message,t);break;case"date":as(n,"date",o.message,t);break;case"time":as(n,"time",o.message,t);break;case"duration":as(n,"duration",o.message,t);break;case"length":Da(n,"minLength","number"==typeof n.minLength?Math.max(n.minLength,o.value):o.value,o.message,t),Da(n,"maxLength","number"==typeof n.maxLength?Math.min(n.maxLength,o.value):o.value,o.message,t);break;case"includes":ss(n,RegExp(rs(o.value,t)),o.message,t);break;case"ip":"v6"!==o.version&&as(n,"ipv4",o.message,t),"v4"!==o.version&&as(n,"ipv6",o.message,t);break;case"base64url":ss(n,es,o.message,t);break;case"jwt":ss(n,ns,o.message,t);break;case"cidr":"v6"!==o.version&&ss(n,Ga,o.message,t),"v4"!==o.version&&ss(n,Ja,o.message,t);break;case"emoji":ss(n,qa(),o.message,t);break;case"ulid":ss(n,Wa,o.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":as(n,"binary",o.message,t);break;case"contentEncoding:base64":Da(n,"contentEncoding","base64",o.message,t);break;case"pattern:zod":ss(n,Qa,o.message,t)}break;case"nanoid":ss(n,ts,o.message,t)}return n}function rs(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let n=0;n<e.length;n++)is.has(e[n])||(t+="\\"),t+=e[n];return t}(e):e}const is=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function as(e,t,n,o){var r;e.format||(null==(r=e.anyOf)?void 0:r.some(e=>e.format))?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&o.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&o.errorMessages&&{errorMessage:{format:n}}})):Da(e,"format",t,n,o)}function ss(e,t,n,o){var r;e.pattern||(null==(r=e.allOf)?void 0:r.some(e=>e.pattern))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&o.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:ls(t,o),...n&&o.errorMessages&&{errorMessage:{pattern:n}}})):Da(e,"pattern",ls(t,o),n,o)}function ls(e,t){var n;if(!t.applyRegexFlags||!e.flags)return e.source;const o=e.flags.includes("i"),r=e.flags.includes("m"),i=e.flags.includes("s"),a=o?e.source.toLowerCase():e.source;let s="",l=!1,u=!1,c=!1;for(let d=0;d<a.length;d++)if(l)s+=a[d],l=!1;else{if(o)if(u){if(a[d].match(/[a-z]/)){c?(s+=a[d],s+=`${a[d-2]}-${a[d]}`.toUpperCase(),c=!1):"-"===a[d+1]&&(null==(n=a[d+2])?void 0:n.match(/[a-z]/))?(s+=a[d],c=!0):s+=`${a[d]}${a[d].toUpperCase()}`;continue}}else if(a[d].match(/[a-z]/)){s+=`[${a[d]}${a[d].toUpperCase()}]`;continue}if(r){if("^"===a[d]){s+="(^|(?<=[\r\n]))";continue}if("$"===a[d]){s+="($|(?=[\r\n]))";continue}}i&&"."===a[d]?s+=u?`${a[d]}\r\n`:`[${a[d]}\r\n]`:(s+=a[d],"\\"===a[d]?l=!0:u&&"]"===a[d]?u=!1:u||"["!==a[d]||(u=!0))}try{new RegExp(s)}catch{return e.source}return s}function us(e,t){var n,o,r,i,a,s;if(t.target,"openApi3"===t.target&&(null==(n=e.keyType)?void 0:n._def.typeName)===$e.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((n,o)=>({...n,[o]:ms(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",o]})??Va(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};const l={type:"object",additionalProperties:ms(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if("openApi3"===t.target)return l;if((null==(o=e.keyType)?void 0:o._def.typeName)===$e.ZodString&&(null==(r=e.keyType._def.checks)?void 0:r.length)){const{type:n,...o}=os(e.keyType._def,t);return{...l,propertyNames:o}}if((null==(i=e.keyType)?void 0:i._def.typeName)===$e.ZodEnum)return{...l,propertyNames:{enum:e.keyType._def.values}};if((null==(a=e.keyType)?void 0:a._def.typeName)===$e.ZodBranded&&e.keyType._def.type._def.typeName===$e.ZodString&&(null==(s=e.keyType._def.type._def.checks)?void 0:s.length)){const{type:n,...o}=Ba(e.keyType._def,t);return{...l,propertyNames:o}}return l}const cs={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};const ds=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,n)=>ms(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${n}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return n.length?{anyOf:n}:void 0};function ps(e,t){const n="openAi"===t.target,o={type:"object",properties:{}},r=[],i=e.shape();for(const s in i){let e=i[s];if(void 0===e||void 0===e._def)continue;let a=hs(e);a&&n&&("ZodOptional"===e._def.typeName&&(e=e._def.innerType),e.isNullable()||(e=e.nullable()),a=!1);const l=ms(e._def,{...t,currentPath:[...t.currentPath,"properties",s],propertyPath:[...t.currentPath,"properties",s]});void 0!==l&&(o.properties[s]=l,a||r.push(s))}r.length&&(o.required=r);const a=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return ms(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==a&&(o.additionalProperties=a),o}function hs(e){try{return e.isOptional()}catch{return!0}}const fs=(e,t,n)=>{switch(t){case $e.ZodString:return os(e,n);case $e.ZodNumber:return function(e,t){const n={type:"number"};if(!e.checks)return n;for(const o of e.checks)switch(o.kind){case"int":n.type="integer",ja(n,"type",o.message,t);break;case"min":"jsonSchema7"===t.target?o.inclusive?Da(n,"minimum",o.value,o.message,t):Da(n,"exclusiveMinimum",o.value,o.message,t):(o.inclusive||(n.exclusiveMinimum=!0),Da(n,"minimum",o.value,o.message,t));break;case"max":"jsonSchema7"===t.target?o.inclusive?Da(n,"maximum",o.value,o.message,t):Da(n,"exclusiveMaximum",o.value,o.message,t):(o.inclusive||(n.exclusiveMaximum=!0),Da(n,"maximum",o.value,o.message,t));break;case"multipleOf":Da(n,"multipleOf",o.value,o.message,t)}return n}(e,n);case $e.ZodObject:return ps(e,n);case $e.ZodBigInt:return function(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const o of e.checks)switch(o.kind){case"min":"jsonSchema7"===t.target?o.inclusive?Da(n,"minimum",o.value,o.message,t):Da(n,"exclusiveMinimum",o.value,o.message,t):(o.inclusive||(n.exclusiveMinimum=!0),Da(n,"minimum",o.value,o.message,t));break;case"max":"jsonSchema7"===t.target?o.inclusive?Da(n,"maximum",o.value,o.message,t):Da(n,"exclusiveMaximum",o.value,o.message,t):(o.inclusive||(n.exclusiveMaximum=!0),Da(n,"maximum",o.value,o.message,t));break;case"multipleOf":Da(n,"multipleOf",o.value,o.message,t)}return n}(e,n);case $e.ZodBoolean:return{type:"boolean"};case $e.ZodDate:return Fa(e,n);case $e.ZodUndefined:return function(e){return{not:Va(e)}}(n);case $e.ZodNull:return function(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}(n);case $e.ZodArray:return function(e,t){var n,o,r;const i={type:"array"};return(null==(n=e.type)?void 0:n._def)&&(null==(r=null==(o=e.type)?void 0:o._def)?void 0:r.typeName)!==$e.ZodAny&&(i.items=ms(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&Da(i,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&Da(i,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(Da(i,"minItems",e.exactLength.value,e.exactLength.message,t),Da(i,"maxItems",e.exactLength.value,e.exactLength.message,t)),i}(e,n);case $e.ZodUnion:case $e.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return ds(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(e=>e._def.typeName in cs&&(!e._def.checks||!e._def.checks.length))){const e=n.reduce((e,t)=>{const n=cs[t._def.typeName];return n&&!e.includes(n)?[...e,n]:e},[]);return{type:e.length>1?e:e[0]}}if(n.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){const e=n.reduce((e,t)=>{const n=typeof t._def.value;switch(n){case"string":case"number":case"boolean":return[...e,n];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===n.length){const t=e.filter((e,t,n)=>n.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:n.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(n.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:n.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return ds(e,t)}(e,n);case $e.ZodIntersection:return function(e,t){const n=[ms(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),ms(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e);let o="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0;const r=[];return n.forEach(e=>{if("type"in(t=e)&&"string"===t.type||!("allOf"in t)){let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){const{additionalProperties:n,...o}=e;t=o}else o=void 0;r.push(t)}else r.push(...e.allOf),void 0===e.unevaluatedProperties&&(o=void 0);var t}),r.length?{allOf:r,...o}:void 0}(e,n);case $e.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,n)=>ms(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:ms(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,n)=>ms(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}(e,n);case $e.ZodRecord:return us(e,n);case $e.ZodLiteral:return function(e,t){const n=typeof e.value;return"bigint"!==n&&"number"!==n&&"boolean"!==n&&"string"!==n?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===n?"integer":n,enum:[e.value]}:{type:"bigint"===n?"integer":n,const:e.value}}(e,n);case $e.ZodEnum:return function(e){return{type:"string",enum:Array.from(e.values)}}(e);case $e.ZodNativeEnum:return function(e){const t=e.values,n=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]).map(e=>t[e]),o=Array.from(new Set(n.map(e=>typeof e)));return{type:1===o.length?"string"===o[0]?"string":"number":["string","number"],enum:n}}(e);case $e.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:cs[e.innerType._def.typeName],nullable:!0}:{type:[cs[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){const n=ms(e.innerType._def,{...t,currentPath:[...t.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const n=ms(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}(e,n);case $e.ZodOptional:return((e,t)=>{var n;if(t.currentPath.toString()===(null==(n=t.propertyPath)?void 0:n.toString()))return ms(e.innerType._def,t);const o=ms(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return o?{anyOf:[{not:Va(t)},o]}:Va(t)})(e,n);case $e.ZodMap:return function(e,t){return"record"===t.mapStrategy?us(e,t):{type:"array",maxItems:125,items:{type:"array",items:[ms(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||Va(t),ms(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||Va(t)],minItems:2,maxItems:2}}}(e,n);case $e.ZodSet:return function(e,t){const n={type:"array",uniqueItems:!0,items:ms(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&Da(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&Da(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}(e,n);case $e.ZodLazy:return()=>e.getter()._def;case $e.ZodPromise:return function(e,t){return ms(e.type._def,t)}(e,n);case $e.ZodNaN:case $e.ZodNever:return function(e){return"openAi"===e.target?void 0:{not:Va({...e,currentPath:[...e.currentPath,"not"]})}}(n);case $e.ZodEffects:return function(e,t){return"input"===t.effectStrategy?ms(e.schema._def,t):Va(t)}(e,n);case $e.ZodAny:return Va(n);case $e.ZodUnknown:return function(e){return Va(e)}(n);case $e.ZodDefault:return function(e,t){return{...ms(e.innerType._def,t),default:e.defaultValue()}}(e,n);case $e.ZodBranded:return Ba(e,n);case $e.ZodReadonly:case $e.ZodCatch:return((e,t)=>ms(e.innerType._def,t))(e,n);case $e.ZodPipeline:return((e,t)=>{if("input"===t.pipeStrategy)return ms(e.in._def,t);if("output"===t.pipeStrategy)return ms(e.out._def,t);const n=ms(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]});return{allOf:[n,ms(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]})].filter(e=>void 0!==e)}})(e,n);case $e.ZodFunction:case $e.ZodVoid:case $e.ZodSymbol:default:return}};function ms(e,t,n=!1){var o;const r=t.seen.get(e);if(t.override){const i=null==(o=t.override)?void 0:o.call(t,e,t,r,n);if(i!==$a)return i}if(r&&!n){const e=gs(r,t);if(void 0!==e)return e}const i={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,i);const a=fs(e,e.typeName,t),s="function"==typeof a?ms(a(),t):a;if(s&&ys(e,t,s),t.postProcess){const n=t.postProcess(s,e,t);return i.jsonSchema=s,n}return i.jsonSchema=s,s}const gs=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:La(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((e,n)=>t.currentPath[n]===e)||"seen"===t.$refStrategy?Va(t):void 0}},ys=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n);var vs={};function bs(...e){return e.reduce((e,t)=>({...e,...null!=t?t:{}}),{})}function _s(){return new DOMException("Delay was aborted","AbortError")}function ws(e){return Object.fromEntries([...e.headers])}var xs=({prefix:e,size:t=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:o="-"}={})=>{const r=()=>{const e=n.length,o=new Array(t);for(let r=0;r<t;r++)o[r]=n[Math.random()*e|0];return o.join("")};if(null==e)return r;if(n.includes(o))throw new ct({argument:"separator",message:`The separator "${o}" must not be part of the alphabet "${n}".`});return()=>`${e}${o}${r()}`},ks=xs();function Ss(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}function Es(e){return(e instanceof Error||e instanceof DOMException)&&("AbortError"===e.name||"ResponseAborted"===e.name||"TimeoutError"===e.name)}var Cs=["fetch failed","failed to fetch"];function Ns({error:e,url:t,requestBodyValues:n}){if(Es(e))return e;if(e instanceof TypeError&&Cs.includes(e.message.toLowerCase())){const o=e.cause;if(null!=o)return new Qe({message:`Cannot connect to API: ${o.message}`,cause:o,url:t,requestBodyValues:n,isRetryable:!0})}return e}function Is(e){return Object.fromEntries(Object.entries(e).filter(([e,t])=>null!=t))}var Os=()=>globalThis.fetch;function As({apiKey:e,environmentVariableName:t,apiKeyParameterName:n="apiKey",description:o}){if("string"==typeof e)return e;if(null!=e)throw new At({message:`${o} API key must be a string.`});if("undefined"==typeof process)throw new At({message:`${o} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(null==(e=vs[t]))throw new At({message:`${o} API key is missing. Pass it using the '${n}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new At({message:`${o} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}function Ps({settingValue:e,environmentVariableName:t}){return"string"==typeof e||null==e&&"undefined"!=typeof process&&null!=(e=vs[t])&&"string"==typeof e?e:void 0}var Ts=/"__proto__"\s*:/,Ms=/"constructor"\s*:/;function zs(e){const t=JSON.parse(e);return null===t||"object"!=typeof t||!1===Ts.test(e)&&!1===Ms.test(e)?t:function(e){let t=[e];for(;t.length;){const e=t;t=[];for(const n of e){if(Object.prototype.hasOwnProperty.call(n,"__proto__"))throw new SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(n,"constructor")&&Object.prototype.hasOwnProperty.call(n.constructor,"prototype"))throw new SyntaxError("Object contains forbidden prototype property");for(const e in n){const o=n[e];o&&"object"==typeof o&&t.push(o)}}}return e}(t)}function $s(e){const{stackTraceLimit:t}=Error;Error.stackTraceLimit=0;try{return zs(e)}finally{Error.stackTraceLimit=t}}var Rs=Symbol.for("vercel.ai.validator");function Zs(e){return function(e){return"object"==typeof e&&null!==e&&Rs in e&&!0===e[Rs]&&"validate"in e}(e)?e:(t=e,n=async e=>{const n=await t["~standard"].validate(e);return null==n.issues?{success:!0,value:n.value}:{success:!1,error:new Yt({value:e,cause:n.issues})}},{[Rs]:!0,validate:n});var t,n}async function js({value:e,schema:t}){const n=Zs(t);try{if(null==n.validate)return{success:!0,value:e,rawValue:e};const t=await n.validate(e);return t.success?{success:!0,value:t.value,rawValue:e}:{success:!1,error:Yt.wrap({value:e,cause:t.error}),rawValue:e}}catch(o){return{success:!1,error:Yt.wrap({value:e,cause:o}),rawValue:e}}}async function Ds({text:e,schema:t}){try{const n=$s(e);return null==t?n:async function({value:e,schema:t}){const n=await js({value:e,schema:t});if(!n.success)throw Yt.wrap({value:e,cause:n.error});return n.value}({value:n,schema:t})}catch(n){if(Et.isInstance(n)||Yt.isInstance(n))throw n;throw new Et({text:e,cause:n})}}async function Ls({text:e,schema:t}){try{const n=$s(e);return null==t?{success:!0,value:n,rawValue:n}:await js({value:n,schema:t})}catch(n){return{success:!1,error:Et.isInstance(n)?n:new Et({text:e,cause:n}),rawValue:void 0}}}function Vs(e){try{return $s(e),!0}catch(t){return!1}}function Bs({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new en).pipeThrough(new TransformStream({async transform({data:e},n){"[DONE]"!==e&&n.enqueue(await Ls({text:e,schema:t}))}}))}async function Fs({provider:e,providerOptions:t,schema:n}){if(null==(null==t?void 0:t[e]))return;const o=await js({value:t[e],schema:n});if(!o.success)throw new ct({argument:"providerOptions",message:`invalid ${e} provider options`,cause:o.error});return o.value}var Hs=()=>globalThis.fetch,Us=async({url:e,headers:t,body:n,failedResponseHandler:o,successfulResponseHandler:r,abortSignal:i,fetch:a})=>Ks({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(n),values:n},failedResponseHandler:o,successfulResponseHandler:r,abortSignal:i,fetch:a}),Ys=async({url:e,headers:t,formData:n,failedResponseHandler:o,successfulResponseHandler:r,abortSignal:i,fetch:a})=>Ks({url:e,headers:t,body:{content:n,values:Object.fromEntries(n.entries())},failedResponseHandler:o,successfulResponseHandler:r,abortSignal:i,fetch:a}),Ks=async({url:e,headers:t={},body:n,successfulResponseHandler:o,failedResponseHandler:r,abortSignal:i,fetch:a=Hs()})=>{try{const l=await a(e,{method:"POST",headers:Is(t),body:n.content,signal:i}),u=ws(l);if(!l.ok){let t;try{t=await r({response:l,url:e,requestBodyValues:n.values})}catch(s){if(Es(s)||Qe.isInstance(s))throw s;throw new Qe({message:"Failed to process error response",cause:s,statusCode:l.status,url:e,responseHeaders:u,requestBodyValues:n.values})}throw t.value}try{return await o({response:l,url:e,requestBodyValues:n.values})}catch(s){if(s instanceof Error&&(Es(s)||Qe.isInstance(s)))throw s;throw new Qe({message:"Failed to process successful response",cause:s,statusCode:l.status,url:e,responseHeaders:u,requestBodyValues:n.values})}}catch(s){throw Ns({error:s,url:e,requestBodyValues:n.values})}};function Ws({id:e,name:t,inputSchema:n}){return({execute:o,outputSchema:r,toModelOutput:i,onInputStart:a,onInputDelta:s,onInputAvailable:l,...u})=>({type:"provider-defined",id:e,name:t,args:u,inputSchema:n,outputSchema:r,execute:o,toModelOutput:i,onInputStart:a,onInputDelta:s,onInputAvailable:l})}async function Xs(e){return"function"==typeof e&&(e=e()),Promise.resolve(e)}var qs=({errorSchema:e,errorToMessage:t,isRetryable:n})=>async({response:o,url:r,requestBodyValues:i})=>{const a=await o.text(),s=ws(o);if(""===a.trim())return{responseHeaders:s,value:new Qe({message:o.statusText,url:r,requestBodyValues:i,statusCode:o.status,responseHeaders:s,responseBody:a,isRetryable:null==n?void 0:n(o)})};try{const l=await Ds({text:a,schema:e});return{responseHeaders:s,value:new Qe({message:t(l),url:r,requestBodyValues:i,statusCode:o.status,responseHeaders:s,responseBody:a,data:l,isRetryable:null==n?void 0:n(o,l)})}}catch(l){return{responseHeaders:s,value:new Qe({message:o.statusText,url:r,requestBodyValues:i,statusCode:o.status,responseHeaders:s,responseBody:a,isRetryable:null==n?void 0:n(o)})}}},Gs=e=>async({response:t})=>{const n=ws(t);if(null==t.body)throw new rt({});return{responseHeaders:n,value:Bs({stream:t.body,schema:e})}},Js=e=>async({response:t,url:n,requestBodyValues:o})=>{const r=await t.text(),i=await Ls({text:r,schema:e}),a=ws(t);if(!i.success)throw new Qe({message:"Invalid JSON response",cause:i.error,statusCode:t.status,responseHeaders:a,responseBody:r,url:n,requestBodyValues:o});return{responseHeaders:a,value:i.value,rawValue:i.rawValue}},Qs=()=>async({response:e,url:t,requestBodyValues:n})=>{const o=ws(e);if(!e.body)throw new Qe({message:"Response body is empty",url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:o,responseBody:void 0});try{const t=await e.arrayBuffer();return{responseHeaders:o,value:new Uint8Array(t)}}catch(r){throw new Qe({message:"Failed to read response as array buffer",url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:o,responseBody:void 0,cause:r})}};function el(e,t){const n=null!=void 0&&undefined;return ol(((e,t)=>{const n=Za(t);let o="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,o])=>({...e,[t]:ms(o._def,{...n,currentPath:[...n.basePath,n.definitionPath,t]},!0)??Va(n)}),{}):void 0;const r="string"==typeof t?t:"title"===(null==t?void 0:t.nameStrategy)||null==t?void 0:t.name,i=ms(e._def,void 0===r?n:{...n,currentPath:[...n.basePath,n.definitionPath,r]},!1)??Va(n),a="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==a&&(i.title=a),n.flags.hasReferencedOpenAiAnyType&&(o||(o={}),o[n.openAiAnyTypeName]||(o[n.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:"relative"===n.$refStrategy?"1":[...n.basePath,n.definitionPath,n.openAiAnyTypeName].join("/")}}));const s=void 0===r?o?{...i,[n.definitionPath]:o}:i:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,r].join("/"),[n.definitionPath]:{...o,[r]:i}};return"jsonSchema7"===n.target?s.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"!==n.target&&"openAi"!==n.target||(s.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===n.target&&("anyOf"in s||"oneOf"in s||"allOf"in s||"type"in s&&Array.isArray(s.type)),s})(e,{$refStrategy:n?"root":"none",target:"jsonSchema7"}),{validate:async t=>{const n=await e.safeParseAsync(t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}function tl(e,t){const n=null!=void 0&&undefined;return ol(function(e,t){if(e instanceof Vr){const n=new ti(t),o={};for(const t of e._idmap.entries()){const[e,o]=t;n.process(o)}const r={},i={registry:e,uri:null==t?void 0:t.uri,defs:o};for(const a of e._idmap.entries()){const[e,o]=a;r[e]=n.emit(o,{...t,external:i})}if(Object.keys(o).length>0){const e="draft-2020-12"===n.target?"$defs":"definitions";r.__shared={[e]:o}}return{schemas:r}}const n=new ti(t);return n.process(e),n.emit(e,t)}(e,{target:"draft-7",io:"output",reused:n?"ref":"inline"}),{validate:async t=>{const n=await mi(e,t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}var nl=Symbol.for("vercel.ai.schema");function ol(e,{validate:t}={}){return{[nl]:!0,_type:void 0,[Rs]:!0,jsonSchema:e,validate:t}}function rl(e){return null==e?ol({properties:{},additionalProperties:!1}):"object"==typeof(n=e)&&null!==n&&nl in n&&!0===n[nl]&&"jsonSchema"in n&&"validate"in n?e:function(e){return"_zod"in e}(t=e)?tl(t):el(t);var t,n}var{btoa:il,atob:al}=globalThis;function sl(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n=al(t);return Uint8Array.from(n,e=>e.codePointAt(0))}function ll(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCodePoint(e[n]);return il(t)}function ul(e){return e instanceof Uint8Array?ll(e):e}function cl(e){return null==e?void 0:e.replace(/\/$/,"")}var dl,pl,hl,fl,ml,gl,yl,vl,bl,_l,wl,xl,kl,Sl,El={},Cl=Symbol.for("vercel.ai.gateway.error"),Nl=class e extends(pl=Error,dl=Cl,pl){constructor({message:e,statusCode:t=500,cause:n}){super(e),this[dl]=!0,this.statusCode=t,this.cause=n}static isInstance(t){return e.hasMarker(t)}static hasMarker(e){return"object"==typeof e&&null!==e&&Cl in e&&!0===e[Cl]}},Il="GatewayAuthenticationError",Ol=`vercel.ai.gateway.error.${Il}`,Al=Symbol.for(Ol),Pl=class e extends(fl=Nl,hl=Al,fl){constructor({message:e="Authentication failed",statusCode:t=401,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[hl]=!0,this.name=Il,this.type="authentication_error"}static isInstance(e){return Nl.hasMarker(e)&&Al in e}static createContextualError({apiKeyProvided:t,oidcTokenProvided:n,message:o="Authentication failed",statusCode:r=401,cause:i}){let a;return a=t?"AI Gateway authentication failed: Invalid API key provided.\n\nThe token is expected to be provided via the 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.":n?"AI Gateway authentication failed: Invalid OIDC token provided.\n\nThe token is expected to be provided via the 'VERCEL_OIDC_TOKEN' environment variable. It expires every 12 hours.\n- make sure your Vercel project settings have OIDC enabled\n- if running locally with 'vercel dev', the token is automatically obtained and refreshed\n- if running locally with your own dev server, run 'vercel env pull' to fetch the token\n- in production/preview, the token is automatically obtained and refreshed\n\nAlternative: Provide an API key via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.":"AI Gateway authentication failed: No authentication provided.\n\nProvide either an API key or OIDC token.\n\nAPI key instructions:\n\nThe token is expected to be provided via the 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.\n\nOIDC token instructions:\n\nThe token is expected to be provided via the 'VERCEL_OIDC_TOKEN' environment variable. It expires every 12 hours.\n- make sure your Vercel project settings have OIDC enabled\n- if running locally with 'vercel dev', the token is automatically obtained and refreshed\n- if running locally with your own dev server, run 'vercel env pull' to fetch the token\n- in production/preview, the token is automatically obtained and refreshed",new e({message:a,statusCode:r,cause:i})}},Tl="GatewayInvalidRequestError",Ml=`vercel.ai.gateway.error.${Tl}`,zl=Symbol.for(Ml),$l=class extends(gl=Nl,ml=zl,gl){constructor({message:e="Invalid request",statusCode:t=400,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[ml]=!0,this.name=Tl,this.type="invalid_request_error"}static isInstance(e){return Nl.hasMarker(e)&&zl in e}},Rl="GatewayRateLimitError",Zl=`vercel.ai.gateway.error.${Rl}`,jl=Symbol.for(Zl),Dl=class extends(vl=Nl,yl=jl,vl){constructor({message:e="Rate limit exceeded",statusCode:t=429,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[yl]=!0,this.name=Rl,this.type="rate_limit_exceeded"}static isInstance(e){return Nl.hasMarker(e)&&jl in e}},Ll="GatewayModelNotFoundError",Vl=`vercel.ai.gateway.error.${Ll}`,Bl=Symbol.for(Vl),Fl=ra({modelId:bi()}),Hl=class extends(_l=Nl,bl=Bl,_l){constructor({message:e="Model not found",statusCode:t=404,modelId:n,cause:o}={}){super({message:e,statusCode:t,cause:o}),this[bl]=!0,this.name=Ll,this.type="model_not_found",this.modelId=n}static isInstance(e){return Nl.hasMarker(e)&&Bl in e}},Ul="GatewayInternalServerError",Yl=`vercel.ai.gateway.error.${Ul}`,Kl=Symbol.for(Yl),Wl=class extends(xl=Nl,wl=Kl,xl){constructor({message:e="Internal server error",statusCode:t=500,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[wl]=!0,this.name=Ul,this.type="internal_server_error"}static isInstance(e){return Nl.hasMarker(e)&&Kl in e}},Xl="GatewayResponseError",ql=`vercel.ai.gateway.error.${Xl}`,Gl=Symbol.for(ql),Jl=class extends(Sl=Nl,kl=Gl,Sl){constructor({message:e="Invalid response from Gateway",statusCode:t=502,response:n,validationError:o,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[kl]=!0,this.name=Xl,this.type="response_error",this.response=n,this.validationError=o}static isInstance(e){return Nl.hasMarker(e)&&Gl in e}};function Ql({response:e,statusCode:t,defaultMessage:n="Gateway request failed",cause:o,authMethod:r}){const i=eu.safeParse(e);if(!i.success)return new Jl({message:`Invalid error response format: ${n}`,statusCode:t,response:e,validationError:i.error,cause:o});const a=i.data,s=a.error.type,l=a.error.message;switch(s){case"authentication_error":return Pl.createContextualError({apiKeyProvided:"api-key"===r,oidcTokenProvided:"oidc"===r,statusCode:t,cause:o});case"invalid_request_error":return new $l({message:l,statusCode:t,cause:o});case"rate_limit_exceeded":return new Dl({message:l,statusCode:t,cause:o});case"model_not_found":{const e=Fl.safeParse(a.error.param);return new Hl({message:l,statusCode:t,modelId:e.success?e.data.modelId:void 0,cause:o})}default:return new Wl({message:l,statusCode:t,cause:o})}}var eu=ra({error:ra({message:bi(),type:bi().nullish(),param:Ji().nullish(),code:la([bi(),Bi()]).nullish()})});function tu(e,t){var n;return Nl.isInstance(e)?e:Qe.isInstance(e)?Ql({response:nu(e),statusCode:null!=(n=e.statusCode)?n:500,defaultMessage:"Gateway request failed",cause:e,authMethod:t}):Ql({response:{},statusCode:500,defaultMessage:e instanceof Error?`Gateway request failed: ${e.message}`:"Unknown Gateway error",cause:e,authMethod:t})}function nu(e){if(void 0!==e.data)return e.data;if(null!=e.responseBody)try{return JSON.parse(e.responseBody)}catch(t){return e.responseBody}return{}}var ou="ai-gateway-auth-method";function ru(e){const t=iu.safeParse(e[ou]);return t.success?t.data:void 0}var iu=la([ya("api-key"),ya("oidc")]),au=class{constructor(e){this.config=e}async getAvailableModels(){try{const{value:e}=await(async({url:e,headers:t={},successfulResponseHandler:n,failedResponseHandler:o,abortSignal:r,fetch:i=Os()})=>{try{const s=await i(e,{method:"GET",headers:Is(t),signal:r}),l=ws(s);if(!s.ok){let t;try{t=await o({response:s,url:e,requestBodyValues:{}})}catch(a){if(Es(a)||Qe.isInstance(a))throw a;throw new Qe({message:"Failed to process error response",cause:a,statusCode:s.status,url:e,responseHeaders:l,requestBodyValues:{}})}throw t.value}try{return await n({response:s,url:e,requestBodyValues:{}})}catch(a){if(a instanceof Error&&(Es(a)||Qe.isInstance(a)))throw a;throw new Qe({message:"Failed to process successful response",cause:a,statusCode:s.status,url:e,responseHeaders:l,requestBodyValues:{}})}}catch(a){throw Ns({error:a,url:e,requestBodyValues:{}})}})({url:`${this.config.baseURL}/config`,headers:await Xs(this.config.headers()),successfulResponseHandler:Js(cu),failedResponseHandler:qs({errorSchema:qi(),errorToMessage:e=>e}),fetch:this.config.fetch});return e}catch(e){throw tu(e)}}},su=ra({specificationVersion:ya("v2"),provider:bi(),modelId:bi()}),lu=ra({input:bi(),output:bi()}),uu=ra({id:bi(),name:bi(),description:bi().nullish(),pricing:lu.nullish(),specification:su}),cu=ra({models:na(uu)}),du=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(e){const{abortSignal:t,...n}=e;return{args:this.maybeEncodeFileParts(n),warnings:[]}}async doGenerate(e){const{args:t,warnings:n}=await this.getArgs(e),{abortSignal:o}=e,r=await Xs(this.config.headers());try{const{responseHeaders:i,value:a,rawValue:s}=await Us({url:this.getUrl(),headers:bs(r,e.headers,this.getModelConfigHeaders(this.modelId,!1),await Xs(this.config.o11yHeaders)),body:t,successfulResponseHandler:Js(qi()),failedResponseHandler:qs({errorSchema:qi(),errorToMessage:e=>e}),...o&&{abortSignal:o},fetch:this.config.fetch});return{...a,request:{body:t},response:{headers:i,body:s},warnings:n}}catch(i){throw tu(i,ru(r))}}async doStream(e){const{args:t,warnings:n}=await this.getArgs(e),{abortSignal:o}=e,r=await Xs(this.config.headers());try{const{value:i,responseHeaders:a}=await Us({url:this.getUrl(),headers:bs(r,e.headers,this.getModelConfigHeaders(this.modelId,!0),await Xs(this.config.o11yHeaders)),body:t,successfulResponseHandler:Gs(qi()),failedResponseHandler:qs({errorSchema:qi(),errorToMessage:e=>e}),...o&&{abortSignal:o},fetch:this.config.fetch});return{stream:i.pipeThrough(new TransformStream({start(e){n.length>0&&e.enqueue({type:"stream-start",warnings:n})},transform(t,n){if(t.success){const o=t.value;if("raw"===o.type&&!e.includeRawChunks)return;"response-metadata"===o.type&&o.timestamp&&"string"==typeof o.timestamp&&(o.timestamp=new Date(o.timestamp)),n.enqueue(o)}else n.error(t.error)}})),request:{body:t},response:{headers:a}}}catch(i){throw tu(i,ru(r))}}isFilePart(e){return e&&"object"==typeof e&&"type"in e&&"file"===e.type}maybeEncodeFileParts(e){for(const t of e.prompt)for(const e of t.content)if(this.isFilePart(e)){const t=e;if(t.data instanceof Uint8Array){const e=Uint8Array.from(t.data),n=Buffer.from(e).toString("base64");t.data=new URL(`data:${t.mediaType||"application/octet-stream"};base64,${n}`)}}return e}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(e,t){return{"ai-language-model-specification-version":"2","ai-language-model-id":e,"ai-language-model-streaming":String(t)}}},pu=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:o}){var r;const i=await Xs(this.config.headers());try{const{responseHeaders:a,value:s,rawValue:l}=await Us({url:this.getUrl(),headers:bs(i,null!=t?t:{},this.getModelConfigHeaders(),await Xs(this.config.o11yHeaders)),body:{input:1===e.length?e[0]:e,...null!=o?o:{}},successfulResponseHandler:Js(hu),failedResponseHandler:qs({errorSchema:qi(),errorToMessage:e=>e}),...n&&{abortSignal:n},fetch:this.config.fetch});return{embeddings:s.embeddings,usage:null!=(r=s.usage)?r:void 0,providerMetadata:s.providerMetadata,response:{headers:a,body:l}}}catch(a){throw tu(a,ru(i))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":"2","ai-model-id":this.modelId}}},hu=ra({embeddings:na(na(Bi())),usage:ra({tokens:Bi()}).nullish(),providerMetadata:ha(bi(),ha(bi(),Ji())).optional()});var fu=Symbol.for("@vercel/request-context");function mu(){var e,t,n;return null!=(n=null==(t=null==(e=globalThis[fu])?void 0:e.get)?void 0:t.call(e))?n:{}}var gu=function(e={}){var t,n;let o=null,r=null;const i=null!=(t=e.metadataCacheRefreshMillis)?t:3e5;let a=0;const s=null!=(n=cl(e.baseURL))?n:"https://ai-gateway.vercel.sh/v1/ai",l=async()=>{const t=await async function(e){const t=Ps({settingValue:e.apiKey,environmentVariableName:"AI_GATEWAY_API_KEY"});if(t)return{token:t,authMethod:"api-key"};try{const e=await async function(){var e,t;const n=null!=(t=null==(e=mu().headers)?void 0:e["x-vercel-oidc-token"])?t:El.VERCEL_OIDC_TOKEN;if(!n)throw new Pl({message:"OIDC token not available",statusCode:401});return n}();return{token:e,authMethod:"oidc"}}catch(n){return null}}(e);if(t)return{Authorization:`Bearer ${t.token}`,"ai-gateway-protocol-version":"0.0.1",[ou]:t.authMethod,...e.headers};throw Pl.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401})},u=()=>{const e=Ps({settingValue:void 0,environmentVariableName:"VERCEL_DEPLOYMENT_ID"}),t=Ps({settingValue:void 0,environmentVariableName:"VERCEL_ENV"}),n=Ps({settingValue:void 0,environmentVariableName:"VERCEL_REGION"});return async()=>{const o=await async function(){var e;return null==(e=mu().headers)?void 0:e["x-vercel-id"]}();return{...e&&{"ai-o11y-deployment-id":e},...t&&{"ai-o11y-environment":t},...n&&{"ai-o11y-region":n},...o&&{"ai-o11y-request-id":o}}}},c=t=>new du(t,{provider:"gateway",baseURL:s,headers:l,fetch:e.fetch,o11yHeaders:u()}),d=function(e){if(new.target)throw new Error("The Gateway Provider model function cannot be called with the new keyword.");return c(e)};return d.getAvailableModels=async()=>{var t,n,u;const c=null!=(u=null==(n=null==(t=e._internal)?void 0:t.currentDate)?void 0:n.call(t).getTime())?u:Date.now();return(!o||c-a>i)&&(a=c,o=new au({baseURL:s,headers:l,fetch:e.fetch}).getAvailableModels().then(e=>(r=e,e)).catch(async e=>{throw tu(e,ru(await l()))})),r?Promise.resolve(r):o},d.imageModel=e=>{throw new $t({modelId:e,modelType:"imageModel"})},d.languageModel=c,d.textEmbeddingModel=t=>new pu(t,{provider:"gateway",baseURL:s,headers:l,fetch:e.fetch,o11yHeaders:u()}),d}();var yu="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},vu="1.9.0",bu=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;var _u=function(e){var t=new Set([e]),n=new Set,o=e.match(bu);if(!o)return function(){return!1};var r=+o[1],i=+o[2],a=+o[3];if(null!=o[4])return function(t){return t===e};function s(e){return n.add(e),!1}function l(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(n.has(e))return!1;var o=e.match(bu);if(!o)return s(e);var u=+o[1],c=+o[2],d=+o[3];return null!=o[4]||r!==u?s(e):0===r?i===c&&a<=d?l(e):s(e):i<=c?l(e):s(e)}}(vu),wu=vu.split(".")[0],xu=Symbol.for("opentelemetry.js.api."+wu),ku=yu;function Su(e,t,n,o){var r;void 0===o&&(o=!1);var i=ku[xu]=null!==(r=ku[xu])&&void 0!==r?r:{version:vu};if(!o&&i[e]){var a=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(a.stack||a.message),!1}if(i.version!==vu){a=new Error("@opentelemetry/api: Registration of version v"+i.version+" for "+e+" does not match previously registered API v"+vu);return n.error(a.stack||a.message),!1}return i[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v"+vu+"."),!0}function Eu(e){var t,n,o=null===(t=ku[xu])||void 0===t?void 0:t.version;if(o&&_u(o))return null===(n=ku[xu])||void 0===n?void 0:n[e]}function Cu(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+vu+".");var n=ku[xu];n&&delete n[e]}var Nu,Iu,Ou=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Au("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Au("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Au("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Au("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Au("verbose",this._namespace,e)},e}();function Au(e,t,n){var o=Eu("diag");if(o)return n.unshift(t),o[e].apply(o,function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}([],function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(s){r={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a}(n),!1))}(Iu=Nu||(Nu={}))[Iu.NONE=0]="NONE",Iu[Iu.ERROR=30]="ERROR",Iu[Iu.WARN=50]="WARN",Iu[Iu.INFO=60]="INFO",Iu[Iu.DEBUG=70]="DEBUG",Iu[Iu.VERBOSE=80]="VERBOSE",Iu[Iu.ALL=9999]="ALL";var Pu=function(){function e(){function e(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=Eu("diag");if(o)return o[e].apply(o,function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}([],function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(s){r={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a}(t),!1))}}var t=this;t.setLogger=function(e,n){var o,r,i;if(void 0===n&&(n={logLevel:Nu.INFO}),e===t){var a=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(o=a.stack)&&void 0!==o?o:a.message),!1}"number"==typeof n&&(n={logLevel:n});var s=Eu("diag"),l=function(e,t){function n(n,o){var r=t[n];return"function"==typeof r&&e>=o?r.bind(t):function(){}}return e<Nu.NONE?e=Nu.NONE:e>Nu.ALL&&(e=Nu.ALL),t=t||{},{error:n("error",Nu.ERROR),warn:n("warn",Nu.WARN),info:n("info",Nu.INFO),debug:n("debug",Nu.DEBUG),verbose:n("verbose",Nu.VERBOSE)}}(null!==(r=n.logLevel)&&void 0!==r?r:Nu.INFO,e);if(s&&!n.suppressOverrideMessage){var u=null!==(i=(new Error).stack)&&void 0!==i?i:"<failed to generate stacktrace>";s.warn("Current logger will be overwritten from "+u),l.warn("Current logger will overwrite one already registered from "+u)}return Su("diag",l,t,!0)},t.disable=function(){Cu("diag",t)},t.createComponentLogger=function(e){return new Ou(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),Tu=function(){function e(e){this._entries=e?new Map(e):new Map}return e.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(e){var t=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(s){r={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a}(e,2);return[t[0],t[1]]})},e.prototype.setEntry=function(t,n){var o=new e(this._entries);return o._entries.set(t,n),o},e.prototype.removeEntry=function(t){var n=new e(this._entries);return n._entries.delete(t),n},e.prototype.removeEntries=function(){for(var t,n,o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];var i=new e(this._entries);try{for(var a=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(o),s=a.next();!s.done;s=a.next()){var l=s.value;i._entries.delete(l)}}catch(u){t={error:u}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return i},e.prototype.clear=function(){return new e},e}();function Mu(e){return void 0===e&&(e={}),new Tu(new Map(Object.entries(e)))}function zu(e){return Symbol.for(e)}Pu.instance();var $u,Ru,Zu=new(function(){return function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(e){return n._currentContext.get(e)},n.setValue=function(t,o){var r=new e(n._currentContext);return r._currentContext.set(t,o),r},n.deleteValue=function(t){var o=new e(n._currentContext);return o._currentContext.delete(t),o}}}()),ju=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Du=function(){function e(){}return e.prototype.createGauge=function(e,t){return Gu},e.prototype.createHistogram=function(e,t){return Ju},e.prototype.createCounter=function(e,t){return qu},e.prototype.createUpDownCounter=function(e,t){return Qu},e.prototype.createObservableGauge=function(e,t){return tc},e.prototype.createObservableCounter=function(e,t){return ec},e.prototype.createObservableUpDownCounter=function(e,t){return nc},e.prototype.addBatchObservableCallback=function(e,t){},e.prototype.removeBatchObservableCallback=function(e){},e}(),Lu=function(){return function(){}}(),Vu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ju(t,e),t.prototype.add=function(e,t){},t}(Lu),Bu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ju(t,e),t.prototype.add=function(e,t){},t}(Lu),Fu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ju(t,e),t.prototype.record=function(e,t){},t}(Lu),Hu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ju(t,e),t.prototype.record=function(e,t){},t}(Lu),Uu=function(){function e(){}return e.prototype.addCallback=function(e){},e.prototype.removeCallback=function(e){},e}(),Yu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ju(t,e),t}(Uu),Ku=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ju(t,e),t}(Uu),Wu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ju(t,e),t}(Uu),Xu=new Du,qu=new Vu,Gu=new Fu,Ju=new Hu,Qu=new Bu,ec=new Yu,tc=new Ku,nc=new Wu,oc={get:function(e,t){if(null!=e)return e[t]},keys:function(e){return null==e?[]:Object.keys(e)}},rc={set:function(e,t,n){null!=e&&(e[t]=n)}},ic=function(){function e(){}return e.prototype.active=function(){return Zu},e.prototype.with=function(e,t,n){for(var o=[],r=3;r<arguments.length;r++)o[r-3]=arguments[r];return t.call.apply(t,function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}([n],function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(s){r={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a}(o),!1))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),ac="context",sc=new ic,lc=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return Su(ac,e,Pu.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,n){for(var o,r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return(o=this._getContextManager()).with.apply(o,function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}([e,t,n],function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(s){r={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a}(r),!1))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return Eu(ac)||sc},e.prototype.disable=function(){this._getContextManager().disable(),Cu(ac,Pu.instance())},e}();(Ru=$u||($u={}))[Ru.NONE=0]="NONE",Ru[Ru.SAMPLED=1]="SAMPLED";var uc="0000000000000000",cc="00000000000000000000000000000000",dc={traceId:cc,spanId:uc,traceFlags:$u.NONE},pc=function(){function e(e){void 0===e&&(e=dc),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.addLink=function(e){return this},e.prototype.addLinks=function(e){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),hc=zu("OpenTelemetry Context Key SPAN");function fc(e){return e.getValue(hc)||void 0}function mc(){return fc(lc.getInstance().active())}function gc(e,t){return e.setValue(hc,t)}function yc(e){return e.deleteValue(hc)}function vc(e,t){return gc(e,new pc(t))}function bc(e){var t;return null===(t=fc(e))||void 0===t?void 0:t.spanContext()}var _c=/^([0-9a-f]{32})$/i,wc=/^[0-9a-f]{16}$/i;function xc(e){return n=e.traceId,_c.test(n)&&n!==cc&&(t=e.spanId,wc.test(t)&&t!==uc);var t,n}function kc(e){return new pc(e)}var Sc=lc.getInstance(),Ec=function(){function e(){}return e.prototype.startSpan=function(e,t,n){if(void 0===n&&(n=Sc.active()),Boolean(null==t?void 0:t.root))return new pc;var o,r=n&&bc(n);return"object"==typeof(o=r)&&"string"==typeof o.spanId&&"string"==typeof o.traceId&&"number"==typeof o.traceFlags&&xc(r)?new pc(r):new pc},e.prototype.startActiveSpan=function(e,t,n,o){var r,i,a;if(!(arguments.length<2)){2===arguments.length?a=t:3===arguments.length?(r=t,a=n):(r=t,i=n,a=o);var s=null!=i?i:Sc.active(),l=this.startSpan(e,r,s),u=gc(s,l);return Sc.with(u,a,void 0,l)}},e}();var Cc,Nc,Ic=new Ec,Oc=function(){function e(e,t,n,o){this._provider=e,this.name=t,this.version=n,this.options=o}return e.prototype.startSpan=function(e,t,n){return this._getTracer().startSpan(e,t,n)},e.prototype.startActiveSpan=function(e,t,n,o){var r=this._getTracer();return Reflect.apply(r.startActiveSpan,r,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):Ic},e}(),Ac=new(function(){function e(){}return e.prototype.getTracer=function(e,t,n){return new Ec},e}()),Pc=function(){function e(){}return e.prototype.getTracer=function(e,t,n){var o;return null!==(o=this.getDelegateTracer(e,t,n))&&void 0!==o?o:new Oc(this,e,t,n)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:Ac},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,n){var o;return null===(o=this._delegate)||void 0===o?void 0:o.getTracer(e,t,n)},e}();(Nc=Cc||(Cc={}))[Nc.UNSET=0]="UNSET",Nc[Nc.OK=1]="OK",Nc[Nc.ERROR=2]="ERROR",lc.getInstance(),Pu.instance();var Tc=new(function(){function e(){}return e.prototype.getMeter=function(e,t,n){return Xu},e}()),Mc="metrics";(function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalMeterProvider=function(e){return Su(Mc,e,Pu.instance())},e.prototype.getMeterProvider=function(){return Eu(Mc)||Tc},e.prototype.getMeter=function(e,t,n){return this.getMeterProvider().getMeter(e,t,n)},e.prototype.disable=function(){Cu(Mc,Pu.instance())},e})().getInstance();var zc=function(){function e(){}return e.prototype.inject=function(e,t){},e.prototype.extract=function(e,t){return e},e.prototype.fields=function(){return[]},e}(),$c=zu("OpenTelemetry Baggage Key");function Rc(e){return e.getValue($c)||void 0}function Zc(){return Rc(lc.getInstance().active())}function jc(e,t){return e.setValue($c,t)}function Dc(e){return e.deleteValue($c)}var Lc="propagation",Vc=new zc;(function(){function e(){this.createBaggage=Mu,this.getBaggage=Rc,this.getActiveBaggage=Zc,this.setBaggage=jc,this.deleteBaggage=Dc}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(e){return Su(Lc,e,Pu.instance())},e.prototype.inject=function(e,t,n){return void 0===n&&(n=rc),this._getGlobalPropagator().inject(e,t,n)},e.prototype.extract=function(e,t,n){return void 0===n&&(n=oc),this._getGlobalPropagator().extract(e,t,n)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){Cu(Lc,Pu.instance())},e.prototype._getGlobalPropagator=function(){return Eu(Lc)||Vc},e})().getInstance();var Bc,Fc="trace",Hc=function(){function e(){this._proxyTracerProvider=new Pc,this.wrapSpanContext=kc,this.isSpanContextValid=xc,this.deleteSpan=yc,this.getSpan=fc,this.getActiveSpan=mc,this.getSpanContext=bc,this.setSpan=gc,this.setSpanContext=vc}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=Su(Fc,this._proxyTracerProvider,Pu.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return Eu(Fc)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){Cu(Fc,Pu.instance()),this._proxyTracerProvider=new Pc},e}().getInstance(),Uc=Object.defineProperty,Yc="AI_NoOutputSpecifiedError",Kc=`vercel.ai.error.${Yc}`,Wc=Symbol.for(Kc),Xc=class extends Xe{constructor({message:e="No output specified."}={}){super({name:Yc,message:e}),this[Bc]=!0}static isInstance(e){return Xe.hasMarker(e,Kc)}};Bc=Wc;var qc,Gc="AI_InvalidArgumentError",Jc=`vercel.ai.error.${Gc}`,Qc=Symbol.for(Jc),ed=class extends Xe{constructor({parameter:e,value:t,message:n}){super({name:Gc,message:`Invalid argument for parameter ${e}: ${n}`}),this[qc]=!0,this.parameter=e,this.value=t}static isInstance(e){return Xe.hasMarker(e,Jc)}};qc=Qc;var td,nd="AI_InvalidToolInputError",od=`vercel.ai.error.${nd}`,rd=Symbol.for(od),id=class extends Xe{constructor({toolInput:e,toolName:t,cause:n,message:o=`Invalid input for tool ${t}: ${it(n)}`}){super({name:nd,message:o,cause:n}),this[td]=!0,this.toolInput=e,this.toolName=t}static isInstance(e){return Xe.hasMarker(e,od)}};td=rd;var ad,sd="AI_NoObjectGeneratedError",ld=`vercel.ai.error.${sd}`,ud=Symbol.for(ld),cd=class extends Xe{constructor({message:e="No object generated.",cause:t,text:n,response:o,usage:r,finishReason:i}){super({name:sd,message:e,cause:t}),this[ad]=!0,this.text=n,this.response=o,this.usage=r,this.finishReason=i}static isInstance(e){return Xe.hasMarker(e,ld)}};ad=ud;var dd,pd="AI_NoSuchToolError",hd=`vercel.ai.error.${pd}`,fd=Symbol.for(hd),md=class extends Xe{constructor({toolName:e,availableTools:t,message:n=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:pd,message:n}),this[dd]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return Xe.hasMarker(e,hd)}};dd=fd;var gd,yd="AI_ToolCallRepairError",vd=`vercel.ai.error.${yd}`,bd=Symbol.for(vd),_d=class extends Xe{constructor({cause:e,originalError:t,message:n=`Error repairing tool call: ${it(e)}`}){super({name:yd,message:n,cause:e}),this[gd]=!0,this.originalError=t}static isInstance(e){return Xe.hasMarker(e,vd)}};gd=bd;var wd,xd=class extends Xe{constructor(e){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${e.version} for provider "${e.provider}" and model "${e.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=e.version,this.provider=e.provider,this.modelId=e.modelId}},kd="AI_InvalidMessageRoleError",Sd=`vercel.ai.error.${kd}`,Ed=Symbol.for(Sd),Cd=class extends Xe{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:kd,message:t}),this[wd]=!0,this.role=e}static isInstance(e){return Xe.hasMarker(e,Sd)}};wd=Ed;var Nd,Id="AI_DownloadError",Od=`vercel.ai.error.${Id}`,Ad=Symbol.for(Od),Pd=class extends Xe{constructor({url:e,statusCode:t,statusText:n,cause:o,message:r=(null==o?`Failed to download ${e}: ${t} ${n}`:`Failed to download ${e}: ${o}`)}){super({name:Id,message:r,cause:o}),this[Nd]=!0,this.url=e,this.statusCode=t,this.statusText=n}static isInstance(e){return Xe.hasMarker(e,Od)}};Nd=Ad;var Td,Md="AI_RetryError",zd=`vercel.ai.error.${Md}`,$d=Symbol.for(zd),Rd=class extends Xe{constructor({message:e,reason:t,errors:n}){super({name:Md,message:e}),this[Td]=!0,this.reason=t,this.errors=n,this.lastError=n[n.length-1]}static isInstance(e){return Xe.hasMarker(e,zd)}};function Zd(e){if("string"!=typeof e){if("v2"!==e.specificationVersion)throw new xd({version:e.specificationVersion,provider:e.provider,modelId:e.modelId});return e}return(null!=(t=globalThis.AI_SDK_DEFAULT_PROVIDER)?t:gu).languageModel(e);var t}Td=$d;var jd=[{mediaType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mediaType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mediaType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mediaType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mediaType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}];function Dd(e){return"string"==typeof e&&e.startsWith("SUQz")||"string"!=typeof e&&e.length>10&&73===e[0]&&68===e[1]&&51===e[2]?(e=>{const t="string"==typeof e?sl(e):e,n=(127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9];return t.slice(n+10)})(e):e}async function Ld({url:e}){var t;const n=e.toString();try{const e=await fetch(n);if(!e.ok)throw new Pd({url:n,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mediaType:null!=(t=e.headers.get("content-type"))?t:void 0}}catch(o){if(Pd.isInstance(o))throw o;throw new Pd({url:n,cause:o})}}var Vd,Bd,Fd=la([bi(),Ma(Uint8Array),Ma(ArrayBuffer),(Vd=e=>{var t,n;return null!=(n=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&n},Bd={message:"Must be a Buffer"},function(e,t,n){const o=wn(n);return o.abort??(o.abort=!0),new e({type:"custom",check:"custom",fn:t,...o})}(Ta,Vd??(()=>!0),Bd))]);function Hd(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if("string"==typeof e)try{e=new URL(e)}catch(t){}if(e instanceof URL&&"data:"===e.protocol){const{mediaType:n,base64Content:o}=function(e){try{const[t,n]=e.split(",");return{mediaType:t.split(";")[0].split(":")[1],base64Content:n}}catch(t){return{mediaType:void 0,base64Content:void 0}}}(e.toString());if(null==n||null==o)throw new Xe({name:"InvalidDataContentError",message:`Invalid data URL format in content ${e.toString()}`});return{data:o,mediaType:n}}return{data:e,mediaType:void 0}}async function Ud({prompt:e,supportedUrls:t,downloadImplementation:n=Ld}){const o=await async function(e,t,n){const o=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).map(e=>{var t;const n=null!=(t=e.mediaType)?t:"image"===e.type?"image/*":void 0;let o="image"===e.type?e.image:e.data;if("string"==typeof o)try{o=new URL(o)}catch(r){}return{mediaType:n,data:o}}).filter(e=>e.data instanceof URL&&null!=e.mediaType&&!function({mediaType:e,url:t,supportedUrls:n}){return t=t.toLowerCase(),e=e.toLowerCase(),Object.entries(n).map(([e,t])=>{const n=e.toLowerCase();return"*"===n||"*/*"===n?{mediaTypePrefix:"",regexes:t}:{mediaTypePrefix:n.replace(/\*/,""),regexes:t}}).filter(({mediaTypePrefix:t})=>e.startsWith(t)).flatMap(({regexes:e})=>e).some(e=>e.test(t))}({url:e.data.toString(),mediaType:e.mediaType,supportedUrls:n})).map(e=>e.data),r=await Promise.all(o.map(async e=>({url:e,data:await t({url:e})})));return Object.fromEntries(r.map(({url:e,data:t})=>[e.toString(),t]))}(e.messages,n,t);return[...null!=e.system?[{role:"system",content:e.system}]:[],...e.messages.map(e=>function({message:e,downloadedAssets:t}){const n=e.role;switch(n){case"system":return{role:"system",content:e.content,providerOptions:e.providerOptions};case"user":return"string"==typeof e.content?{role:"user",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions}:{role:"user",content:e.content.map(e=>function(e,t){var n;if("text"===e.type)return{type:"text",text:e.text,providerOptions:e.providerOptions};let o;const r=e.type;switch(r){case"image":o=e.image;break;case"file":o=e.data;break;default:throw new Error(`Unsupported part type: ${r}`)}const{data:i,mediaType:a}=Hd(o);let s=null!=a?a:e.mediaType,l=i;if(l instanceof URL){const e=t[l.toString()];e&&(l=e.data,null!=s||(s=e.mediaType))}switch(r){case"image":return(l instanceof Uint8Array||"string"==typeof l)&&(s=null!=(n=function({data:e,signatures:t}){const n=Dd(e);for(const o of t)if("string"==typeof n?n.startsWith(o.base64Prefix):n.length>=o.bytesPrefix.length&&o.bytesPrefix.every((e,t)=>n[t]===e))return o.mediaType}({data:l,signatures:jd}))?n:s),{type:"file",mediaType:null!=s?s:"image/*",filename:void 0,data:l,providerOptions:e.providerOptions};case"file":if(null==s)throw new Error("Media type is missing for file part");return{type:"file",mediaType:s,filename:e.filename,data:l,providerOptions:e.providerOptions}}}(e,t)).filter(e=>"text"!==e.type||""!==e.text),providerOptions:e.providerOptions};case"assistant":return"string"==typeof e.content?{role:"assistant",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions}:{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text).map(e=>{const t=e.providerOptions;switch(e.type){case"file":{const{data:n,mediaType:o}=Hd(e.data);return{type:"file",data:n,filename:e.filename,mediaType:null!=o?o:e.mediaType,providerOptions:t}}case"reasoning":return{type:"reasoning",text:e.text,providerOptions:t};case"text":return{type:"text",text:e.text,providerOptions:t};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:t};case"tool-result":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:t}}}),providerOptions:e.providerOptions};case"tool":return{role:"tool",content:e.content.map(e=>({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:e.providerOptions})),providerOptions:e.providerOptions};default:throw new Cd({role:n})}}({message:e,downloadedAssets:o}))]}function Yd({maxOutputTokens:e,temperature:t,topP:n,topK:o,presencePenalty:r,frequencyPenalty:i,seed:a,stopSequences:s}){if(null!=e){if(!Number.isInteger(e))throw new ed({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be an integer"});if(e<1)throw new ed({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new ed({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=n&&"number"!=typeof n)throw new ed({parameter:"topP",value:n,message:"topP must be a number"});if(null!=o&&"number"!=typeof o)throw new ed({parameter:"topK",value:o,message:"topK must be a number"});if(null!=r&&"number"!=typeof r)throw new ed({parameter:"presencePenalty",value:r,message:"presencePenalty must be a number"});if(null!=i&&"number"!=typeof i)throw new ed({parameter:"frequencyPenalty",value:i,message:"frequencyPenalty must be a number"});if(null!=a&&!Number.isInteger(a))throw new ed({parameter:"seed",value:a,message:"seed must be an integer"});return{maxOutputTokens:e,temperature:t,topP:n,topK:o,presencePenalty:r,frequencyPenalty:i,stopSequences:s,seed:a}}function Kd({tools:e,toolChoice:t,activeTools:n}){if(!(null!=(o=e)&&Object.keys(o).length>0))return{tools:void 0,toolChoice:void 0};var o;return{tools:(null!=n?Object.entries(e).filter(([e])=>n.includes(e)):Object.entries(e)).map(([e,t])=>{const n=t.type;switch(n){case void 0:case"dynamic":case"function":return{type:"function",name:e,description:t.description,inputSchema:rl(t.inputSchema).jsonSchema,providerOptions:t.providerOptions};case"provider-defined":return{type:"provider-defined",name:e,id:t.id,args:t.args};default:throw new Error(`Unsupported tool type: ${n}`)}}),toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}}var Wd=Pa(()=>la([Wi(),bi(),Bi(),Yi(),ha(bi(),Wd),na(Wd)])),Xd=ha(bi(),ha(bi(),Wd)),qd=ra({type:ya("text"),text:bi(),providerOptions:Xd.optional()}),Gd=ra({type:ya("image"),image:la([Fd,Ma(URL)]),mediaType:bi().optional(),providerOptions:Xd.optional()}),Jd=ra({type:ya("file"),data:la([Fd,Ma(URL)]),filename:bi().optional(),mediaType:bi(),providerOptions:Xd.optional()}),Qd=ra({type:ya("reasoning"),text:bi(),providerOptions:Xd.optional()}),ep=ra({type:ya("tool-call"),toolCallId:bi(),toolName:bi(),input:Ji(),providerOptions:Xd.optional(),providerExecuted:Yi().optional()}),tp=ca("type",[ra({type:ya("text"),value:bi()}),ra({type:ya("json"),value:Wd}),ra({type:ya("error-text"),value:bi()}),ra({type:ya("error-json"),value:Wd}),ra({type:ya("content"),value:na(la([ra({type:ya("text"),text:bi()}),ra({type:ya("media"),data:bi(),mediaType:bi()})]))})]),np=ra({type:ya("tool-result"),toolCallId:bi(),toolName:bi(),output:tp,providerOptions:Xd.optional()}),op=ra({role:ya("system"),content:bi(),providerOptions:Xd.optional()}),rp=ra({role:ya("user"),content:la([bi(),na(la([qd,Gd,Jd]))]),providerOptions:Xd.optional()}),ip=ra({role:ya("assistant"),content:la([bi(),na(la([qd,Jd,Qd,ep,np]))]),providerOptions:Xd.optional()}),ap=la([op,rp,ip,ra({role:ya("tool"),content:na(np),providerOptions:Xd.optional()})]);function sp({operationId:e,telemetry:t}){return{"operation.name":`${e}${null!=(null==t?void 0:t.functionId)?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}var lp={startSpan:()=>up,startActiveSpan:(e,t,n,o)=>"function"==typeof t?t(up):"function"==typeof n?n(up):"function"==typeof o?o(up):void 0},up={spanContext:()=>cp,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},cp={traceId:"",spanId:"",traceFlags:0};function dp({name:e,tracer:t,attributes:n,fn:o,endWhenDone:r=!0}){return t.startActiveSpan(e,{attributes:n},async e=>{try{const t=await o(e);return r&&e.end(),t}catch(t){try{pp(e,t)}finally{e.end()}throw t}})}function pp(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:Cc.ERROR,message:t.message})):e.setStatus({code:Cc.ERROR})}function hp({telemetry:e,attributes:t}){return!0!==(null==e?void 0:e.isEnabled)?{}:Object.entries(t).reduce((t,[n,o])=>{if(null==o)return t;if("object"==typeof o&&"input"in o&&"function"==typeof o.input){if(!1===(null==e?void 0:e.recordInputs))return t;const r=o.input();return null==r?t:{...t,[n]:r}}if("object"==typeof o&&"output"in o&&"function"==typeof o.output){if(!1===(null==e?void 0:e.recordOutputs))return t;const r=o.output();return null==r?t:{...t,[n]:r}}return{...t,[n]:o}},{})}function fp(e){return JSON.stringify(e.map(e=>({...e,content:"string"==typeof e.content?e.content:e.content.map(e=>{return"file"===e.type?{...e,data:e.data instanceof Uint8Array?(t=e.data,"string"==typeof t?t:t instanceof ArrayBuffer?ll(new Uint8Array(t)):ll(t)):e.data}:e;var t})})))}function mp(e,t){return null==e&&null==t?void 0:(null!=e?e:0)+(null!=t?t:0)}var gp=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:n=2,abortSignal:o}={})=>async r=>yp(r,{maxRetries:e,delayInMs:t,backoffFactor:n,abortSignal:o});async function yp(e,{maxRetries:t,delayInMs:n,backoffFactor:o,abortSignal:r},i=[]){try{return await e()}catch(a){if(Es(a))throw a;if(0===t)throw a;const s=Ss(a),l=[...i,a],u=l.length;if(u>t)throw new Rd({message:`Failed after ${u} attempts. Last error: ${s}`,reason:"maxRetriesExceeded",errors:l});if(a instanceof Error&&Qe.isInstance(a)&&!0===a.isRetryable&&u<=t)return await async function(e,t){if(null==e)return Promise.resolve();const n=null==t?void 0:t.abortSignal;return new Promise((t,o)=>{if(null==n?void 0:n.aborted)return void o(_s());const r=setTimeout(()=>{i(),t()},e),i=()=>{clearTimeout(r),null==n||n.removeEventListener("abort",a)},a=()=>{i(),o(_s())};null==n||n.addEventListener("abort",a)})}(function({error:e,exponentialBackoffDelay:t}){const n=e.responseHeaders;if(!n)return t;let o;const r=n["retry-after-ms"];if(r){const e=parseFloat(r);Number.isNaN(e)||(o=e)}const i=n["retry-after"];if(i&&void 0===o){const e=parseFloat(i);o=Number.isNaN(e)?Date.parse(i)-Date.now():1e3*e}return null!=o&&!Number.isNaN(o)&&0<=o&&(o<6e4||o<t)?o:t}({error:a,exponentialBackoffDelay:n}),{abortSignal:r}),yp(e,{maxRetries:t,delayInMs:o*n,backoffFactor:o,abortSignal:r},l);if(1===u)throw a;throw new Rd({message:`Failed after ${u} attempts with non-retryable error: '${s}'`,reason:"errorNotRetryable",errors:l})}}function vp(e){const t=e.filter(e=>"text"===e.type);if(0!==t.length)return t.map(e=>e.text).join("")}var bp=class{constructor({data:e,mediaType:t}){const n=e instanceof Uint8Array;this.base64Data=n?void 0:e,this.uint8ArrayData=n?e:void 0,this.mediaType=t}get base64(){return null==this.base64Data&&(this.base64Data=ll(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=sl(this.base64Data)),this.uint8ArrayData}};async function _p({toolCall:e,tools:t,repairToolCall:n,system:o,messages:r}){try{if(null==t)throw new md({toolName:e.toolName});try{return await wp({toolCall:e,tools:t})}catch(i){if(null==n||!md.isInstance(i)&&!id.isInstance(i))throw i;let s=null;try{s=await n({toolCall:e,tools:t,inputSchema:({toolName:e})=>{const{inputSchema:n}=t[e];return rl(n).jsonSchema},system:o,messages:r,error:i})}catch(a){throw new _d({cause:a,originalError:i})}if(null==s)throw i;return await wp({toolCall:s,tools:t})}}catch(i){return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,dynamic:!0,invalid:!0,error:i}}}async function wp({toolCall:e,tools:t}){const n=e.toolName,o=t[n];if(null==o)throw new md({toolName:e.toolName,availableTools:Object.keys(t)});const r=rl(o.inputSchema),i=""===e.input.trim()?await js({value:{},schema:r}):await Ls({text:e.input,schema:r});if(!1===i.success)throw new id({toolName:n,toolInput:e.input,cause:i.error});return"dynamic"===o.type?{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:i.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,dynamic:!0}:{type:"tool-call",toolCallId:e.toolCallId,toolName:n,input:i.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}}var xp=class{constructor({content:e,finishReason:t,usage:n,warnings:o,request:r,response:i,providerMetadata:a}){this.content=e,this.finishReason=t,this.usage=n,this.warnings=o,this.request=r,this.response=i,this.providerMetadata=a}get text(){return this.content.filter(e=>"text"===e.type).map(e=>e.text).join("")}get reasoning(){return this.content.filter(e=>"reasoning"===e.type)}get reasoningText(){return 0===this.reasoning.length?void 0:this.reasoning.map(e=>e.text).join("")}get files(){return this.content.filter(e=>"file"===e.type).map(e=>e.file)}get sources(){return this.content.filter(e=>"source"===e.type)}get toolCalls(){return this.content.filter(e=>"tool-call"===e.type)}get staticToolCalls(){return this.toolCalls.filter(e=>!1===e.dynamic)}get dynamicToolCalls(){return this.toolCalls.filter(e=>!0===e.dynamic)}get toolResults(){return this.content.filter(e=>"tool-result"===e.type)}get staticToolResults(){return this.toolResults.filter(e=>!1===e.dynamic)}get dynamicToolResults(){return this.toolResults.filter(e=>!0===e.dynamic)}};function kp(e){return({steps:t})=>t.length===e}async function Sp({stopConditions:e,steps:t}){return(await Promise.all(e.map(e=>e({steps:t})))).some(e=>e)}function Ep({output:e,tool:t,errorMode:n}){return"text"===n?{type:"error-text",value:it(e)}:"json"===n?{type:"error-json",value:Cp(e)}:(null==t?void 0:t.toModelOutput)?t.toModelOutput(e):"string"==typeof e?{type:"text",value:e}:{type:"json",value:Cp(e)}}function Cp(e){return void 0===e?null:e}function Np({content:e,tools:t}){const n=[],o=e.filter(e=>"source"!==e.type).filter(e=>("tool-result"!==e.type||e.providerExecuted)&&("tool-error"!==e.type||e.providerExecuted)).filter(e=>"text"!==e.type||e.text.length>0).map(e=>{switch(e.type){case"text":return{type:"text",text:e.text,providerOptions:e.providerMetadata};case"reasoning":return{type:"reasoning",text:e.text,providerOptions:e.providerMetadata};case"file":return{type:"file",data:e.file.base64,mediaType:e.file.mediaType,providerOptions:e.providerMetadata};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:e.providerMetadata};case"tool-result":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:Ep({tool:null==t?void 0:t[e.toolName],output:e.output,errorMode:"none"}),providerExecuted:!0,providerOptions:e.providerMetadata};case"tool-error":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:Ep({tool:null==t?void 0:t[e.toolName],output:e.error,errorMode:"json"}),providerOptions:e.providerMetadata}}});o.length>0&&n.push({role:"assistant",content:o});const r=e.filter(e=>"tool-result"===e.type||"tool-error"===e.type).filter(e=>!e.providerExecuted).map(e=>({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:Ep({tool:null==t?void 0:t[e.toolName],output:"tool-result"===e.type?e.output:e.error,errorMode:"tool-error"===e.type?"text":"none"})}));return r.length>0&&n.push({role:"tool",content:r}),n}var Ip=xs({prefix:"aitxt",size:24});async function Op({model:e,tools:t,toolChoice:n,system:o,prompt:r,messages:i,maxRetries:a,abortSignal:s,headers:l,stopWhen:u=kp(1),experimental_output:c,experimental_telemetry:d,providerOptions:p,experimental_activeTools:h,activeTools:f=h,experimental_prepareStep:m,prepareStep:g=m,experimental_repairToolCall:y,experimental_context:v,_internal:{generateId:b=Ip,currentDate:_=()=>new Date}={},onStepFinish:w,...x}){const k=Zd(e),S=void 0===(E=u)?[]:Array.isArray(E)?E:[E];var E;const{maxRetries:C,retry:N}=function({maxRetries:e,abortSignal:t}){if(null!=e){if(!Number.isInteger(e))throw new ed({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new ed({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}const n=null!=e?e:2;return{maxRetries:n,retry:gp({maxRetries:n,abortSignal:t})}}({maxRetries:a,abortSignal:s}),I=Yd(x),O=function({model:e,settings:t,telemetry:n,headers:o}){var r;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,n])=>(e[`ai.settings.${t}`]=n,e),{}),...Object.entries(null!=(r=null==n?void 0:n.metadata)?r:{}).reduce((e,[t,n])=>(e[`ai.telemetry.metadata.${t}`]=n,e),{}),...Object.entries(null!=o?o:{}).reduce((e,[t,n])=>(void 0!==n&&(e[`ai.request.headers.${t}`]=n),e),{})}}({model:k,telemetry:d,headers:l,settings:{...I,maxRetries:C}}),A=await async function(e){if(null==e.prompt&&null==e.messages)throw new mt({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new mt({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new mt({prompt:e,message:"system must be a string"});let t;if(null!=e.prompt&&"string"==typeof e.prompt)t=[{role:"user",content:e.prompt}];else if(null!=e.prompt&&Array.isArray(e.prompt))t=e.prompt;else{if(null==e.messages)throw new mt({prompt:e,message:"prompt or messages must be defined"});t=e.messages}if(0===t.length)throw new mt({prompt:e,message:"messages must not be empty"});const n=await js({value:t,schema:na(ap)});if(!n.success)throw new mt({prompt:e,message:"The messages must be a ModelMessage[]. If you have passed a UIMessage[], you can use convertToModelMessages to convert them.",cause:n.error});return{messages:t,system:e.system}}({system:o,prompt:r,messages:i}),P=function({isEnabled:e=!1,tracer:t}={}){return e?t||Hc.getTracer("ai"):lp}(d);try{return await dp({name:"ai.generateText",attributes:hp({telemetry:d,attributes:{...sp({operationId:"ai.generateText",telemetry:d}),...O,"ai.model.provider":k.provider,"ai.model.id":k.modelId,"ai.prompt":{input:()=>JSON.stringify({system:o,prompt:r,messages:i})}}}),tracer:P,fn:async e=>{var r,i,a,u,h,m;const E=Yd(x);let C,I=[],T=[];const M=[],z=[];do{const e=[...A.messages,...M],S=await(null==g?void 0:g({model:k,steps:z,stepNumber:z.length,messages:e})),$=await Ud({prompt:{system:null!=(r=null==S?void 0:S.system)?r:A.system,messages:null!=(i=null==S?void 0:S.messages)?i:e},supportedUrls:await k.supportedUrls}),R=Zd(null!=(a=null==S?void 0:S.model)?a:k),{toolChoice:Z,tools:j}=Kd({tools:t,toolChoice:null!=(u=null==S?void 0:S.toolChoice)?u:n,activeTools:null!=(h=null==S?void 0:S.activeTools)?h:f});C=await N(()=>{var e;return dp({name:"ai.generateText.doGenerate",attributes:hp({telemetry:d,attributes:{...sp({operationId:"ai.generateText.doGenerate",telemetry:d}),...O,"ai.model.provider":R.provider,"ai.model.id":R.modelId,"ai.prompt.messages":{input:()=>fp($)},"ai.prompt.tools":{input:()=>null==j?void 0:j.map(e=>JSON.stringify(e))},"ai.prompt.toolChoice":{input:()=>null!=Z?JSON.stringify(Z):void 0},"gen_ai.system":R.provider,"gen_ai.request.model":R.modelId,"gen_ai.request.frequency_penalty":x.frequencyPenalty,"gen_ai.request.max_tokens":x.maxOutputTokens,"gen_ai.request.presence_penalty":x.presencePenalty,"gen_ai.request.stop_sequences":x.stopSequences,"gen_ai.request.temperature":null!=(e=x.temperature)?e:void 0,"gen_ai.request.top_k":x.topK,"gen_ai.request.top_p":x.topP}}),tracer:P,fn:async e=>{var t,n,o,r,i,a,u,h;const f=await R.doGenerate({...E,tools:j,toolChoice:Z,responseFormat:null==c?void 0:c.responseFormat,prompt:$,providerOptions:p,abortSignal:s,headers:l}),m={id:null!=(n=null==(t=f.response)?void 0:t.id)?n:b(),timestamp:null!=(r=null==(o=f.response)?void 0:o.timestamp)?r:_(),modelId:null!=(a=null==(i=f.response)?void 0:i.modelId)?a:R.modelId,headers:null==(u=f.response)?void 0:u.headers,body:null==(h=f.response)?void 0:h.body};return e.setAttributes(hp({telemetry:d,attributes:{"ai.response.finishReason":f.finishReason,"ai.response.text":{output:()=>vp(f.content)},"ai.response.toolCalls":{output:()=>{const e=Tp(f.content);return null==e?void 0:JSON.stringify(e)}},"ai.response.id":m.id,"ai.response.model":m.modelId,"ai.response.timestamp":m.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(f.providerMetadata),"ai.usage.promptTokens":f.usage.inputTokens,"ai.usage.completionTokens":f.usage.outputTokens,"gen_ai.response.finish_reasons":[f.finishReason],"gen_ai.response.id":m.id,"gen_ai.response.model":m.modelId,"gen_ai.usage.input_tokens":f.usage.inputTokens,"gen_ai.usage.output_tokens":f.usage.outputTokens}})),{...f,response:m}}})});const D=await Promise.all(C.content.filter(e=>"tool-call"===e.type).map(n=>_p({toolCall:n,tools:t,repairToolCall:y,system:o,messages:e})));for(const n of D){if(n.invalid)continue;const o=t[n.toolName];null!=(null==o?void 0:o.onInputAvailable)&&await o.onInputAvailable({input:n.input,toolCallId:n.toolCallId,messages:e,abortSignal:s,experimental_context:v})}const L=D.filter(e=>e.invalid&&e.dynamic);T=[];for(const t of L)T.push({type:"tool-error",toolCallId:t.toolCallId,toolName:t.toolName,input:t.input,error:Ss(t.error),dynamic:!0});I=D.filter(e=>!e.providerExecuted),null!=t&&T.push(...await Ap({toolCalls:I.filter(e=>!e.invalid),tools:t,tracer:P,telemetry:d,messages:e,abortSignal:s,experimental_context:v}));const V=Mp({content:C.content,toolCalls:D,toolOutputs:T});M.push(...Np({content:V,tools:t}));const B=new xp({content:V,finishReason:C.finishReason,usage:C.usage,warnings:C.warnings,providerMetadata:C.providerMetadata,request:null!=(m=C.request)?m:{},response:{...C.response,messages:structuredClone(M)}});z.push(B),await(null==w?void 0:w(B))}while(I.length>0&&T.length===I.length&&!(await Sp({stopConditions:S,steps:z})));e.setAttributes(hp({telemetry:d,attributes:{"ai.response.finishReason":C.finishReason,"ai.response.text":{output:()=>vp(C.content)},"ai.response.toolCalls":{output:()=>{const e=Tp(C.content);return null==e?void 0:JSON.stringify(e)}},"ai.response.providerMetadata":JSON.stringify(C.providerMetadata),"ai.usage.promptTokens":C.usage.inputTokens,"ai.usage.completionTokens":C.usage.outputTokens}}));const $=z[z.length-1];return new Pp({steps:z,resolvedOutput:await(null==c?void 0:c.parseOutput({text:$.text},{response:$.response,usage:$.usage,finishReason:$.finishReason}))})}})}catch(T){throw function(e){return Pl.isInstance(e)||Hl.isInstance(e)?new Xe({name:"GatewayError",message:"Vercel AI Gateway access failed. If you want to use AI SDK providers directly, use the providers, e.g. @ai-sdk/openai, or register a different global default provider.",cause:e}):e}(T)}}async function Ap({toolCalls:e,tools:t,tracer:n,telemetry:o,messages:r,abortSignal:i,experimental_context:a}){return(await Promise.all(e.map(async({toolCallId:e,toolName:s,input:l})=>{const u=t[s];if(null!=(null==u?void 0:u.execute))return dp({name:"ai.toolCall",attributes:hp({telemetry:o,attributes:{...sp({operationId:"ai.toolCall",telemetry:o}),"ai.toolCall.name":s,"ai.toolCall.id":e,"ai.toolCall.args":{output:()=>JSON.stringify(l)}}}),tracer:n,fn:async t=>{try{const c=await u.execute(l,{toolCallId:e,messages:r,abortSignal:i,experimental_context:a});try{t.setAttributes(hp({telemetry:o,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(c)}}}))}catch(n){}return{type:"tool-result",toolCallId:e,toolName:s,input:l,output:c,dynamic:"dynamic"===u.type}}catch(c){return pp(t,c),{type:"tool-error",toolCallId:e,toolName:s,input:l,error:c,dynamic:"dynamic"===u.type}}}})}))).filter(e=>null!=e)}var Pp=class{constructor(e){this.steps=e.steps,this.resolvedOutput=e.resolvedOutput}get finalStep(){return this.steps[this.steps.length-1]}get content(){return this.finalStep.content}get text(){return this.finalStep.text}get files(){return this.finalStep.files}get reasoningText(){return this.finalStep.reasoningText}get reasoning(){return this.finalStep.reasoning}get toolCalls(){return this.finalStep.toolCalls}get staticToolCalls(){return this.finalStep.staticToolCalls}get dynamicToolCalls(){return this.finalStep.dynamicToolCalls}get toolResults(){return this.finalStep.toolResults}get staticToolResults(){return this.finalStep.staticToolResults}get dynamicToolResults(){return this.finalStep.dynamicToolResults}get sources(){return this.finalStep.sources}get finishReason(){return this.finalStep.finishReason}get warnings(){return this.finalStep.warnings}get providerMetadata(){return this.finalStep.providerMetadata}get response(){return this.finalStep.response}get request(){return this.finalStep.request}get usage(){return this.finalStep.usage}get totalUsage(){return this.steps.reduce((e,t)=>{return n=e,o=t.usage,{inputTokens:mp(n.inputTokens,o.inputTokens),outputTokens:mp(n.outputTokens,o.outputTokens),totalTokens:mp(n.totalTokens,o.totalTokens),reasoningTokens:mp(n.reasoningTokens,o.reasoningTokens),cachedInputTokens:mp(n.cachedInputTokens,o.cachedInputTokens)};var n,o},{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0,reasoningTokens:void 0,cachedInputTokens:void 0})}get experimental_output(){if(null==this.resolvedOutput)throw new Xc;return this.resolvedOutput}};function Tp(e){const t=e.filter(e=>"tool-call"===e.type);if(0!==t.length)return t.map(e=>({toolCallId:e.toolCallId,toolName:e.toolName,input:e.input}))}function Mp({content:e,toolCalls:t,toolOutputs:n}){return[...e.map(e=>{switch(e.type){case"text":case"reasoning":case"source":return e;case"file":return{type:"file",file:new bp(e)};case"tool-call":return t.find(t=>t.toolCallId===e.toolCallId);case"tool-result":{const n=t.find(t=>t.toolCallId===e.toolCallId);if(null==n)throw new Error(`Tool call ${e.toolCallId} not found.`);return e.isError?{type:"tool-error",toolCallId:e.toolCallId,toolName:e.toolName,input:n.input,error:e.result,providerExecuted:!0,dynamic:n.dynamic}:{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,input:n.input,output:e.result,providerExecuted:!0,dynamic:n.dynamic}}}}),...n]}function zp(e){const t=["ROOT"];let n=-1,o=null;function r(e,r,i){switch(e){case'"':n=r,t.pop(),t.push(i),t.push("INSIDE_STRING");break;case"f":case"t":case"n":n=r,o=r,t.pop(),t.push(i),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(i),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n=r,t.pop(),t.push(i),t.push("INSIDE_NUMBER");break;case"{":n=r,t.pop(),t.push(i),t.push("INSIDE_OBJECT_START");break;case"[":n=r,t.pop(),t.push(i),t.push("INSIDE_ARRAY_START")}}function i(e,o){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":n=o,t.pop()}}function a(e,o){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":n=o,t.pop()}}for(let l=0;l<e.length;l++){const s=e[l];switch(t[t.length-1]){case"ROOT":r(s,l,"FINISH");break;case"INSIDE_OBJECT_START":switch(s){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":n=l,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":if('"'===s)t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"INSIDE_OBJECT_KEY":if('"'===s)t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break;case"INSIDE_OBJECT_AFTER_KEY":if(":"===s)t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break;case"INSIDE_OBJECT_BEFORE_VALUE":r(s,l,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":i(s,l);break;case"INSIDE_STRING":switch(s){case'"':t.pop(),n=l;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:n=l}break;case"INSIDE_ARRAY_START":if("]"===s)n=l,t.pop();else n=l,r(s,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_ARRAY_AFTER_VALUE":switch(s){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":n=l,t.pop();break;default:n=l}break;case"INSIDE_ARRAY_AFTER_COMMA":r(s,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),n=l;break;case"INSIDE_NUMBER":switch(s){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n=l;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&a(s,l),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&i(s,l);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&i(s,l);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&a(s,l);break;default:t.pop()}break;case"INSIDE_LITERAL":{const r=e.substring(o,l+1);"false".startsWith(r)||"true".startsWith(r)||"null".startsWith(r)?n=l:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?i(s,l):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&a(s,l));break}}}let s=e.slice(0,n+1);for(let l=t.length-1;l>=0;l--){switch(t[l]){case"INSIDE_STRING":s+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":s+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":s+="]";break;case"INSIDE_LITERAL":{const t=e.substring(o,e.length);"true".startsWith(t)?s+="true".slice(t.length):"false".startsWith(t)?s+="false".slice(t.length):"null".startsWith(t)&&(s+="null".slice(t.length))}}}return s}TransformStream,la([ia({type:ya("text-start"),id:bi(),providerMetadata:Xd.optional()}),ia({type:ya("text-delta"),id:bi(),delta:bi(),providerMetadata:Xd.optional()}),ia({type:ya("text-end"),id:bi(),providerMetadata:Xd.optional()}),ia({type:ya("error"),errorText:bi()}),ia({type:ya("tool-input-start"),toolCallId:bi(),toolName:bi(),providerExecuted:Yi().optional(),dynamic:Yi().optional()}),ia({type:ya("tool-input-delta"),toolCallId:bi(),inputTextDelta:bi()}),ia({type:ya("tool-input-available"),toolCallId:bi(),toolName:bi(),input:Ji(),providerExecuted:Yi().optional(),providerMetadata:Xd.optional(),dynamic:Yi().optional()}),ia({type:ya("tool-input-error"),toolCallId:bi(),toolName:bi(),input:Ji(),providerExecuted:Yi().optional(),providerMetadata:Xd.optional(),dynamic:Yi().optional(),errorText:bi()}),ia({type:ya("tool-output-available"),toolCallId:bi(),output:Ji(),providerExecuted:Yi().optional(),dynamic:Yi().optional()}),ia({type:ya("tool-output-error"),toolCallId:bi(),errorText:bi(),providerExecuted:Yi().optional(),dynamic:Yi().optional()}),ia({type:ya("reasoning"),text:bi(),providerMetadata:Xd.optional()}),ia({type:ya("reasoning-start"),id:bi(),providerMetadata:Xd.optional()}),ia({type:ya("reasoning-delta"),id:bi(),delta:bi(),providerMetadata:Xd.optional()}),ia({type:ya("reasoning-end"),id:bi(),providerMetadata:Xd.optional()}),ia({type:ya("reasoning-part-finish")}),ia({type:ya("source-url"),sourceId:bi(),url:bi(),title:bi().optional(),providerMetadata:Xd.optional()}),ia({type:ya("source-document"),sourceId:bi(),mediaType:bi(),title:bi(),filename:bi().optional(),providerMetadata:Xd.optional()}),ia({type:ya("file"),url:bi(),mediaType:bi(),providerMetadata:Xd.optional()}),ia({type:bi().startsWith("data-"),id:bi().optional(),data:Ji(),transient:Yi().optional()}),ia({type:ya("start-step")}),ia({type:ya("finish-step")}),ia({type:ya("start"),messageId:bi().optional(),messageMetadata:Ji().optional()}),ia({type:ya("finish"),messageMetadata:Ji().optional()}),ia({type:ya("abort")}),ia({type:ya("message-metadata"),messageMetadata:Ji()})]),xs({prefix:"aitxt",size:24}),xs({prefix:"aiobj",size:24}),xs({prefix:"aiobj",size:24});((e,t)=>{for(var n in t)Uc(e,n,{get:t[n],enumerable:!0})})({},{object:()=>Rp,text:()=>$p});var $p=()=>({type:"text",responseFormat:{type:"text"},parsePartial:async({text:e})=>({partial:e}),parseOutput:async({text:e})=>e}),Rp=({schema:e})=>{const t=rl(e);return{type:"object",responseFormat:{type:"json",schema:t.jsonSchema},async parsePartial({text:e}){const t=await async function(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=await Ls({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await Ls({text:zp(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{const e=t.state;throw new Error(`Unsupported parse state: ${e}`)}}},async parseOutput({text:e},n){const o=await Ls({text:e});if(!o.success)throw new cd({message:"No object generated: could not parse the response.",cause:o.error,text:e,response:n.response,usage:n.usage,finishReason:n.finishReason});const r=await js({value:o.value,schema:t});if(!r.success)throw new cd({message:"No object generated: response did not match schema.",cause:r.error,text:e,response:n.response,usage:n.usage,finishReason:n.finishReason});return r.value}}},Zp=aa({name:bi(),version:bi()}),jp=aa({_meta:_a(ra({}).loose())}),Dp=jp,Lp=ra({method:bi(),params:_a(jp)}),Vp=aa({experimental:_a(ra({}).loose()),logging:_a(ra({}).loose()),prompts:_a(aa({listChanged:_a(Yi())})),resources:_a(aa({subscribe:_a(Yi()),listChanged:_a(Yi())})),tools:_a(aa({listChanged:_a(Yi())}))});Dp.extend({protocolVersion:bi(),capabilities:Vp,serverInfo:Zp,instructions:_a(bi())});var Bp=Dp.extend({nextCursor:_a(bi())}),Fp=ra({name:bi(),description:_a(bi()),inputSchema:ra({type:ya("object"),properties:_a(ra({}).loose())}).loose()}).loose();Bp.extend({tools:na(Fp)});var Hp=ra({type:ya("text"),text:bi()}).loose(),Up=ra({type:ya("image"),data:Zi(),mimeType:bi()}).loose(),Yp=ra({uri:bi(),mimeType:_a(bi())}).loose(),Kp=Yp.extend({text:bi()}),Wp=Yp.extend({blob:Zi()}),Xp=ra({type:ya("resource"),resource:la([Kp,Wp])}).loose();Dp.extend({content:na(la([Hp,Up,Xp])),isError:Yi().default(!1).optional()}).or(Dp.extend({toolResult:Ji()}));var qp="2.0",Gp=ra({jsonrpc:ya(qp),id:la([bi(),Bi().int()])}).merge(Lp).strict(),Jp=ra({jsonrpc:ya(qp),id:la([bi(),Bi().int()]),result:Dp}).strict(),Qp=ra({jsonrpc:ya(qp),id:la([bi(),Bi().int()]),error:ra({code:Bi().int(),message:bi(),data:_a(Ji())})}).strict();function eh(e){if("string"==typeof e||"number"==typeof e)return""+e;let t="";if(Array.isArray(e))for(let n,o=0;o<e.length;o++)""!==(n=eh(e[o]))&&(t+=(t&&" ")+n);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}la([Gp,ra({jsonrpc:ya(qp)}).merge(ra({method:bi(),params:_a(jp)})).strict(),Jp,Qp]);var th={value:()=>{}};function nh(){for(var e,t=0,n=arguments.length,o={};t<n;++t){if(!(e=arguments[t]+"")||e in o||/[\s.]/.test(e))throw new Error("illegal type: "+e);o[e]=[]}return new oh(o)}function oh(e){this._=e}function rh(e,t){for(var n,o=0,r=e.length;o<r;++o)if((n=e[o]).name===t)return n.value}function ih(e,t,n){for(var o=0,r=e.length;o<r;++o)if(e[o].name===t){e[o]=th,e=e.slice(0,o).concat(e.slice(o+1));break}return null!=n&&e.push({name:t,value:n}),e}oh.prototype=nh.prototype={constructor:oh,on:function(e,t){var n,o,r=this._,i=(o=r,(e+"").trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");if(n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),e&&!o.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:t}})),a=-1,s=i.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++a<s;)if(n=(e=i[a]).type)r[n]=ih(r[n],e.name,t);else if(null==t)for(n in r)r[n]=ih(r[n],e.name,null);return this}for(;++a<s;)if((n=(e=i[a]).type)&&(n=rh(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new oh(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,o,r=new Array(n),i=0;i<n;++i)r[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=0,n=(o=this._[e]).length;i<n;++i)o[i].value.apply(t,r)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var o=this._[e],r=0,i=o.length;r<i;++r)o[r].value.apply(t,n)}};var ah="http://www.w3.org/1999/xhtml";const sh={svg:"http://www.w3.org/2000/svg",xhtml:ah,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function lh(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),sh.hasOwnProperty(t)?{space:sh[t],local:e}:e}function uh(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===ah&&t.documentElement.namespaceURI===ah?t.createElement(e):t.createElementNS(n,e)}}function ch(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function dh(e){var t=lh(e);return(t.local?ch:uh)(t)}function ph(){}function hh(e){return null==e?ph:function(){return this.querySelector(e)}}function fh(){return[]}function mh(e){return null==e?fh:function(){return this.querySelectorAll(e)}}function gh(e){return function(){return null==(t=e.apply(this,arguments))?[]:Array.isArray(t)?t:Array.from(t);var t}}function yh(e){return function(){return this.matches(e)}}function vh(e){return function(t){return t.matches(e)}}var bh=Array.prototype.find;function _h(){return this.firstElementChild}var wh=Array.prototype.filter;function xh(){return Array.from(this.children)}function kh(e){return new Array(e.length)}function Sh(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function Eh(e,t,n,o,r,i){for(var a,s=0,l=t.length,u=i.length;s<u;++s)(a=t[s])?(a.__data__=i[s],o[s]=a):n[s]=new Sh(e,i[s]);for(;s<l;++s)(a=t[s])&&(r[s]=a)}function Ch(e,t,n,o,r,i,a){var s,l,u,c=new Map,d=t.length,p=i.length,h=new Array(d);for(s=0;s<d;++s)(l=t[s])&&(h[s]=u=a.call(l,l.__data__,s,t)+"",c.has(u)?r[s]=l:c.set(u,l));for(s=0;s<p;++s)u=a.call(e,i[s],s,i)+"",(l=c.get(u))?(o[s]=l,l.__data__=i[s],c.delete(u)):n[s]=new Sh(e,i[s]);for(s=0;s<d;++s)(l=t[s])&&c.get(h[s])===l&&(r[s]=l)}function Nh(e){return e.__data__}function Ih(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function Oh(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Ah(e){return function(){this.removeAttribute(e)}}function Ph(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Th(e,t){return function(){this.setAttribute(e,t)}}function Mh(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function zh(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function $h(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Rh(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Zh(e){return function(){this.style.removeProperty(e)}}function jh(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Dh(e,t,n){return function(){var o=t.apply(this,arguments);null==o?this.style.removeProperty(e):this.style.setProperty(e,o,n)}}function Lh(e,t){return e.style.getPropertyValue(t)||Rh(e).getComputedStyle(e,null).getPropertyValue(t)}function Vh(e){return function(){delete this[e]}}function Bh(e,t){return function(){this[e]=t}}function Fh(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function Hh(e){return e.trim().split(/^|\s+/)}function Uh(e){return e.classList||new Yh(e)}function Yh(e){this._node=e,this._names=Hh(e.getAttribute("class")||"")}function Kh(e,t){for(var n=Uh(e),o=-1,r=t.length;++o<r;)n.add(t[o])}function Wh(e,t){for(var n=Uh(e),o=-1,r=t.length;++o<r;)n.remove(t[o])}function Xh(e){return function(){Kh(this,e)}}function qh(e){return function(){Wh(this,e)}}function Gh(e,t){return function(){(t.apply(this,arguments)?Kh:Wh)(this,e)}}function Jh(){this.textContent=""}function Qh(e){return function(){this.textContent=e}}function ef(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function tf(){this.innerHTML=""}function nf(e){return function(){this.innerHTML=e}}function of(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function rf(){this.nextSibling&&this.parentNode.appendChild(this)}function af(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function sf(){return null}function lf(){var e=this.parentNode;e&&e.removeChild(this)}function uf(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function cf(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function df(e){return function(){var t=this.__on;if(t){for(var n,o=0,r=-1,i=t.length;o<i;++o)n=t[o],e.type&&n.type!==e.type||n.name!==e.name?t[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?t.length=r:delete this.__on}}}function pf(e,t,n){return function(){var o,r=this.__on,i=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(r)for(var a=0,s=r.length;a<s;++a)if((o=r[a]).type===e.type&&o.name===e.name)return this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=i,o.options=n),void(o.value=t);this.addEventListener(e.type,i,n),o={type:e.type,name:e.name,value:t,listener:i,options:n},r?r.push(o):this.__on=[o]}}function hf(e,t,n){var o=Rh(e),r=o.CustomEvent;"function"==typeof r?r=new r(t,n):(r=o.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function ff(e,t){return function(){return hf(this,e,t)}}function mf(e,t){return function(){return hf(this,e,t.apply(this,arguments))}}Sh.prototype={constructor:Sh,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}},Yh.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var gf=[null];function yf(e,t){this._groups=e,this._parents=t}function vf(){return new yf([[document.documentElement]],gf)}function bf(e){return"string"==typeof e?new yf([[document.querySelector(e)]],[document.documentElement]):new yf([[e]],gf)}function _f(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var o=n.createSVGPoint();return o.x=e.clientX,o.y=e.clientY,[(o=o.matrixTransform(t.getScreenCTM().inverse())).x,o.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}yf.prototype=vf.prototype={constructor:yf,select:function(e){"function"!=typeof e&&(e=hh(e));for(var t=this._groups,n=t.length,o=new Array(n),r=0;r<n;++r)for(var i,a,s=t[r],l=s.length,u=o[r]=new Array(l),c=0;c<l;++c)(i=s[c])&&(a=e.call(i,i.__data__,c,s))&&("__data__"in i&&(a.__data__=i.__data__),u[c]=a);return new yf(o,this._parents)},selectAll:function(e){e="function"==typeof e?gh(e):mh(e);for(var t=this._groups,n=t.length,o=[],r=[],i=0;i<n;++i)for(var a,s=t[i],l=s.length,u=0;u<l;++u)(a=s[u])&&(o.push(e.call(a,a.__data__,u,s)),r.push(a));return new yf(o,r)},selectChild:function(e){return this.select(null==e?_h:function(e){return function(){return bh.call(this.children,e)}}("function"==typeof e?e:vh(e)))},selectChildren:function(e){return this.selectAll(null==e?xh:function(e){return function(){return wh.call(this.children,e)}}("function"==typeof e?e:vh(e)))},filter:function(e){"function"!=typeof e&&(e=yh(e));for(var t=this._groups,n=t.length,o=new Array(n),r=0;r<n;++r)for(var i,a=t[r],s=a.length,l=o[r]=[],u=0;u<s;++u)(i=a[u])&&e.call(i,i.__data__,u,a)&&l.push(i);return new yf(o,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,Nh);var n,o=t?Ch:Eh,r=this._parents,i=this._groups;"function"!=typeof e&&(n=e,e=function(){return n});for(var a=i.length,s=new Array(a),l=new Array(a),u=new Array(a),c=0;c<a;++c){var d=r[c],p=i[c],h=p.length,f=Ih(e.call(d,d&&d.__data__,c,r)),m=f.length,g=l[c]=new Array(m),y=s[c]=new Array(m);o(d,p,g,y,u[c]=new Array(h),f,t);for(var v,b,_=0,w=0;_<m;++_)if(v=g[_]){for(_>=w&&(w=_+1);!(b=y[w])&&++w<m;);v._next=b||null}}return(s=new yf(s,r))._enter=l,s._exit=u,s},enter:function(){return new yf(this._enter||this._groups.map(kh),this._parents)},exit:function(){return new yf(this._exit||this._groups.map(kh),this._parents)},join:function(e,t,n){var o=this.enter(),r=this,i=this.exit();return"function"==typeof e?(o=e(o))&&(o=o.selection()):o=o.append(e+""),null!=t&&(r=t(r))&&(r=r.selection()),null==n?i.remove():n(i),o&&r?o.merge(r).order():r},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,o=t._groups,r=n.length,i=o.length,a=Math.min(r,i),s=new Array(r),l=0;l<a;++l)for(var u,c=n[l],d=o[l],p=c.length,h=s[l]=new Array(p),f=0;f<p;++f)(u=c[f]||d[f])&&(h[f]=u);for(;l<r;++l)s[l]=n[l];return new yf(s,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var o,r=e[t],i=r.length-1,a=r[i];--i>=0;)(o=r[i])&&(a&&4^o.compareDocumentPosition(a)&&a.parentNode.insertBefore(o,a),a=o);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=Oh);for(var n=this._groups,o=n.length,r=new Array(o),i=0;i<o;++i){for(var a,s=n[i],l=s.length,u=r[i]=new Array(l),c=0;c<l;++c)(a=s[c])&&(u[c]=a);u.sort(t)}return new yf(r,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var o=e[t],r=0,i=o.length;r<i;++r){var a=o[r];if(a)return a}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,o=t.length;n<o;++n)for(var r,i=t[n],a=0,s=i.length;a<s;++a)(r=i[a])&&e.call(r,r.__data__,a,i);return this},attr:function(e,t){var n=lh(e);if(arguments.length<2){var o=this.node();return n.local?o.getAttributeNS(n.space,n.local):o.getAttribute(n)}return this.each((null==t?n.local?Ph:Ah:"function"==typeof t?n.local?$h:zh:n.local?Mh:Th)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?Zh:"function"==typeof t?Dh:jh)(e,t,null==n?"":n)):Lh(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?Vh:"function"==typeof t?Fh:Bh)(e,t)):this.node()[e]},classed:function(e,t){var n=Hh(e+"");if(arguments.length<2){for(var o=Uh(this.node()),r=-1,i=n.length;++r<i;)if(!o.contains(n[r]))return!1;return!0}return this.each(("function"==typeof t?Gh:t?Xh:qh)(n,t))},text:function(e){return arguments.length?this.each(null==e?Jh:("function"==typeof e?ef:Qh)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?tf:("function"==typeof e?of:nf)(e)):this.node().innerHTML},raise:function(){return this.each(rf)},lower:function(){return this.each(af)},append:function(e){var t="function"==typeof e?e:dh(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"==typeof e?e:dh(e),o=null==t?sf:"function"==typeof t?t:hh(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),o.apply(this,arguments)||null)})},remove:function(){return this.each(lf)},clone:function(e){return this.select(e?cf:uf)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var o,r,i=function(e){return e.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}(e+""),a=i.length;if(!(arguments.length<2)){for(s=t?pf:df,o=0;o<a;++o)this.each(s(i[o],t,n));return this}var s=this.node().__on;if(s)for(var l,u=0,c=s.length;u<c;++u)for(o=0,l=s[u];o<a;++o)if((r=i[o]).type===l.type&&r.name===l.name)return l.value},dispatch:function(e,t){return this.each(("function"==typeof t?mf:ff)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var o,r=e[t],i=0,a=r.length;i<a;++i)(o=r[i])&&(yield o)}};const wf={passive:!1},xf={capture:!0,passive:!1};function kf(e){e.stopImmediatePropagation()}function Sf(e){e.preventDefault(),e.stopImmediatePropagation()}function Ef(e){var t=e.document.documentElement,n=bf(e).on("dragstart.drag",Sf,xf);"onselectstart"in t?n.on("selectstart.drag",Sf,xf):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Cf(e,t){var n=e.document.documentElement,o=bf(e).on("dragstart.drag",null);t&&(o.on("click.drag",Sf,xf),setTimeout(function(){o.on("click.drag",null)},0)),"onselectstart"in n?o.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Nf=e=>()=>e;function If(e,{sourceEvent:t,subject:n,target:o,identifier:r,active:i,x:a,y:s,dx:l,dy:u,dispatch:c}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:o,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:s,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:c}})}function Of(e){return!e.ctrlKey&&!e.button}function Af(){return this.parentNode}function Pf(e,t){return null==t?{x:e.x,y:e.y}:t}function Tf(){return navigator.maxTouchPoints||"ontouchstart"in this}function Mf(){var e,t,n,o,r=Of,i=Af,a=Pf,s=Tf,l={},u=nh("start","drag","end"),c=0,d=0;function p(e){e.on("mousedown.drag",h).filter(s).on("touchstart.drag",g).on("touchmove.drag",y,wf).on("touchend.drag touchcancel.drag",v).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function h(a,s){if(!o&&r.call(this,a,s)){var l=b(this,i.call(this,a,s),a,s,"mouse");l&&(bf(a.view).on("mousemove.drag",f,xf).on("mouseup.drag",m,xf),Ef(a.view),kf(a),n=!1,e=a.clientX,t=a.clientY,l("start",a))}}function f(o){if(Sf(o),!n){var r=o.clientX-e,i=o.clientY-t;n=r*r+i*i>d}l.mouse("drag",o)}function m(e){bf(e.view).on("mousemove.drag mouseup.drag",null),Cf(e.view,n),Sf(e),l.mouse("end",e)}function g(e,t){if(r.call(this,e,t)){var n,o,a=e.changedTouches,s=i.call(this,e,t),l=a.length;for(n=0;n<l;++n)(o=b(this,s,e,t,a[n].identifier,a[n]))&&(kf(e),o("start",e,a[n]))}}function y(e){var t,n,o=e.changedTouches,r=o.length;for(t=0;t<r;++t)(n=l[o[t].identifier])&&(Sf(e),n("drag",e,o[t]))}function v(e){var t,n,r=e.changedTouches,i=r.length;for(o&&clearTimeout(o),o=setTimeout(function(){o=null},500),t=0;t<i;++t)(n=l[r[t].identifier])&&(kf(e),n("end",e,r[t]))}function b(e,t,n,o,r,i){var s,d,h,f=u.copy(),m=_f(i||n,t);if(null!=(h=a.call(e,new If("beforestart",{sourceEvent:n,target:p,identifier:r,active:c,x:m[0],y:m[1],dx:0,dy:0,dispatch:f}),o)))return s=h.x-m[0]||0,d=h.y-m[1]||0,function n(i,a,u){var g,y=m;switch(i){case"start":l[r]=n,g=c++;break;case"end":delete l[r],--c;case"drag":m=_f(u||a,t),g=c}f.call(i,e,new If(i,{sourceEvent:a,subject:h,target:p,identifier:r,active:g,x:m[0]+s,y:m[1]+d,dx:m[0]-y[0],dy:m[1]-y[1],dispatch:f}),o)}}return p.filter=function(e){return arguments.length?(r="function"==typeof e?e:Nf(!!e),p):r},p.container=function(e){return arguments.length?(i="function"==typeof e?e:Nf(e),p):i},p.subject=function(e){return arguments.length?(a="function"==typeof e?e:Nf(e),p):a},p.touchable=function(e){return arguments.length?(s="function"==typeof e?e:Nf(!!e),p):s},p.on=function(){var e=u.on.apply(u,arguments);return e===u?p:e},p.clickDistance=function(e){return arguments.length?(d=(e=+e)*e,p):Math.sqrt(d)},p}function zf(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function $f(e,t){var n=Object.create(e.prototype);for(var o in t)n[o]=t[o];return n}function Rf(){}If.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};var Zf=.7,jf=1/Zf,Df="\\s*([+-]?\\d+)\\s*",Lf="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Vf="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Bf=/^#([0-9a-f]{3,8})$/,Ff=new RegExp(`^rgb\\(${Df},${Df},${Df}\\)$`),Hf=new RegExp(`^rgb\\(${Vf},${Vf},${Vf}\\)$`),Uf=new RegExp(`^rgba\\(${Df},${Df},${Df},${Lf}\\)$`),Yf=new RegExp(`^rgba\\(${Vf},${Vf},${Vf},${Lf}\\)$`),Kf=new RegExp(`^hsl\\(${Lf},${Vf},${Vf}\\)$`),Wf=new RegExp(`^hsla\\(${Lf},${Vf},${Vf},${Lf}\\)$`),Xf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function qf(){return this.rgb().formatHex()}function Gf(){return this.rgb().formatRgb()}function Jf(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Bf.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Qf(t):3===n?new nm(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?em(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?em(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Ff.exec(e))?new nm(t[1],t[2],t[3],1):(t=Hf.exec(e))?new nm(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Uf.exec(e))?em(t[1],t[2],t[3],t[4]):(t=Yf.exec(e))?em(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Kf.exec(e))?lm(t[1],t[2]/100,t[3]/100,1):(t=Wf.exec(e))?lm(t[1],t[2]/100,t[3]/100,t[4]):Xf.hasOwnProperty(e)?Qf(Xf[e]):"transparent"===e?new nm(NaN,NaN,NaN,0):null}function Qf(e){return new nm(e>>16&255,e>>8&255,255&e,1)}function em(e,t,n,o){return o<=0&&(e=t=n=NaN),new nm(e,t,n,o)}function tm(e,t,n,o){return 1===arguments.length?((r=e)instanceof Rf||(r=Jf(r)),r?new nm((r=r.rgb()).r,r.g,r.b,r.opacity):new nm):new nm(e,t,n,null==o?1:o);var r}function nm(e,t,n,o){this.r=+e,this.g=+t,this.b=+n,this.opacity=+o}function om(){return`#${sm(this.r)}${sm(this.g)}${sm(this.b)}`}function rm(){const e=im(this.opacity);return`${1===e?"rgb(":"rgba("}${am(this.r)}, ${am(this.g)}, ${am(this.b)}${1===e?")":`, ${e})`}`}function im(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function am(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function sm(e){return((e=am(e))<16?"0":"")+e.toString(16)}function lm(e,t,n,o){return o<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new cm(e,t,n,o)}function um(e){if(e instanceof cm)return new cm(e.h,e.s,e.l,e.opacity);if(e instanceof Rf||(e=Jf(e)),!e)return new cm;if(e instanceof cm)return e;var t=(e=e.rgb()).r/255,n=e.g/255,o=e.b/255,r=Math.min(t,n,o),i=Math.max(t,n,o),a=NaN,s=i-r,l=(i+r)/2;return s?(a=t===i?(n-o)/s+6*(n<o):n===i?(o-t)/s+2:(t-n)/s+4,s/=l<.5?i+r:2-i-r,a*=60):s=l>0&&l<1?0:a,new cm(a,s,l,e.opacity)}function cm(e,t,n,o){this.h=+e,this.s=+t,this.l=+n,this.opacity=+o}function dm(e){return(e=(e||0)%360)<0?e+360:e}function pm(e){return Math.max(0,Math.min(1,e||0))}function hm(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}zf(Rf,Jf,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:qf,formatHex:qf,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return um(this).formatHsl()},formatRgb:Gf,toString:Gf}),zf(nm,tm,$f(Rf,{brighter(e){return e=null==e?jf:Math.pow(jf,e),new nm(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?Zf:Math.pow(Zf,e),new nm(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new nm(am(this.r),am(this.g),am(this.b),im(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:om,formatHex:om,formatHex8:function(){return`#${sm(this.r)}${sm(this.g)}${sm(this.b)}${sm(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:rm,toString:rm})),zf(cm,function(e,t,n,o){return 1===arguments.length?um(e):new cm(e,t,n,null==o?1:o)},$f(Rf,{brighter(e){return e=null==e?jf:Math.pow(jf,e),new cm(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?Zf:Math.pow(Zf,e),new cm(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,o=n+(n<.5?n:1-n)*t,r=2*n-o;return new nm(hm(e>=240?e-240:e+120,r,o),hm(e,r,o),hm(e<120?e+240:e-120,r,o),this.opacity)},clamp(){return new cm(dm(this.h),pm(this.s),pm(this.l),im(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=im(this.opacity);return`${1===e?"hsl(":"hsla("}${dm(this.h)}, ${100*pm(this.s)}%, ${100*pm(this.l)}%${1===e?")":`, ${e})`}`}}));const fm=e=>()=>e;function mm(e){return 1===(e=+e)?gm:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(o){return Math.pow(e+o*t,n)}}(t,n,e):fm(isNaN(t)?n:t)}}function gm(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):fm(isNaN(e)?t:e)}const ym=function e(t){var n=mm(t);function o(e,t){var o=n((e=tm(e)).r,(t=tm(t)).r),r=n(e.g,t.g),i=n(e.b,t.b),a=gm(e.opacity,t.opacity);return function(t){return e.r=o(t),e.g=r(t),e.b=i(t),e.opacity=a(t),e+""}}return o.gamma=e,o}(1);function vm(e,t){t||(t=[]);var n,o=e?Math.min(t.length,e.length):0,r=t.slice();return function(i){for(n=0;n<o;++n)r[n]=e[n]*(1-i)+t[n]*i;return r}}function bm(e,t){var n,o=t?t.length:0,r=e?Math.min(o,e.length):0,i=new Array(r),a=new Array(o);for(n=0;n<r;++n)i[n]=Cm(e[n],t[n]);for(;n<o;++n)a[n]=t[n];return function(e){for(n=0;n<r;++n)a[n]=i[n](e);return a}}function _m(e,t){var n=new Date;return e=+e,t=+t,function(o){return n.setTime(e*(1-o)+t*o),n}}function wm(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function xm(e,t){var n,o={},r={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?o[n]=Cm(e[n],t[n]):r[n]=t[n];return function(e){for(n in o)r[n]=o[n](e);return r}}var km=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Sm=new RegExp(km.source,"g");function Em(e,t){var n,o,r,i=km.lastIndex=Sm.lastIndex=0,a=-1,s=[],l=[];for(e+="",t+="";(n=km.exec(e))&&(o=Sm.exec(t));)(r=o.index)>i&&(r=t.slice(i,r),s[a]?s[a]+=r:s[++a]=r),(n=n[0])===(o=o[0])?s[a]?s[a]+=o:s[++a]=o:(s[++a]=null,l.push({i:a,x:wm(n,o)})),i=Sm.lastIndex;return i<t.length&&(r=t.slice(i),s[a]?s[a]+=r:s[++a]=r),s.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,o=0;o<t;++o)s[(n=l[o]).i]=n.x(e);return s.join("")})}function Cm(e,t){var n,o,r=typeof t;return null==t||"boolean"===r?fm(t):("number"===r?wm:"string"===r?(n=Jf(t))?(t=n,ym):Em:t instanceof Jf?ym:t instanceof Date?_m:(o=t,!ArrayBuffer.isView(o)||o instanceof DataView?Array.isArray(t)?bm:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?xm:wm:vm))(e,t)}var Nm,Im=180/Math.PI,Om={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Am(e,t,n,o,r,i){var a,s,l;return(a=Math.sqrt(e*e+t*t))&&(e/=a,t/=a),(l=e*n+t*o)&&(n-=e*l,o-=t*l),(s=Math.sqrt(n*n+o*o))&&(n/=s,o/=s,l/=s),e*o<t*n&&(e=-e,t=-t,l=-l,a=-a),{translateX:r,translateY:i,rotate:Math.atan2(t,e)*Im,skewX:Math.atan(l)*Im,scaleX:a,scaleY:s}}function Pm(e,t,n,o){function r(e){return e.length?e.pop()+" ":""}return function(i,a){var s=[],l=[];return i=e(i),a=e(a),function(e,o,r,i,a,s){if(e!==r||o!==i){var l=a.push("translate(",null,t,null,n);s.push({i:l-4,x:wm(e,r)},{i:l-2,x:wm(o,i)})}else(r||i)&&a.push("translate("+r+t+i+n)}(i.translateX,i.translateY,a.translateX,a.translateY,s,l),function(e,t,n,i){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),i.push({i:n.push(r(n)+"rotate(",null,o)-2,x:wm(e,t)})):t&&n.push(r(n)+"rotate("+t+o)}(i.rotate,a.rotate,s,l),function(e,t,n,i){e!==t?i.push({i:n.push(r(n)+"skewX(",null,o)-2,x:wm(e,t)}):t&&n.push(r(n)+"skewX("+t+o)}(i.skewX,a.skewX,s,l),function(e,t,n,o,i,a){if(e!==n||t!==o){var s=i.push(r(i)+"scale(",null,",",null,")");a.push({i:s-4,x:wm(e,n)},{i:s-2,x:wm(t,o)})}else 1===n&&1===o||i.push(r(i)+"scale("+n+","+o+")")}(i.scaleX,i.scaleY,a.scaleX,a.scaleY,s,l),i=a=null,function(e){for(var t,n=-1,o=l.length;++n<o;)s[(t=l[n]).i]=t.x(e);return s.join("")}}}var Tm=Pm(function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Om:Am(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),Mm=Pm(function(e){return null==e?Om:(Nm||(Nm=document.createElementNS("http://www.w3.org/2000/svg","g")),Nm.setAttribute("transform",e),(e=Nm.transform.baseVal.consolidate())?Am((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):Om)},", ",")",")");function zm(e){return((e=Math.exp(e))+1/e)/2}const $m=function e(t,n,o){function r(e,r){var i,a,s=e[0],l=e[1],u=e[2],c=r[0],d=r[1],p=r[2],h=c-s,f=d-l,m=h*h+f*f;if(m<1e-12)a=Math.log(p/u)/t,i=function(e){return[s+e*h,l+e*f,u*Math.exp(t*e*a)]};else{var g=Math.sqrt(m),y=(p*p-u*u+o*m)/(2*u*n*g),v=(p*p-u*u-o*m)/(2*p*n*g),b=Math.log(Math.sqrt(y*y+1)-y),_=Math.log(Math.sqrt(v*v+1)-v);a=(_-b)/t,i=function(e){var o,r=e*a,i=zm(b),c=u/(n*g)*(i*(o=t*r+b,((o=Math.exp(2*o))-1)/(o+1))-function(e){return((e=Math.exp(e))-1/e)/2}(b));return[s+c*h,l+c*f,u*i/zm(t*r+b)]}}return i.duration=1e3*a*t/Math.SQRT2,i}return r.rho=function(t){var n=Math.max(.001,+t),o=n*n;return e(n,o,o*o)},r}(Math.SQRT2,2,4);var Rm,Zm,jm=0,Dm=0,Lm=0,Vm=0,Bm=0,Fm=0,Hm="object"==typeof performance&&performance.now?performance:Date,Um="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Ym(){return Bm||(Um(Km),Bm=Hm.now()+Fm)}function Km(){Bm=0}function Wm(){this._call=this._time=this._next=null}function Xm(e,t,n){var o=new Wm;return o.restart(e,t,n),o}function qm(){Bm=(Vm=Hm.now())+Fm,jm=Dm=0;try{!function(){Ym(),++jm;for(var e,t=Rm;t;)(e=Bm-t._time)>=0&&t._call.call(void 0,e),t=t._next;--jm}()}finally{jm=0,function(){var e,t,n=Rm,o=1/0;for(;n;)n._call?(o>n._time&&(o=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:Rm=t);Zm=e,Jm(o)}(),Bm=0}}function Gm(){var e=Hm.now(),t=e-Vm;t>1e3&&(Fm-=t,Vm=e)}function Jm(e){jm||(Dm&&(Dm=clearTimeout(Dm)),e-Bm>24?(e<1/0&&(Dm=setTimeout(qm,e-Hm.now()-Fm)),Lm&&(Lm=clearInterval(Lm))):(Lm||(Vm=Hm.now(),Lm=setInterval(Gm,1e3)),jm=1,Um(qm)))}function Qm(e,t,n){var o=new Wm;return t=null==t?0:+t,o.restart(n=>{o.stop(),e(n+t)},t,n),o}Wm.prototype=Xm.prototype={constructor:Wm,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?Ym():+n)+(null==t?0:+t),this._next||Zm===this||(Zm?Zm._next=this:Rm=this,Zm=this),this._call=e,this._time=n,Jm()},stop:function(){this._call&&(this._call=null,this._time=1/0,Jm())}};var eg=nh("start","end","cancel","interrupt"),tg=[];function ng(e,t,n,o,r,i){var a=e.__transition;if(a){if(n in a)return}else e.__transition={};!function(e,t,n){var o,r=e.__transition;function i(e){n.state=1,n.timer.restart(a,n.delay,n.time),n.delay<=e&&a(e-n.delay)}function a(i){var u,c,d,p;if(1!==n.state)return l();for(u in r)if((p=r[u]).name===n.name){if(3===p.state)return Qm(a);4===p.state?(p.state=6,p.timer.stop(),p.on.call("interrupt",e,e.__data__,p.index,p.group),delete r[u]):+u<t&&(p.state=6,p.timer.stop(),p.on.call("cancel",e,e.__data__,p.index,p.group),delete r[u])}if(Qm(function(){3===n.state&&(n.state=4,n.timer.restart(s,n.delay,n.time),s(i))}),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,o=new Array(d=n.tween.length),u=0,c=-1;u<d;++u)(p=n.tween[u].value.call(e,e.__data__,n.index,n.group))&&(o[++c]=p);o.length=c+1}}function s(t){for(var r=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(l),n.state=5,1),i=-1,a=o.length;++i<a;)o[i].call(e,r);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){for(var o in n.state=6,n.timer.stop(),delete r[t],r)return;delete e.__transition}r[t]=n,n.timer=Xm(i,0,n.time)}(e,n,{name:t,index:o,group:r,on:eg,tween:tg,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:0})}function og(e,t){var n=ig(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function rg(e,t){var n=ig(e,t);if(n.state>3)throw new Error("too late; already running");return n}function ig(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function ag(e,t){var n,o,r,i=e.__transition,a=!0;if(i){for(r in t=null==t?null:t+"",i)(n=i[r]).name===t?(o=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(o?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete i[r]):a=!1;a&&delete e.__transition}}function sg(e,t){var n,o;return function(){var r=rg(this,e),i=r.tween;if(i!==n)for(var a=0,s=(o=n=i).length;a<s;++a)if(o[a].name===t){(o=o.slice()).splice(a,1);break}r.tween=o}}function lg(e,t,n){var o,r;if("function"!=typeof n)throw new Error;return function(){var i=rg(this,e),a=i.tween;if(a!==o){r=(o=a).slice();for(var s={name:t,value:n},l=0,u=r.length;l<u;++l)if(r[l].name===t){r[l]=s;break}l===u&&r.push(s)}i.tween=r}}function ug(e,t,n){var o=e._id;return e.each(function(){var e=rg(this,o);(e.value||(e.value={}))[t]=n.apply(this,arguments)}),function(e){return ig(e,o).value[t]}}function cg(e,t){var n;return("number"==typeof t?wm:t instanceof Jf?ym:(n=Jf(t))?(t=n,ym):Em)(e,t)}function dg(e){return function(){this.removeAttribute(e)}}function pg(e){return function(){this.removeAttributeNS(e.space,e.local)}}function hg(e,t,n){var o,r,i=n+"";return function(){var a=this.getAttribute(e);return a===i?null:a===o?r:r=t(o=a,n)}}function fg(e,t,n){var o,r,i=n+"";return function(){var a=this.getAttributeNS(e.space,e.local);return a===i?null:a===o?r:r=t(o=a,n)}}function mg(e,t,n){var o,r,i;return function(){var a,s,l=n(this);if(null!=l)return(a=this.getAttribute(e))===(s=l+"")?null:a===o&&s===r?i:(r=s,i=t(o=a,l));this.removeAttribute(e)}}function gg(e,t,n){var o,r,i;return function(){var a,s,l=n(this);if(null!=l)return(a=this.getAttributeNS(e.space,e.local))===(s=l+"")?null:a===o&&s===r?i:(r=s,i=t(o=a,l));this.removeAttributeNS(e.space,e.local)}}function yg(e,t){var n,o;function r(){var r=t.apply(this,arguments);return r!==o&&(n=(o=r)&&function(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}(e,r)),n}return r._value=t,r}function vg(e,t){var n,o;function r(){var r=t.apply(this,arguments);return r!==o&&(n=(o=r)&&function(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}(e,r)),n}return r._value=t,r}function bg(e,t){return function(){og(this,e).delay=+t.apply(this,arguments)}}function _g(e,t){return t=+t,function(){og(this,e).delay=t}}function wg(e,t){return function(){rg(this,e).duration=+t.apply(this,arguments)}}function xg(e,t){return t=+t,function(){rg(this,e).duration=t}}var kg=vf.prototype.constructor;function Sg(e){return function(){this.style.removeProperty(e)}}var Eg=0;function Cg(e,t,n,o){this._groups=e,this._parents=t,this._name=n,this._id=o}function Ng(){return++Eg}var Ig=vf.prototype;Cg.prototype={constructor:Cg,select:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=hh(e));for(var o=this._groups,r=o.length,i=new Array(r),a=0;a<r;++a)for(var s,l,u=o[a],c=u.length,d=i[a]=new Array(c),p=0;p<c;++p)(s=u[p])&&(l=e.call(s,s.__data__,p,u))&&("__data__"in s&&(l.__data__=s.__data__),d[p]=l,ng(d[p],t,n,p,d,ig(s,n)));return new Cg(i,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=mh(e));for(var o=this._groups,r=o.length,i=[],a=[],s=0;s<r;++s)for(var l,u=o[s],c=u.length,d=0;d<c;++d)if(l=u[d]){for(var p,h=e.call(l,l.__data__,d,u),f=ig(l,n),m=0,g=h.length;m<g;++m)(p=h[m])&&ng(p,t,n,m,h,f);i.push(h),a.push(l)}return new Cg(i,a,t,n)},selectChild:Ig.selectChild,selectChildren:Ig.selectChildren,filter:function(e){"function"!=typeof e&&(e=yh(e));for(var t=this._groups,n=t.length,o=new Array(n),r=0;r<n;++r)for(var i,a=t[r],s=a.length,l=o[r]=[],u=0;u<s;++u)(i=a[u])&&e.call(i,i.__data__,u,a)&&l.push(i);return new Cg(o,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,o=t.length,r=n.length,i=Math.min(o,r),a=new Array(o),s=0;s<i;++s)for(var l,u=t[s],c=n[s],d=u.length,p=a[s]=new Array(d),h=0;h<d;++h)(l=u[h]||c[h])&&(p[h]=l);for(;s<o;++s)a[s]=t[s];return new Cg(a,this._parents,this._name,this._id)},selection:function(){return new kg(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=Ng(),o=this._groups,r=o.length,i=0;i<r;++i)for(var a,s=o[i],l=s.length,u=0;u<l;++u)if(a=s[u]){var c=ig(a,t);ng(a,e,n,u,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new Cg(o,this._parents,e,n)},call:Ig.call,nodes:Ig.nodes,node:Ig.node,size:Ig.size,empty:Ig.empty,each:Ig.each,on:function(e,t){var n=this._id;return arguments.length<2?ig(this.node(),n).on.on(e):this.each(function(e,t,n){var o,r,i=function(e){return(e+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})}(t)?og:rg;return function(){var a=i(this,e),s=a.on;s!==o&&(r=(o=s).copy()).on(t,n),a.on=r}}(n,e,t))},attr:function(e,t){var n=lh(e),o="transform"===n?Mm:cg;return this.attrTween(e,"function"==typeof t?(n.local?gg:mg)(n,o,ug(this,"attr."+e,t)):null==t?(n.local?pg:dg)(n):(n.local?fg:hg)(n,o,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var o=lh(e);return this.tween(n,(o.local?yg:vg)(o,t))},style:function(e,t,n){var o="transform"==(e+="")?Tm:cg;return null==t?this.styleTween(e,function(e,t){var n,o,r;return function(){var i=Lh(this,e),a=(this.style.removeProperty(e),Lh(this,e));return i===a?null:i===n&&a===o?r:r=t(n=i,o=a)}}(e,o)).on("end.style."+e,Sg(e)):"function"==typeof t?this.styleTween(e,function(e,t,n){var o,r,i;return function(){var a=Lh(this,e),s=n(this),l=s+"";return null==s&&(this.style.removeProperty(e),l=s=Lh(this,e)),a===l?null:a===o&&l===r?i:(r=l,i=t(o=a,s))}}(e,o,ug(this,"style."+e,t))).each(function(e,t){var n,o,r,i,a="style."+t,s="end."+a;return function(){var l=rg(this,e),u=l.on,c=null==l.value[a]?i||(i=Sg(t)):void 0;u===n&&r===c||(o=(n=u).copy()).on(s,r=c),l.on=o}}(this._id,e)):this.styleTween(e,function(e,t,n){var o,r,i=n+"";return function(){var a=Lh(this,e);return a===i?null:a===o?r:r=t(o=a,n)}}(e,o,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var o="style."+(e+="");if(arguments.length<2)return(o=this.tween(o))&&o._value;if(null==t)return this.tween(o,null);if("function"!=typeof t)throw new Error;return this.tween(o,function(e,t,n){var o,r;function i(){var i=t.apply(this,arguments);return i!==r&&(o=(r=i)&&function(e,t,n){return function(o){this.style.setProperty(e,t.call(this,o),n)}}(e,i,n)),o}return i._value=t,i}(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"==typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(ug(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,function(e){var t,n;function o(){var o=e.apply(this,arguments);return o!==n&&(t=(n=o)&&function(e){return function(t){this.textContent=e.call(this,t)}}(o)),t}return o._value=e,o}(e))},remove:function(){return this.on("end.remove",(e=this._id,function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}));var e},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var o,r=ig(this.node(),n).tween,i=0,a=r.length;i<a;++i)if((o=r[i]).name===e)return o.value;return null}return this.each((null==t?sg:lg)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?bg:_g)(t,e)):ig(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?wg:xg)(t,e)):ig(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!=typeof t)throw new Error;return function(){rg(this,e).ease=t}}(t,e)):ig(this.node(),t).ease},easeVarying:function(e){if("function"!=typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;rg(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,o=n._id,r=n.size();return new Promise(function(i,a){var s={value:a},l={value:function(){0===--r&&i()}};n.each(function(){var n=rg(this,o),r=n.on;r!==e&&((t=(e=r).copy())._.cancel.push(s),t._.interrupt.push(s),t._.end.push(l)),n.on=t}),0===r&&i()})},[Symbol.iterator]:Ig[Symbol.iterator]};var Og={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function Ag(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}vf.prototype.interrupt=function(e){return this.each(function(){ag(this,e)})},vf.prototype.transition=function(e){var t,n;e instanceof Cg?(t=e._id,e=e._name):(t=Ng(),(n=Og).time=Ym(),e=null==e?null:e+"");for(var o=this._groups,r=o.length,i=0;i<r;++i)for(var a,s=o[i],l=s.length,u=0;u<l;++u)(a=s[u])&&ng(a,e,t,u,s,n||Ag(a,t));return new Cg(o,this._parents,e,t)};const Pg=e=>()=>e;function Tg(e,{sourceEvent:t,target:n,transform:o,dispatch:r}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:o,enumerable:!0,configurable:!0},_:{value:r}})}function Mg(e,t,n){this.k=e,this.x=t,this.y=n}Mg.prototype={constructor:Mg,scale:function(e){return 1===e?this:new Mg(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new Mg(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var zg=new Mg(1,0,0);function $g(e){for(;!e.__zoom;)if(!(e=e.parentNode))return zg;return e.__zoom}function Rg(e){e.stopImmediatePropagation()}function Zg(e){e.preventDefault(),e.stopImmediatePropagation()}function jg(e){return!(e.ctrlKey&&"wheel"!==e.type||e.button)}function Dg(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function Lg(){return this.__zoom||zg}function Vg(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Bg(){return navigator.maxTouchPoints||"ontouchstart"in this}function Fg(e,t,n){var o=e.invertX(t[0][0])-n[0][0],r=e.invertX(t[1][0])-n[1][0],i=e.invertY(t[0][1])-n[0][1],a=e.invertY(t[1][1])-n[1][1];return e.translate(r>o?(o+r)/2:Math.min(0,o)||Math.max(0,r),a>i?(i+a)/2:Math.min(0,i)||Math.max(0,a))}function Hg(){var e,t,n,o=jg,r=Dg,i=Fg,a=Vg,s=Bg,l=[0,1/0],u=[[-1/0,-1/0],[1/0,1/0]],c=250,d=$m,p=nh("start","zoom","end"),h=0,f=10;function m(e){e.property("__zoom",Lg).on("wheel.zoom",x,{passive:!1}).on("mousedown.zoom",k).on("dblclick.zoom",S).filter(s).on("touchstart.zoom",E).on("touchmove.zoom",C).on("touchend.zoom touchcancel.zoom",N).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(e,t){return(t=Math.max(l[0],Math.min(l[1],t)))===e.k?e:new Mg(t,e.x,e.y)}function y(e,t,n){var o=t[0]-n[0]*e.k,r=t[1]-n[1]*e.k;return o===e.x&&r===e.y?e:new Mg(e.k,o,r)}function v(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function b(e,t,n,o){e.on("start.zoom",function(){_(this,arguments).event(o).start()}).on("interrupt.zoom end.zoom",function(){_(this,arguments).event(o).end()}).tween("zoom",function(){var e=this,i=arguments,a=_(e,i).event(o),s=r.apply(e,i),l=null==n?v(s):"function"==typeof n?n.apply(e,i):n,u=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),c=e.__zoom,p="function"==typeof t?t.apply(e,i):t,h=d(c.invert(l).concat(u/c.k),p.invert(l).concat(u/p.k));return function(e){if(1===e)e=p;else{var t=h(e),n=u/t[2];e=new Mg(n,l[0]-t[0]*n,l[1]-t[1]*n)}a.zoom(null,e)}})}function _(e,t,n){return!n&&e.__zooming||new w(e,t)}function w(e,t){this.that=e,this.args=t,this.active=0,this.sourceEvent=null,this.extent=r.apply(e,t),this.taps=0}function x(e,...t){if(o.apply(this,arguments)){var n=_(this,t).event(e),r=this.__zoom,s=Math.max(l[0],Math.min(l[1],r.k*Math.pow(2,a.apply(this,arguments)))),c=_f(e);if(n.wheel)n.mouse[0][0]===c[0]&&n.mouse[0][1]===c[1]||(n.mouse[1]=r.invert(n.mouse[0]=c)),clearTimeout(n.wheel);else{if(r.k===s)return;n.mouse=[c,r.invert(c)],ag(this),n.start()}Zg(e),n.wheel=setTimeout(function(){n.wheel=null,n.end()},150),n.zoom("mouse",i(y(g(r,s),n.mouse[0],n.mouse[1]),n.extent,u))}}function k(e,...t){if(!n&&o.apply(this,arguments)){var r=e.currentTarget,a=_(this,t,!0).event(e),s=bf(e.view).on("mousemove.zoom",function(e){if(Zg(e),!a.moved){var t=e.clientX-c,n=e.clientY-d;a.moved=t*t+n*n>h}a.event(e).zoom("mouse",i(y(a.that.__zoom,a.mouse[0]=_f(e,r),a.mouse[1]),a.extent,u))},!0).on("mouseup.zoom",function(e){s.on("mousemove.zoom mouseup.zoom",null),Cf(e.view,a.moved),Zg(e),a.event(e).end()},!0),l=_f(e,r),c=e.clientX,d=e.clientY;Ef(e.view),Rg(e),a.mouse=[l,this.__zoom.invert(l)],ag(this),a.start()}}function S(e,...t){if(o.apply(this,arguments)){var n=this.__zoom,a=_f(e.changedTouches?e.changedTouches[0]:e,this),s=n.invert(a),l=n.k*(e.shiftKey?.5:2),d=i(y(g(n,l),a,s),r.apply(this,t),u);Zg(e),c>0?bf(this).transition().duration(c).call(b,d,a,e):bf(this).call(m.transform,d,a,e)}}function E(n,...r){if(o.apply(this,arguments)){var i,a,s,l,u=n.touches,c=u.length,d=_(this,r,n.changedTouches.length===c).event(n);for(Rg(n),a=0;a<c;++a)l=[l=_f(s=u[a],this),this.__zoom.invert(l),s.identifier],d.touch0?d.touch1||d.touch0[2]===l[2]||(d.touch1=l,d.taps=0):(d.touch0=l,i=!0,d.taps=1+!!e);e&&(e=clearTimeout(e)),i&&(d.taps<2&&(t=l[0],e=setTimeout(function(){e=null},500)),ag(this),d.start())}}function C(e,...t){if(this.__zooming){var n,o,r,a,s=_(this,t).event(e),l=e.changedTouches,c=l.length;for(Zg(e),n=0;n<c;++n)r=_f(o=l[n],this),s.touch0&&s.touch0[2]===o.identifier?s.touch0[0]=r:s.touch1&&s.touch1[2]===o.identifier&&(s.touch1[0]=r);if(o=s.that.__zoom,s.touch1){var d=s.touch0[0],p=s.touch0[1],h=s.touch1[0],f=s.touch1[1],m=(m=h[0]-d[0])*m+(m=h[1]-d[1])*m,v=(v=f[0]-p[0])*v+(v=f[1]-p[1])*v;o=g(o,Math.sqrt(m/v)),r=[(d[0]+h[0])/2,(d[1]+h[1])/2],a=[(p[0]+f[0])/2,(p[1]+f[1])/2]}else{if(!s.touch0)return;r=s.touch0[0],a=s.touch0[1]}s.zoom("touch",i(y(o,r,a),s.extent,u))}}function N(e,...o){if(this.__zooming){var r,i,a=_(this,o).event(e),s=e.changedTouches,l=s.length;for(Rg(e),n&&clearTimeout(n),n=setTimeout(function(){n=null},500),r=0;r<l;++r)i=s[r],a.touch0&&a.touch0[2]===i.identifier?delete a.touch0:a.touch1&&a.touch1[2]===i.identifier&&delete a.touch1;if(a.touch1&&!a.touch0&&(a.touch0=a.touch1,delete a.touch1),a.touch0)a.touch0[1]=this.__zoom.invert(a.touch0[0]);else if(a.end(),2===a.taps&&(i=_f(i,this),Math.hypot(t[0]-i[0],t[1]-i[1])<f)){var u=bf(this).on("dblclick.zoom");u&&u.apply(this,arguments)}}}return m.transform=function(e,t,n,o){var r=e.selection?e.selection():e;r.property("__zoom",Lg),e!==r?b(e,t,n,o):r.interrupt().each(function(){_(this,arguments).event(o).start().zoom(null,"function"==typeof t?t.apply(this,arguments):t).end()})},m.scaleBy=function(e,t,n,o){m.scaleTo(e,function(){return this.__zoom.k*("function"==typeof t?t.apply(this,arguments):t)},n,o)},m.scaleTo=function(e,t,n,o){m.transform(e,function(){var e=r.apply(this,arguments),o=this.__zoom,a=null==n?v(e):"function"==typeof n?n.apply(this,arguments):n,s=o.invert(a),l="function"==typeof t?t.apply(this,arguments):t;return i(y(g(o,l),a,s),e,u)},n,o)},m.translateBy=function(e,t,n,o){m.transform(e,function(){return i(this.__zoom.translate("function"==typeof t?t.apply(this,arguments):t,"function"==typeof n?n.apply(this,arguments):n),r.apply(this,arguments),u)},null,o)},m.translateTo=function(e,t,n,o,a){m.transform(e,function(){var e=r.apply(this,arguments),a=this.__zoom,s=null==o?v(e):"function"==typeof o?o.apply(this,arguments):o;return i(zg.translate(s[0],s[1]).scale(a.k).translate("function"==typeof t?-t.apply(this,arguments):-t,"function"==typeof n?-n.apply(this,arguments):-n),e,u)},o,a)},w.prototype={event:function(e){return e&&(this.sourceEvent=e),this},start:function(){return 1===++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0===--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(e){var t=bf(this.that).datum();p.call(e,this.that,new Tg(e,{sourceEvent:this.sourceEvent,target:m,transform:this.that.__zoom,dispatch:p}),t)}},m.wheelDelta=function(e){return arguments.length?(a="function"==typeof e?e:Pg(+e),m):a},m.filter=function(e){return arguments.length?(o="function"==typeof e?e:Pg(!!e),m):o},m.touchable=function(e){return arguments.length?(s="function"==typeof e?e:Pg(!!e),m):s},m.extent=function(e){return arguments.length?(r="function"==typeof e?e:Pg([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),m):r},m.scaleExtent=function(e){return arguments.length?(l[0]=+e[0],l[1]=+e[1],m):[l[0],l[1]]},m.translateExtent=function(e){return arguments.length?(u[0][0]=+e[0][0],u[1][0]=+e[1][0],u[0][1]=+e[0][1],u[1][1]=+e[1][1],m):[[u[0][0],u[0][1]],[u[1][0],u[1][1]]]},m.constrain=function(e){return arguments.length?(i=e,m):i},m.duration=function(e){return arguments.length?(c=+e,m):c},m.interpolate=function(e){return arguments.length?(d=e,m):d},m.on=function(){var e=p.on.apply(p,arguments);return e===p?m:e},m.clickDistance=function(e){return arguments.length?(h=(e=+e)*e,m):Math.sqrt(h)},m.tapDistance=function(e){return arguments.length?(f=+e,m):f},m}$g.prototype=Mg.prototype;const Ug=()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",Yg=e=>`Node type "${e}" not found. Using fallback type "default".`,Kg=()=>"The React Flow parent container needs a width and a height to render the graph.",Wg=()=>"Only child nodes can use a parent extent.",Xg=e=>`Marker type "${e}" doesn't exist.`,qg=(e,{id:t,sourceHandle:n,targetHandle:o})=>`Couldn't create edge for ${e} handle id: "${"source"===e?n:o}", edge id: ${t}.`,Gg=()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",Jg=e=>`Edge type "${e}" not found. Using fallback type "default".`,Qg=e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,ey=()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs.",ty=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],ny=["Enter"," ","Escape"],oy={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:n})=>`Moved selected node ${e}. New position, x: ${t}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var ry,iy,ay,sy,ly,uy;(iy=ry||(ry={})).Strict="strict",iy.Loose="loose",(sy=ay||(ay={})).Free="free",sy.Vertical="vertical",sy.Horizontal="horizontal",(uy=ly||(ly={})).Partial="partial",uy.Full="full";const cy={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var dy,py,hy,fy,my,gy;(py=dy||(dy={})).Bezier="default",py.Straight="straight",py.Step="step",py.SmoothStep="smoothstep",py.SimpleBezier="simplebezier",(fy=hy||(hy={})).Arrow="arrow",fy.ArrowClosed="arrowclosed",(gy=my||(my={})).Left="left",gy.Top="top",gy.Right="right",gy.Bottom="bottom";const yy={[my.Left]:my.Right,[my.Right]:my.Left,[my.Top]:my.Bottom,[my.Bottom]:my.Top};function vy(e){return null===e?null:e?"valid":"invalid"}const by=e=>"id"in e&&"source"in e&&"target"in e,_y=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),wy=(e,t=[0,0])=>{const{width:n,height:o}=Xy(e),r=e.origin??t,i=n*r[0],a=o*r[1];return{x:e.position.x-i,y:e.position.y-a}},xy=(e,t={})=>{if(0===e.size)return{x:0,y:0,width:0,height:0};let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return e.forEach(e=>{if(void 0===t.filter||t.filter(e)){const t=Ry(e);n=Ty(n,t)}}),zy(n)},ky=(e,t,[n,o,r]=[0,0,1],i=!1,a=!1)=>{const s={...Fy(t,[n,o,r]),width:t.width/r,height:t.height/r},l=[];for(const u of e.values()){const{measured:e,selectable:t=!0,hidden:n=!1}=u;if(a&&!t||n)continue;const o=e.width??u.width??u.initialWidth??null,r=e.height??u.height??u.initialHeight??null,c=jy(s,$y(u)),d=(o??0)*(r??0),p=i&&c>0;(!u.internals.handleBounds||p||c>=d||u.dragging)&&l.push(u)}return l};async function Sy({nodes:e,width:t,height:n,panZoom:o,minZoom:r,maxZoom:i},a){if(0===e.size)return Promise.resolve(!0);const s=function(e,t){const n=new Map,o=(null==t?void 0:t.nodes)?new Set(t.nodes.map(e=>e.id)):null;return e.forEach(e=>{!e.measured.width||!e.measured.height||!(null==t?void 0:t.includeHiddenNodes)&&e.hidden||o&&!o.has(e.id)||n.set(e.id,e)}),n}(e,a),l=xy(s),u=Yy(l,t,n,(null==a?void 0:a.minZoom)??r,(null==a?void 0:a.maxZoom)??i,(null==a?void 0:a.padding)??.1);return await o.setViewport(u,{duration:null==a?void 0:a.duration,ease:null==a?void 0:a.ease,interpolate:null==a?void 0:a.interpolate}),Promise.resolve(!0)}function Ey({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:o=[0,0],nodeExtent:r,onError:i}){const a=n.get(e),s=a.parentId?n.get(a.parentId):void 0,{x:l,y:u}=s?s.internals.positionAbsolute:{x:0,y:0},c=a.origin??o;let d=a.extent||r;if("parent"!==a.extent||a.expandParent)s&&Wy(a.extent)&&(d=[[a.extent[0][0]+l,a.extent[0][1]+u],[a.extent[1][0]+l,a.extent[1][1]+u]]);else if(s){const e=s.measured.width,t=s.measured.height;e&&t&&(d=[[l,u],[l+e,u+t]])}else null==i||i("005",Wg());const p=Wy(d)?Iy(t,d,a.measured):t;return void 0!==a.measured.width&&void 0!==a.measured.height||null==i||i("015",ey()),{position:{x:p.x-l+(a.measured.width??0)*c[0],y:p.y-u+(a.measured.height??0)*c[1]},positionAbsolute:p}}async function Cy({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:o,onBeforeDelete:r}){const i=new Set(e.map(e=>e.id)),a=[];for(const p of n){if(!1===p.deletable)continue;const e=i.has(p.id),t=!e&&p.parentId&&a.find(e=>e.id===p.parentId);(e||t)&&a.push(p)}const s=new Set(t.map(e=>e.id)),l=o.filter(e=>!1!==e.deletable),u=((e,t)=>{const n=new Set;return e.forEach(e=>{n.add(e.id)}),t.filter(e=>n.has(e.source)||n.has(e.target))})(a,l),c=u;for(const p of l){s.has(p.id)&&!c.find(e=>e.id===p.id)&&c.push(p)}if(!r)return{edges:c,nodes:a};const d=await r({nodes:a,edges:c});return"boolean"==typeof d?d?{edges:c,nodes:a}:{edges:[],nodes:[]}:d}const Ny=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),Iy=(e={x:0,y:0},t,n)=>({x:Ny(e.x,t[0][0],t[1][0]-((null==n?void 0:n.width)??0)),y:Ny(e.y,t[0][1],t[1][1]-((null==n?void 0:n.height)??0))});function Oy(e,t,n){const{width:o,height:r}=Xy(n),{x:i,y:a}=n.internals.positionAbsolute;return Iy(e,[[i,a],[i+o,a+r]],t)}const Ay=(e,t,n)=>e<t?Ny(Math.abs(e-t),1,t)/t:e>n?-Ny(Math.abs(e-n),1,t)/t:0,Py=(e,t,n=15,o=40)=>[Ay(e.x,o,t.width-o)*n,Ay(e.y,o,t.height-o)*n],Ty=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),My=({x:e,y:t,width:n,height:o})=>({x:e,y:t,x2:e+n,y2:t+o}),zy=({x:e,y:t,x2:n,y2:o})=>({x:e,y:t,width:n-e,height:o-t}),$y=(e,t=[0,0])=>{var n,o;const{x:r,y:i}=_y(e)?e.internals.positionAbsolute:wy(e,t);return{x:r,y:i,width:(null==(n=e.measured)?void 0:n.width)??e.width??e.initialWidth??0,height:(null==(o=e.measured)?void 0:o.height)??e.height??e.initialHeight??0}},Ry=(e,t=[0,0])=>{var n,o;const{x:r,y:i}=_y(e)?e.internals.positionAbsolute:wy(e,t);return{x:r,y:i,x2:r+((null==(n=e.measured)?void 0:n.width)??e.width??e.initialWidth??0),y2:i+((null==(o=e.measured)?void 0:o.height)??e.height??e.initialHeight??0)}},Zy=(e,t)=>zy(Ty(My(e),My(t))),jy=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),o=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*o)},Dy=e=>Ly(e.width)&&Ly(e.height)&&Ly(e.x)&&Ly(e.y),Ly=e=>!isNaN(e)&&isFinite(e),Vy=(e,t)=>{},By=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),Fy=({x:e,y:t},[n,o,r],i=!1,a=[1,1])=>{const s={x:(e-n)/r,y:(t-o)/r};return i?By(s,a):s},Hy=({x:e,y:t},[n,o,r])=>({x:e*r+n,y:t*r+o});function Uy(e,t){if("number"==typeof e)return Math.floor(.5*(t-t/(1+e)));if("string"==typeof e&&e.endsWith("px")){const t=parseFloat(e);if(!Number.isNaN(t))return Math.floor(t)}if("string"==typeof e&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return 0}const Yy=(e,t,n,o,r,i)=>{const a=function(e,t,n){if("string"==typeof e||"number"==typeof e){const o=Uy(e,n),r=Uy(e,t);return{top:o,right:r,bottom:o,left:r,x:2*r,y:2*o}}if("object"==typeof e){const o=Uy(e.top??e.y??0,n),r=Uy(e.bottom??e.y??0,n),i=Uy(e.left??e.x??0,t),a=Uy(e.right??e.x??0,t);return{top:o,right:a,bottom:r,left:i,x:i+a,y:o+r}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}(i,t,n),s=(t-a.x)/e.width,l=(n-a.y)/e.height,u=Math.min(s,l),c=Ny(u,o,r),d=t/2-(e.x+e.width/2)*c,p=n/2-(e.y+e.height/2)*c,h=function(e,t,n,o,r,i){const{x:a,y:s}=Hy(e,[t,n,o]),{x:l,y:u}=Hy({x:e.x+e.width,y:e.y+e.height},[t,n,o]),c=r-l,d=i-u;return{left:Math.floor(a),top:Math.floor(s),right:Math.floor(c),bottom:Math.floor(d)}}(e,d,p,c,t,n),f=Math.min(h.left-a.left,0),m=Math.min(h.top-a.top,0);return{x:d-f+Math.min(h.right-a.right,0),y:p-m+Math.min(h.bottom-a.bottom,0),zoom:c}},Ky=()=>{var e;return"undefined"!=typeof navigator&&(null==(e=null==navigator?void 0:navigator.userAgent)?void 0:e.indexOf("Mac"))>=0};function Wy(e){return void 0!==e&&"parent"!==e}function Xy(e){var t,n;return{width:(null==(t=e.measured)?void 0:t.width)??e.width??e.initialWidth??0,height:(null==(n=e.measured)?void 0:n.height)??e.height??e.initialHeight??0}}function qy(e){var t,n;return void 0!==((null==(t=e.measured)?void 0:t.width)??e.width??e.initialWidth)&&void 0!==((null==(n=e.measured)?void 0:n.height)??e.height??e.initialHeight)}function Gy(e,t={width:0,height:0},n,o,r){const i={...e},a=o.get(n);if(a){const e=a.origin||r;i.x+=a.internals.positionAbsolute.x-(t.width??0)*e[0],i.y+=a.internals.positionAbsolute.y-(t.height??0)*e[1]}return i}function Jy(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Qy(e){return{...oy,...e||{}}}function ev(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:o,containerBounds:r}){const{x:i,y:a}=av(e),s=Fy({x:i-((null==r?void 0:r.left)??0),y:a-((null==r?void 0:r.top)??0)},o),{x:l,y:u}=n?By(s,t):s;return{xSnapped:l,ySnapped:u,...s}}const tv=e=>({width:e.offsetWidth,height:e.offsetHeight}),nv=e=>{var t;return(null==(t=null==e?void 0:e.getRootNode)?void 0:t.call(e))||(null==window?void 0:window.document)},ov=["INPUT","SELECT","TEXTAREA"];function rv(e){var t,n;const o=(null==(n=null==(t=e.composedPath)?void 0:t.call(e))?void 0:n[0])||e.target;if(1!==(null==o?void 0:o.nodeType))return!1;return ov.includes(o.nodeName)||o.hasAttribute("contenteditable")||!!o.closest(".nokey")}const iv=e=>"clientX"in e,av=(e,t)=>{var n,o;const r=iv(e),i=r?e.clientX:null==(n=e.touches)?void 0:n[0].clientX,a=r?e.clientY:null==(o=e.touches)?void 0:o[0].clientY;return{x:i-((null==t?void 0:t.left)??0),y:a-((null==t?void 0:t.top)??0)}},sv=(e,t,n,o,r)=>{const i=t.querySelectorAll(`.${e}`);return i&&i.length?Array.from(i).map(t=>{const i=t.getBoundingClientRect();return{id:t.getAttribute("data-handleid"),type:e,nodeId:r,position:t.getAttribute("data-handlepos"),x:(i.left-n.left)/o,y:(i.top-n.top)/o,...tv(t)}}):null};function lv({sourceX:e,sourceY:t,targetX:n,targetY:o,sourceControlX:r,sourceControlY:i,targetControlX:a,targetControlY:s}){const l=.125*e+.375*r+.375*a+.125*n,u=.125*t+.375*i+.375*s+.125*o;return[l,u,Math.abs(l-e),Math.abs(u-t)]}function uv(e,t){return e>=0?.5*e:25*t*Math.sqrt(-e)}function cv({pos:e,x1:t,y1:n,x2:o,y2:r,c:i}){switch(e){case my.Left:return[t-uv(t-o,i),n];case my.Right:return[t+uv(o-t,i),n];case my.Top:return[t,n-uv(n-r,i)];case my.Bottom:return[t,n+uv(r-n,i)]}}function dv({sourceX:e,sourceY:t,sourcePosition:n=my.Bottom,targetX:o,targetY:r,targetPosition:i=my.Top,curvature:a=.25}){const[s,l]=cv({pos:n,x1:e,y1:t,x2:o,y2:r,c:a}),[u,c]=cv({pos:i,x1:o,y1:r,x2:e,y2:t,c:a}),[d,p,h,f]=lv({sourceX:e,sourceY:t,targetX:o,targetY:r,sourceControlX:s,sourceControlY:l,targetControlX:u,targetControlY:c});return[`M${e},${t} C${s},${l} ${u},${c} ${o},${r}`,d,p,h,f]}function pv({sourceX:e,sourceY:t,targetX:n,targetY:o}){const r=Math.abs(n-e)/2,i=n<e?n+r:n-r,a=Math.abs(o-t)/2;return[i,o<t?o+a:o-a,r,a]}function hv({sourceNode:e,targetNode:t,width:n,height:o,transform:r}){const i=Ty(Ry(e),Ry(t));i.x===i.x2&&(i.x2+=1),i.y===i.y2&&(i.y2+=1);const a={x:-r[0]/r[2],y:-r[1]/r[2],width:n/r[2],height:o/r[2]};return jy(a,zy(i))>0}const fv=({source:e,sourceHandle:t,target:n,targetHandle:o})=>`xy-edge__${e}${t||""}-${n}${o||""}`,mv=(e,t)=>{if(!e.source||!e.target)return t;let n;return n=by(e)?{...e}:{...e,id:fv(e)},((e,t)=>t.some(t=>!(t.source!==e.source||t.target!==e.target||t.sourceHandle!==e.sourceHandle&&(t.sourceHandle||e.sourceHandle)||t.targetHandle!==e.targetHandle&&(t.targetHandle||e.targetHandle))))(n,t)?t:(null===n.sourceHandle&&delete n.sourceHandle,null===n.targetHandle&&delete n.targetHandle,t.concat(n))};function gv({sourceX:e,sourceY:t,targetX:n,targetY:o}){const[r,i,a,s]=pv({sourceX:e,sourceY:t,targetX:n,targetY:o});return[`M ${e},${t}L ${n},${o}`,r,i,a,s]}const yv={[my.Left]:{x:-1,y:0},[my.Right]:{x:1,y:0},[my.Top]:{x:0,y:-1},[my.Bottom]:{x:0,y:1}},vv=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function bv({source:e,sourcePosition:t=my.Bottom,target:n,targetPosition:o=my.Top,center:r,offset:i,stepPosition:a}){const s=yv[t],l=yv[o],u={x:e.x+s.x*i,y:e.y+s.y*i},c={x:n.x+l.x*i,y:n.y+l.y*i},d=(({source:e,sourcePosition:t=my.Bottom,target:n})=>t===my.Left||t===my.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1})({source:u,sourcePosition:t,target:c}),p=0!==d.x?"x":"y",h=d[p];let f,m,g=[];const y={x:0,y:0},v={x:0,y:0},[,,b,_]=pv({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(s[p]*l[p]===-1){"x"===p?(f=r.x??u.x+(c.x-u.x)*a,m=r.y??(u.y+c.y)/2):(f=r.x??(u.x+c.x)/2,m=r.y??u.y+(c.y-u.y)*a);const e=[{x:f,y:u.y},{x:f,y:c.y}],t=[{x:u.x,y:m},{x:c.x,y:m}];g=s[p]===h?"x"===p?e:t:"x"===p?t:e}else{const r=[{x:u.x,y:c.y}],a=[{x:c.x,y:u.y}];if(g="x"===p?s.x===h?a:r:s.y===h?r:a,t===o){const t=Math.abs(e[p]-n[p]);if(t<=i){const o=Math.min(i-1,i-t);s[p]===h?y[p]=(u[p]>e[p]?-1:1)*o:v[p]=(c[p]>n[p]?-1:1)*o}}if(t!==o){const e="x"===p?"y":"x",t=s[p]===l[e],n=u[e]>c[e],o=u[e]<c[e];(1===s[p]&&(!t&&n||t&&o)||1!==s[p]&&(!t&&o||t&&n))&&(g="x"===p?r:a)}const d={x:u.x+y.x,y:u.y+y.y},b={x:c.x+v.x,y:c.y+v.y};Math.max(Math.abs(d.x-g[0].x),Math.abs(b.x-g[0].x))>=Math.max(Math.abs(d.y-g[0].y),Math.abs(b.y-g[0].y))?(f=(d.x+b.x)/2,m=g[0].y):(f=g[0].x,m=(d.y+b.y)/2)}return[[e,{x:u.x+y.x,y:u.y+y.y},...g,{x:c.x+v.x,y:c.y+v.y},n],f,m,b,_]}function _v({sourceX:e,sourceY:t,sourcePosition:n=my.Bottom,targetX:o,targetY:r,targetPosition:i=my.Top,borderRadius:a=5,centerX:s,centerY:l,offset:u=20,stepPosition:c=.5}){const[d,p,h,f,m]=bv({source:{x:e,y:t},sourcePosition:n,target:{x:o,y:r},targetPosition:i,center:{x:s,y:l},offset:u,stepPosition:c});return[d.reduce((e,t,n)=>{let o="";return o=n>0&&n<d.length-1?function(e,t,n,o){const r=Math.min(vv(e,t)/2,vv(t,n)/2,o),{x:i,y:a}=t;if(e.x===i&&i===n.x||e.y===a&&a===n.y)return`L${i} ${a}`;if(e.y===a)return`L ${i+r*(e.x<n.x?-1:1)},${a}Q ${i},${a} ${i},${a+r*(e.y<n.y?1:-1)}`;const s=e.x<n.x?1:-1;return`L ${i},${a+r*(e.y<n.y?-1:1)}Q ${i},${a} ${i+r*s},${a}`}(d[n-1],t,d[n+1],a):`${0===n?"M":"L"}${t.x} ${t.y}`,e+=o},""),p,h,f,m]}function wv(e){var t;return e&&!(!e.internals.handleBounds&&!(null==(t=e.handles)?void 0:t.length))&&!!(e.measured.width||e.width||e.initialWidth)}function xv(e){if(!e)return null;const t=[],n=[];for(const o of e)o.width=o.width??1,o.height=o.height??1,"source"===o.type?t.push(o):"target"===o.type&&n.push(o);return{source:t,target:n}}function kv(e,t,n=my.Left,o=!1){const r=((null==t?void 0:t.x)??0)+e.internals.positionAbsolute.x,i=((null==t?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:a,height:s}=t??Xy(e);if(o)return{x:r+a/2,y:i+s/2};switch((null==t?void 0:t.position)??n){case my.Top:return{x:r+a/2,y:i};case my.Right:return{x:r+a,y:i+s/2};case my.Bottom:return{x:r+a/2,y:i+s};case my.Left:return{x:r,y:i+s/2}}}function Sv(e,t){return e&&(t?e.find(e=>e.id===t):e[0])||null}function Ev(e,t){if(!e)return"";if("string"==typeof e)return e;return`${t?`${t}__`:""}${Object.keys(e).sort().map(t=>`${t}=${e[t]}`).join("&")}`}const Cv={nodeOrigin:[0,0],nodeExtent:ty,elevateNodesOnSelect:!0,defaults:{}},Nv={...Cv,checkEquality:!0};function Iv(e,t){const n={...e};for(const o in t)void 0!==t[o]&&(n[o]=t[o]);return n}function Ov(e,t,n,o){var r,i;const a=Iv(Nv,o);let s=e.length>0;const l=new Map(t),u=(null==a?void 0:a.elevateNodesOnSelect)?1e3:0;t.clear(),n.clear();for(const c of e){let e=l.get(c.id);if(a.checkEquality&&c===(null==e?void 0:e.internals.userNode))t.set(c.id,e);else{const n=wy(c,a.nodeOrigin),o=Wy(c.extent)?c.extent:a.nodeExtent,s=Iy(n,o,Xy(c));e={...a.defaults,...c,measured:{width:null==(r=c.measured)?void 0:r.width,height:null==(i=c.measured)?void 0:i.height},internals:{positionAbsolute:s,handleBounds:c.measured?null==e?void 0:e.internals.handleBounds:void 0,z:Pv(c,u),userNode:c}},t.set(c.id,e)}void 0!==e.measured&&void 0!==e.measured.width&&void 0!==e.measured.height||e.hidden||(s=!1),c.parentId&&Av(e,t,n,o)}return s}function Av(e,t,n,o){const{elevateNodesOnSelect:r,nodeOrigin:i,nodeExtent:a}=Iv(Cv,o),s=e.parentId,l=t.get(s);if(!l)return;!function(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}(e,n);const u=r?1e3:0,{x:c,y:d,z:p}=function(e,t,n,o,r){const{x:i,y:a}=t.internals.positionAbsolute,s=Xy(e),l=wy(e,n),u=Wy(e.extent)?Iy(l,e.extent,s):l;let c=Iy({x:i+u.x,y:a+u.y},o,s);"parent"===e.extent&&(c=Oy(c,s,t));const d=Pv(e,r),p=t.internals.z??0;return{x:c.x,y:c.y,z:p>=d?p+1:d}}(e,l,i,a,u),{positionAbsolute:h}=e.internals,f=c!==h.x||d!==h.y;(f||p!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:f?{x:c,y:d}:h,z:p}})}function Pv(e,t){return(Ly(e.zIndex)?e.zIndex:0)+(e.selected?t:0)}function Tv(e,t,n,o=[0,0]){var r;const i=[],a=new Map;for(const s of e){const e=t.get(s.parentId);if(!e)continue;const n=(null==(r=a.get(s.parentId))?void 0:r.expandedRect)??$y(e),o=Zy(n,s.rect);a.set(s.parentId,{expandedRect:o,parent:e})}return a.size>0&&a.forEach(({expandedRect:t,parent:r},a)=>{var s;const l=r.internals.positionAbsolute,u=Xy(r),c=r.origin??o,d=t.x<l.x?Math.round(Math.abs(l.x-t.x)):0,p=t.y<l.y?Math.round(Math.abs(l.y-t.y)):0,h=Math.max(u.width,Math.round(t.width)),f=Math.max(u.height,Math.round(t.height)),m=(h-u.width)*c[0],g=(f-u.height)*c[1];(d>0||p>0||m||g)&&(i.push({id:a,type:"position",position:{x:r.position.x-d+m,y:r.position.y-p+g}}),null==(s=n.get(a))||s.forEach(t=>{e.some(e=>e.id===t.id)||i.push({id:t.id,type:"position",position:{x:t.position.x+d,y:t.position.y+p}})})),(u.width<t.width||u.height<t.height||d||p)&&i.push({id:a,type:"dimensions",setAttributes:!0,dimensions:{width:h+(d?c[0]*d-m:0),height:f+(p?c[1]*p-g:0)}})}),i}function Mv(e,t,n,o,r,i){let a=r;const s=o.get(a)||new Map;o.set(a,s.set(n,t)),a=`${r}-${e}`;const l=o.get(a)||new Map;if(o.set(a,l.set(n,t)),i){a=`${r}-${e}-${i}`;const s=o.get(a)||new Map;o.set(a,s.set(n,t))}}function zv(e,t,n){e.clear(),t.clear();for(const o of n){const{source:n,target:r,sourceHandle:i=null,targetHandle:a=null}=o,s={edgeId:o.id,source:n,target:r,sourceHandle:i,targetHandle:a},l=`${n}-${i}--${r}-${a}`;Mv("source",s,`${r}-${a}--${n}-${i}`,e,n,i),Mv("target",s,l,e,r,a),t.set(o.id,o)}}function $v(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return!!n&&(!!n.selected||$v(n,t))}function Rv(e,t,n){var o;let r=e;do{if(null==(o=null==r?void 0:r.matches)?void 0:o.call(r,t))return!0;if(r===n)return!1;r=null==r?void 0:r.parentElement}while(r);return!1}function Zv({nodeId:e,dragItems:t,nodeLookup:n,dragging:o=!0}){var r,i,a;const s=[];for(const[u,c]of t){const e=null==(r=n.get(u))?void 0:r.internals.userNode;e&&s.push({...e,position:c.position,dragging:o})}if(!e)return[s[0],s];const l=null==(i=n.get(e))?void 0:i.internals.userNode;return[l?{...l,position:(null==(a=t.get(e))?void 0:a.position)||l.position,dragging:o}:s[0],s]}function jv({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:o,onDragStop:r}){let i={x:null,y:null},a=0,s=new Map,l=!1,u={x:0,y:0},c=null,d=!1,p=null,h=!1,f=!1;return{update:function({noDragClassName:m,handleSelector:g,domNode:y,isSelectable:v,nodeId:b,nodeClickDistance:_=0}){function w({x:e,y:n},r){const{nodeLookup:a,nodeExtent:l,snapGrid:u,snapToGrid:c,nodeOrigin:d,onNodeDrag:p,onSelectionDrag:h,onError:m,updateNodePositions:g}=t();i={x:e,y:n};let y=!1,v={x:0,y:0,x2:0,y2:0};if(s.size>1&&l){const e=xy(s);v=My(e)}for(const[t,o]of s){if(!a.has(t))continue;let r={x:e-o.distance.x,y:n-o.distance.y};c&&(r=By(r,u));let i=[[l[0][0],l[0][1]],[l[1][0],l[1][1]]];if(s.size>1&&l&&!o.extent){const{positionAbsolute:e}=o.internals,t=e.x-v.x+l[0][0],n=e.x+o.measured.width-v.x2+l[1][0];i=[[t,e.y-v.y+l[0][1]],[n,e.y+o.measured.height-v.y2+l[1][1]]]}const{position:p,positionAbsolute:h}=Ey({nodeId:t,nextPosition:r,nodeLookup:a,nodeExtent:i,nodeOrigin:d,onError:m});y=y||o.position.x!==p.x||o.position.y!==p.y,o.position=p,o.internals.positionAbsolute=h}if(f=f||y,y&&(g(s,!0),r&&(o||p||!b&&h))){const[e,t]=Zv({nodeId:b,dragItems:s,nodeLookup:a});null==o||o(r,s,e,t),null==p||p(r,e,t),b||null==h||h(r,t)}}async function x(){if(!c)return;const{transform:e,panBy:n,autoPanSpeed:o,autoPanOnNodeDrag:r}=t();if(!r)return l=!1,void cancelAnimationFrame(a);const[s,d]=Py(u,c,o);0===s&&0===d||(i.x=(i.x??0)-s/e[2],i.y=(i.y??0)-d/e[2],await n({x:s,y:d})&&w(i,null)),a=requestAnimationFrame(x)}function k(o){var r;const{nodeLookup:a,multiSelectionActive:l,nodesDraggable:u,transform:p,snapGrid:h,snapToGrid:f,selectNodesOnDrag:m,onNodeDragStart:g,onSelectionDragStart:y,unselectNodesAndEdges:_}=t();d=!0,m&&v||l||!b||(null==(r=a.get(b))?void 0:r.selected)||_(),v&&m&&b&&(null==e||e(b));const w=ev(o.sourceEvent,{transform:p,snapGrid:h,snapToGrid:f,containerBounds:c});if(i=w,s=function(e,t,n,o){const r=new Map;for(const[i,a]of e)if((a.selected||a.id===o)&&(!a.parentId||!$v(a,e))&&(a.draggable||t&&void 0===a.draggable)){const t=e.get(i);t&&r.set(i,{id:i,position:t.position||{x:0,y:0},distance:{x:n.x-t.internals.positionAbsolute.x,y:n.y-t.internals.positionAbsolute.y},extent:t.extent,parentId:t.parentId,origin:t.origin,expandParent:t.expandParent,internals:{positionAbsolute:t.internals.positionAbsolute||{x:0,y:0}},measured:{width:t.measured.width??0,height:t.measured.height??0}})}return r}(a,u,w,b),s.size>0&&(n||g||!b&&y)){const[e,t]=Zv({nodeId:b,dragItems:s,nodeLookup:a});null==n||n(o.sourceEvent,s,e,t),null==g||g(o.sourceEvent,e,t),b||null==y||y(o.sourceEvent,t)}}p=bf(y);const S=Mf().clickDistance(_).on("start",e=>{const{domNode:n,nodeDragThreshold:o,transform:r,snapGrid:a,snapToGrid:s}=t();c=(null==n?void 0:n.getBoundingClientRect())||null,h=!1,f=!1,0===o&&k(e);const l=ev(e.sourceEvent,{transform:r,snapGrid:a,snapToGrid:s,containerBounds:c});i=l,u=av(e.sourceEvent,c)}).on("drag",e=>{const{autoPanOnNodeDrag:n,transform:o,snapGrid:r,snapToGrid:a,nodeDragThreshold:p,nodeLookup:f}=t(),m=ev(e.sourceEvent,{transform:o,snapGrid:r,snapToGrid:a,containerBounds:c});if(("touchmove"===e.sourceEvent.type&&e.sourceEvent.touches.length>1||b&&!f.has(b))&&(h=!0),!h){if(!l&&n&&d&&(l=!0,x()),!d){const t=m.xSnapped-(i.x??0),n=m.ySnapped-(i.y??0);Math.sqrt(t*t+n*n)>p&&k(e)}(i.x!==m.xSnapped||i.y!==m.ySnapped)&&s&&d&&(u=av(e.sourceEvent,c),w(m,e.sourceEvent))}}).on("end",e=>{if(d&&!h&&(l=!1,d=!1,cancelAnimationFrame(a),s.size>0)){const{nodeLookup:n,updateNodePositions:o,onNodeDragStop:i,onSelectionDragStop:a}=t();if(f&&(o(s,!1),f=!1),r||i||!b&&a){const[t,o]=Zv({nodeId:b,dragItems:s,nodeLookup:n,dragging:!1});null==r||r(e.sourceEvent,s,t,o),null==i||i(e.sourceEvent,t,o),b||null==a||a(e.sourceEvent,o)}}}).filter(e=>{const t=e.target;return!e.button&&(!m||!Rv(t,`.${m}`,y))&&(!g||Rv(t,g,y))});p.call(S)},destroy:function(){null==p||p.on(".drag",null)}}}function Dv(e,t,n,o){var r,i;let a=[],s=1/0;const l=function(e,t,n){const o=[],r={x:e.x-n,y:e.y-n,width:2*n,height:2*n};for(const i of t.values())jy(r,$y(i))>0&&o.push(i);return o}(e,n,t+250);for(const u of l){const n=[...(null==(r=u.internals.handleBounds)?void 0:r.source)??[],...(null==(i=u.internals.handleBounds)?void 0:i.target)??[]];for(const r of n){if(o.nodeId===r.nodeId&&o.type===r.type&&o.id===r.id)continue;const{x:n,y:i}=kv(u,r,r.position,!0),l=Math.sqrt(Math.pow(n-e.x,2)+Math.pow(i-e.y,2));l>t||(l<s?(a=[{...r,x:n,y:i}],s=l):l===s&&a.push({...r,x:n,y:i}))}}if(!a.length)return null;if(a.length>1){const e="source"===o.type?"target":"source";return a.find(t=>t.type===e)??a[0]}return a[0]}function Lv(e,t,n,o,r,i=!1){var a,s,l;const u=o.get(e);if(!u)return null;const c="strict"===r?null==(a=u.internals.handleBounds)?void 0:a[t]:[...(null==(s=u.internals.handleBounds)?void 0:s.source)??[],...(null==(l=u.internals.handleBounds)?void 0:l.target)??[]],d=(n?null==c?void 0:c.find(e=>e.id===n):null==c?void 0:c[0])??null;return d&&i?{...d,...kv(u,d,d.position,!0)}:d}function Vv(e,t){return e||((null==t?void 0:t.classList.contains("target"))?"target":(null==t?void 0:t.classList.contains("source"))?"source":null)}const Bv=()=>!0;function Fv(e,{handle:t,connectionMode:n,fromNodeId:o,fromHandleId:r,fromType:i,doc:a,lib:s,flowId:l,isValidConnection:u=Bv,nodeLookup:c}){const d="target"===i,p=t?a.querySelector(`.${s}-flow__handle[data-id="${l}-${null==t?void 0:t.nodeId}-${null==t?void 0:t.id}-${null==t?void 0:t.type}"]`):null,{x:h,y:f}=av(e),m=a.elementFromPoint(h,f),g=(null==m?void 0:m.classList.contains(`${s}-flow__handle`))?m:p,y={handleDomNode:g,isValid:!1,connection:null,toHandle:null};if(g){const e=Vv(void 0,g),t=g.getAttribute("data-nodeid"),i=g.getAttribute("data-handleid"),a=g.classList.contains("connectable"),s=g.classList.contains("connectableend");if(!t||!e)return y;const l={source:d?t:o,sourceHandle:d?i:r,target:d?o:t,targetHandle:d?r:i};y.connection=l;const p=a&&s&&(n===ry.Strict?d&&"source"===e||!d&&"target"===e:t!==o||i!==r);y.isValid=p&&u(l),y.toHandle=Lv(t,e,i,c,n,!0)}return y}const Hv={onPointerDown:function(e,{connectionMode:t,connectionRadius:n,handleId:o,nodeId:r,edgeUpdaterType:i,isTarget:a,domNode:s,nodeLookup:l,lib:u,autoPanOnConnect:c,flowId:d,panBy:p,cancelConnection:h,onConnectStart:f,onConnect:m,onConnectEnd:g,isValidConnection:y=Bv,onReconnectEnd:v,updateConnection:b,getTransform:_,getFromHandle:w,autoPanSpeed:x,dragThreshold:k=1}){const S=nv(e.target);let E,C=0;const{x:N,y:I}=av(e),O=null==S?void 0:S.elementFromPoint(N,I),A=Vv(i,O),P=null==s?void 0:s.getBoundingClientRect();let T=!1;if(!P||!A)return;const M=Lv(r,A,o,l,t);if(!M)return;let z=av(e,P),$=!1,R=null,Z=!1,j=null;function D(){if(!c||!P)return;const[e,t]=Py(z,P,x);p({x:e,y:t}),C=requestAnimationFrame(D)}const L={...M,nodeId:r,type:A,position:M.position},V=l.get(r);let B={inProgress:!0,isValid:null,from:kv(V,L,my.Left,!0),fromHandle:L,fromPosition:L.position,fromNode:V,to:z,toHandle:null,toPosition:yy[L.position],toNode:null};function F(){T=!0,b(B),null==f||f(e,{nodeId:r,handleId:o,handleType:A})}function H(e){if(!T){const{x:t,y:n}=av(e),o=t-N,r=n-I;if(!(o*o+r*r>k*k))return;F()}if(!w()||!L)return void U(e);const i=_();z=av(e,P),E=Dv(Fy(z,i,!1,[1,1]),n,l,L),$||(D(),$=!0);const s=Fv(e,{handle:E,connectionMode:t,fromNodeId:r,fromHandleId:o,fromType:a?"target":"source",isValidConnection:y,doc:S,lib:u,flowId:d,nodeLookup:l});j=s.handleDomNode,R=s.connection,Z=function(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}(!!E,s.isValid);const c={...B,isValid:Z,to:s.toHandle&&Z?Hy({x:s.toHandle.x,y:s.toHandle.y},i):z,toHandle:s.toHandle,toPosition:Z&&s.toHandle?s.toHandle.position:yy[L.position],toNode:s.toHandle?l.get(s.toHandle.nodeId):null};Z&&E&&B.toHandle&&c.toHandle&&B.toHandle.type===c.toHandle.type&&B.toHandle.nodeId===c.toHandle.nodeId&&B.toHandle.id===c.toHandle.id&&B.to.x===c.to.x&&B.to.y===c.to.y||(b(c),B=c)}function U(e){if(T){(E||j)&&R&&Z&&(null==m||m(R));const{inProgress:t,...n}=B,o={...n,toPosition:B.toHandle?B.toPosition:null};null==g||g(e,o),i&&(null==v||v(e,o))}h(),cancelAnimationFrame(C),$=!1,Z=!1,R=null,j=null,S.removeEventListener("mousemove",H),S.removeEventListener("mouseup",U),S.removeEventListener("touchmove",H),S.removeEventListener("touchend",U)}0===k&&F(),S.addEventListener("mousemove",H),S.addEventListener("mouseup",U),S.addEventListener("touchmove",H),S.addEventListener("touchend",U)},isValid:Fv};const Uv=e=>({x:e.x,y:e.y,zoom:e.k}),Yv=({x:e,y:t,zoom:n})=>zg.translate(e,t).scale(n),Kv=(e,t)=>e.target.closest(`.${t}`),Wv=(e,t)=>2===t&&Array.isArray(e)&&e.includes(2),Xv=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,qv=(e,t=0,n=Xv,o=()=>{})=>{const r="number"==typeof t&&t>0;return r||o(),r?e.transition().duration(t).ease(n).on("end",o):e},Gv=e=>{const t=e.ctrlKey&&Ky()?10:1;return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*t};function Jv({domNode:e,minZoom:t,maxZoom:n,paneClickDistance:o,translateExtent:r,viewport:i,onPanZoom:a,onPanZoomStart:s,onPanZoomEnd:l,onDraggingChange:u}){const c={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{x:0,y:0,zoom:0},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},d=e.getBoundingClientRect(),p=Hg().clickDistance(!Ly(o)||o<0?0:o).scaleExtent([t,n]).translateExtent(r),h=bf(e).call(p);v({x:i.x,y:i.y,zoom:Ny(i.zoom,t,n)},[[0,0],[d.width,d.height]],r);const f=h.on("wheel.zoom"),m=h.on("dblclick.zoom");function g(e,t){return h?new Promise(n=>{null==p||p.interpolate("linear"===(null==t?void 0:t.interpolate)?Cm:$m).transform(qv(h,null==t?void 0:t.duration,null==t?void 0:t.ease,()=>n(!0)),e)}):Promise.resolve(!1)}function y(){p.on("zoom",null)}async function v(e,t,n){const o=Yv(e),r=null==p?void 0:p.constrain()(o,t,n);return r&&await g(r),new Promise(e=>e(r))}return p.wheelDelta(Gv),{update:function({noWheelClassName:e,noPanClassName:t,onPaneContextMenu:n,userSelectionActive:o,panOnScroll:r,panOnDrag:i,panOnScrollMode:d,panOnScrollSpeed:g,preventScrolling:v,zoomOnPinch:b,zoomOnScroll:_,zoomOnDoubleClick:w,zoomActivationKeyPressed:x,lib:k,onTransformChange:S}){o&&!c.isZoomingOrPanning&&y();const E=r&&!x&&!o?function({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:o,panOnScrollMode:r,panOnScrollSpeed:i,zoomOnPinch:a,onPanZoomStart:s,onPanZoom:l,onPanZoomEnd:u}){return c=>{if(Kv(c,t))return!1;c.preventDefault(),c.stopImmediatePropagation();const d=n.property("__zoom").k||1;if(c.ctrlKey&&a){const e=_f(c),t=Gv(c),r=d*Math.pow(2,t);return void o.scaleTo(n,r,e,c)}const p=1===c.deltaMode?20:1;let h=r===ay.Vertical?0:c.deltaX*p,f=r===ay.Horizontal?0:c.deltaY*p;!Ky()&&c.shiftKey&&r!==ay.Vertical&&(h=c.deltaY*p,f=0),o.translateBy(n,-h/d*i,-f/d*i,{internal:!0});const m=Uv(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling||(e.isPanScrolling=!0,null==s||s(c,m)),e.isPanScrolling&&(null==l||l(c,m),e.panScrollTimeout=setTimeout(()=>{null==u||u(c,m),e.isPanScrolling=!1},150))}}({zoomPanValues:c,noWheelClassName:e,d3Selection:h,d3Zoom:p,panOnScrollMode:d,panOnScrollSpeed:g,zoomOnPinch:b,onPanZoomStart:s,onPanZoom:a,onPanZoomEnd:l}):function({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(o,r){const i="wheel"===o.type,a=!t&&i&&!o.ctrlKey,s=Kv(o,e);if(o.ctrlKey&&i&&s&&o.preventDefault(),a||s)return null;o.preventDefault(),n.call(this,o,r)}}({noWheelClassName:e,preventScrolling:v,d3ZoomHandler:f});if(h.on("wheel.zoom",E,{passive:!1}),!o){const e=function({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return o=>{var r,i,a;if(null==(r=o.sourceEvent)?void 0:r.internal)return;const s=Uv(o.transform);e.mouseButton=(null==(i=o.sourceEvent)?void 0:i.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=s,"mousedown"===(null==(a=o.sourceEvent)?void 0:a.type)&&t(!0),n&&(null==n||n(o.sourceEvent,s))}}({zoomPanValues:c,onDraggingChange:u,onPanZoomStart:s});p.on("start",e);const t=function({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:o,onPanZoom:r}){return i=>{var a,s;e.usedRightMouseButton=!(!n||!Wv(t,e.mouseButton??0)),(null==(a=i.sourceEvent)?void 0:a.sync)||o([i.transform.x,i.transform.y,i.transform.k]),r&&!(null==(s=i.sourceEvent)?void 0:s.internal)&&(null==r||r(i.sourceEvent,Uv(i.transform)))}}({zoomPanValues:c,panOnDrag:i,onPaneContextMenu:!!n,onPanZoom:a,onTransformChange:S});p.on("zoom",t);const o=function({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:o,onPanZoomEnd:r,onPaneContextMenu:i}){return a=>{var s,l,u;if(!(null==(s=a.sourceEvent)?void 0:s.internal)&&(e.isZoomingOrPanning=!1,i&&Wv(t,e.mouseButton??0)&&!e.usedRightMouseButton&&a.sourceEvent&&i(a.sourceEvent),e.usedRightMouseButton=!1,o(!1),r&&(l=e.prevViewport,u=a.transform,l.x!==u.x||l.y!==u.y||l.zoom!==u.k))){const t=Uv(a.transform);e.prevViewport=t,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{null==r||r(a.sourceEvent,t)},n?150:0)}}}({zoomPanValues:c,panOnDrag:i,panOnScroll:r,onPaneContextMenu:n,onPanZoomEnd:l,onDraggingChange:u});p.on("end",o)}const C=function({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:o,panOnScroll:r,zoomOnDoubleClick:i,userSelectionActive:a,noWheelClassName:s,noPanClassName:l,lib:u}){return c=>{var d;const p=e||t,h=n&&c.ctrlKey;if(1===c.button&&"mousedown"===c.type&&(Kv(c,`${u}-flow__node`)||Kv(c,`${u}-flow__edge`)))return!0;if(!(o||p||r||i||n))return!1;if(a)return!1;if(Kv(c,s)&&"wheel"===c.type)return!1;if(Kv(c,l)&&("wheel"!==c.type||r&&"wheel"===c.type&&!e))return!1;if(!n&&c.ctrlKey&&"wheel"===c.type)return!1;if(!n&&"touchstart"===c.type&&(null==(d=c.touches)?void 0:d.length)>1)return c.preventDefault(),!1;if(!p&&!r&&!h&&"wheel"===c.type)return!1;if(!o&&("mousedown"===c.type||"touchstart"===c.type))return!1;if(Array.isArray(o)&&!o.includes(c.button)&&"mousedown"===c.type)return!1;const f=Array.isArray(o)&&o.includes(c.button)||!c.button||c.button<=1;return(!c.ctrlKey||"wheel"===c.type)&&f}}({zoomActivationKeyPressed:x,panOnDrag:i,zoomOnScroll:_,panOnScroll:r,zoomOnDoubleClick:w,zoomOnPinch:b,userSelectionActive:o,noPanClassName:t,noWheelClassName:e,lib:k});p.filter(C),w?h.on("dblclick.zoom",m):h.on("dblclick.zoom",null)},destroy:y,setViewport:async function(e,t){const n=Yv(e);return await g(n,t),new Promise(e=>e(n))},setViewportConstrained:v,getViewport:function(){const e=h?$g(h.node()):{x:0,y:0,k:1};return{x:e.x,y:e.y,zoom:e.k}},scaleTo:function(e,t){return h?new Promise(n=>{null==p||p.interpolate("linear"===(null==t?void 0:t.interpolate)?Cm:$m).scaleTo(qv(h,null==t?void 0:t.duration,null==t?void 0:t.ease,()=>n(!0)),e)}):Promise.resolve(!1)},scaleBy:function(e,t){return h?new Promise(n=>{null==p||p.interpolate("linear"===(null==t?void 0:t.interpolate)?Cm:$m).scaleBy(qv(h,null==t?void 0:t.duration,null==t?void 0:t.ease,()=>n(!0)),e)}):Promise.resolve(!1)},setScaleExtent:function(e){null==p||p.scaleExtent(e)},setTranslateExtent:function(e){null==p||p.translateExtent(e)},syncViewport:function(e){if(h){const t=Yv(e),n=h.property("__zoom");n.k===e.zoom&&n.x===e.x&&n.y===e.y||null==p||p.transform(h,t,null,{sync:!0})}},setClickDistance:function(e){const t=!Ly(e)||e<0?0:e;null==p||p.clickDistance(t)}}}var Qv,eb;function tb(e,t){return Math.max(0,t-e)}function nb(e,t){return Math.max(0,e-t)}function ob(e,t,n){return Math.max(0,t-e,e-n)}function rb(e,t){return e?!t:t}(eb=Qv||(Qv={})).Line="line",eb.Handle="handle";const ib={width:0,height:0,x:0,y:0},ab={...ib,pointerX:0,pointerY:0,aspectRatio:1};function sb(e,t,n){const o=t.position.x+e.position.x,r=t.position.y+e.position.y,i=e.measured.width??0,a=e.measured.height??0,s=n[0]*i,l=n[1]*a;return[[o-s,r-l],[o+i-s,r+a-l]]}function lb({domNode:e,nodeId:t,getStoreItems:n,onChange:o,onEnd:r}){const i=bf(e);return{update:function({controlPosition:e,boundaries:a,keepAspectRatio:s,resizeDirection:l,onResizeStart:u,onResize:c,onResizeEnd:d,shouldResize:p}){let h={...ib},f={...ab};const m=function(e){return{isHorizontal:e.includes("right")||e.includes("left"),isVertical:e.includes("bottom")||e.includes("top"),affectsX:e.includes("left"),affectsY:e.includes("top")}}(e);let g,y,v,b,_=null,w=[];const x=Mf().on("start",e=>{const{nodeLookup:o,transform:r,snapGrid:i,snapToGrid:a,nodeOrigin:s,paneDomNode:l}=n();if(g=o.get(t),!g)return;_=(null==l?void 0:l.getBoundingClientRect())??null;const{xSnapped:c,ySnapped:d}=ev(e.sourceEvent,{transform:r,snapGrid:i,snapToGrid:a,containerBounds:_});h={width:g.measured.width??0,height:g.measured.height??0,x:g.position.x??0,y:g.position.y??0},f={...h,pointerX:c,pointerY:d,aspectRatio:h.width/h.height},y=void 0,g.parentId&&("parent"===g.extent||g.expandParent)&&(y=o.get(g.parentId),v=y&&"parent"===g.extent?function(e){return[[0,0],[e.measured.width,e.measured.height]]}(y):void 0),w=[],b=void 0;for(const[n,u]of o)if(u.parentId===t&&(w.push({id:n,position:{...u.position},extent:u.extent}),"parent"===u.extent||u.expandParent)){const e=sb(u,g,u.origin??s);b=b?[[Math.min(e[0][0],b[0][0]),Math.min(e[0][1],b[0][1])],[Math.max(e[1][0],b[1][0]),Math.max(e[1][1],b[1][1])]]:e}null==u||u(e,{...h})}).on("drag",e=>{const{transform:t,snapGrid:r,snapToGrid:i,nodeOrigin:u}=n(),d=ev(e.sourceEvent,{transform:t,snapGrid:r,snapToGrid:i,containerBounds:_}),x=[];if(!g)return;const{x:k,y:S,width:E,height:C}=h,N={},I=g.origin??u,{width:O,height:A,x:P,y:T}=function(e,t,n,o,r,i,a,s){let{affectsX:l,affectsY:u}=t;const{isHorizontal:c,isVertical:d}=t,p=c&&d,{xSnapped:h,ySnapped:f}=n,{minWidth:m,maxWidth:g,minHeight:y,maxHeight:v}=o,{x:b,y:_,width:w,height:x,aspectRatio:k}=e;let S=Math.floor(c?h-e.pointerX:0),E=Math.floor(d?f-e.pointerY:0);const C=w+(l?-S:S),N=x+(u?-E:E),I=-i[0]*w,O=-i[1]*x;let A=ob(C,m,g),P=ob(N,y,v);if(a){let e=0,t=0;l&&S<0?e=tb(b+S+I,a[0][0]):!l&&S>0&&(e=nb(b+C+I,a[1][0])),u&&E<0?t=tb(_+E+O,a[0][1]):!u&&E>0&&(t=nb(_+N+O,a[1][1])),A=Math.max(A,e),P=Math.max(P,t)}if(s){let e=0,t=0;l&&S>0?e=nb(b+S,s[0][0]):!l&&S<0&&(e=tb(b+C,s[1][0])),u&&E>0?t=nb(_+E,s[0][1]):!u&&E<0&&(t=tb(_+N,s[1][1])),A=Math.max(A,e),P=Math.max(P,t)}if(r){if(c){const e=ob(C/k,y,v)*k;if(A=Math.max(A,e),a){let e=0;e=!l&&!u||l&&!u&&p?nb(_+O+C/k,a[1][1])*k:tb(_+O+(l?S:-S)/k,a[0][1])*k,A=Math.max(A,e)}if(s){let e=0;e=!l&&!u||l&&!u&&p?tb(_+C/k,s[1][1])*k:nb(_+(l?S:-S)/k,s[0][1])*k,A=Math.max(A,e)}}if(d){const e=ob(N*k,m,g)/k;if(P=Math.max(P,e),a){let e=0;e=!l&&!u||u&&!l&&p?nb(b+N*k+I,a[1][0])/k:tb(b+(u?E:-E)*k+I,a[0][0])/k,P=Math.max(P,e)}if(s){let e=0;e=!l&&!u||u&&!l&&p?tb(b+N*k,s[1][0])/k:nb(b+(u?E:-E)*k,s[0][0])/k,P=Math.max(P,e)}}}E+=E<0?P:-P,S+=S<0?A:-A,r&&(p?C>N*k?E=(rb(l,u)?-S:S)/k:S=(rb(l,u)?-E:E)*k:c?(E=S/k,u=l):(S=E*k,l=u));const T=l?b+S:b,M=u?_+E:_;return{width:w+(l?-S:S),height:x+(u?-E:E),x:i[0]*S*(l?-1:1)+T,y:i[1]*E*(u?-1:1)+M}}(f,m,d,a,s,I,v,b),M=O!==E,z=A!==C,$=P!==k&&M,R=T!==S&&z;if(!($||R||M||z))return;if(($||R||1===I[0]||1===I[1])&&(N.x=$?P:h.x,N.y=R?T:h.y,h.x=N.x,h.y=N.y,w.length>0)){const e=P-k,t=T-S;for(const n of w)n.position={x:n.position.x-e+I[0]*(O-E),y:n.position.y-t+I[1]*(A-C)},x.push(n)}if((M||z)&&(N.width=!M||l&&"horizontal"!==l?h.width:O,N.height=!z||l&&"vertical"!==l?h.height:A,h.width=N.width,h.height=N.height),y&&g.expandParent){const e=I[0]*(N.width??0);N.x&&N.x<e&&(h.x=e,f.x=f.x-(N.x-e));const t=I[1]*(N.height??0);N.y&&N.y<t&&(h.y=t,f.y=f.y-(N.y-t))}const Z=function({width:e,prevWidth:t,height:n,prevHeight:o,affectsX:r,affectsY:i}){const a=e-t,s=n-o,l=[a>0?1:a<0?-1:0,s>0?1:s<0?-1:0];return a&&r&&(l[0]=-1*l[0]),s&&i&&(l[1]=-1*l[1]),l}({width:h.width,prevWidth:E,height:h.height,prevHeight:C,affectsX:m.affectsX,affectsY:m.affectsY}),j={...h,direction:Z};!1!==(null==p?void 0:p(e,j))&&(null==c||c(e,j),o(N,x))}).on("end",e=>{null==d||d(e,{...h}),null==r||r({...h})});i.call(x)},destroy:function(){i.on(".drag",null)}}}var ub,cb,db={exports:{}},pb={};const hb=n((cb||(cb=1,db.exports=function(){if(ub)return pb;ub=1;var e=t(),n=Fe(),o="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},r=n.useSyncExternalStore,i=e.useRef,a=e.useEffect,s=e.useMemo,l=e.useDebugValue;return pb.useSyncExternalStoreWithSelector=function(e,t,n,u,c){var d=i(null);if(null===d.current){var p={hasValue:!1,value:null};d.current=p}else p=d.current;d=s(function(){function e(e){if(!a){if(a=!0,r=e,e=u(e),void 0!==c&&p.hasValue){var t=p.value;if(c(t,e))return i=t}return i=e}if(t=i,o(r,e))return t;var n=u(e);return void 0!==c&&c(t,n)?(r=e,t):(r=e,i=n)}var r,i,a=!1,s=void 0===n?null:n;return[function(){return e(t())},null===s?void 0:function(){return e(s())}]},[t,n,u,c]);var h=r(e,d[0],d[1]);return a(function(){p.hasValue=!0,p.value=h},[h]),l(h),h},pb}()),db.exports)),fb=e=>{let t;const n=new Set,o=(e,o)=>{const r="function"==typeof e?e(t):e;if(!Object.is(r,t)){const e=t;t=(null!=o?o:"object"!=typeof r||null===r)?r:Object.assign({},t,r),n.forEach(n=>n(t,e))}},r=()=>t,i={setState:o,getState:r,getInitialState:()=>a,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{n.clear()}},a=t=e(o,r,i);return i},{useDebugValue:mb}=o,{useSyncExternalStoreWithSelector:gb}=hb,yb=e=>e;function vb(e,t=yb,n){const o=gb(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return mb(o),o}const bb=(e,t)=>{const n=(e=>e?fb(e):fb)(e),o=(e,o=t)=>vb(n,e,o);return Object.assign(o,n),o};function _b(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[n,o]of e)if(!Object.is(o,t.get(n)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const o of n)if(!Object.prototype.hasOwnProperty.call(t,o)||!Object.is(e[o],t[o]))return!1;return!0}const wb=r.createContext(null),xb=wb.Provider,kb=Ug();function Sb(e,t){const n=r.useContext(wb);if(null===n)throw new Error(kb);return vb(n,e,t)}function Eb(){const e=r.useContext(wb);if(null===e)throw new Error(kb);return r.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const Cb={display:"none"},Nb={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Ib="react-flow__node-desc",Ob="react-flow__edge-desc",Ab=e=>e.ariaLiveMessage,Pb=e=>e.ariaLabelConfig;function Tb({rfId:t}){const n=Sb(Ab);return e.jsx("div",{id:`react-flow__aria-live-${t}`,"aria-live":"assertive","aria-atomic":"true",style:Nb,children:n})}function Mb({rfId:t,disableKeyboardA11y:n}){const o=Sb(Pb);return e.jsxs(e.Fragment,{children:[e.jsx("div",{id:`${Ib}-${t}`,style:Cb,children:n?o["node.a11yDescription.default"]:o["node.a11yDescription.keyboardDisabled"]}),e.jsx("div",{id:`${Ob}-${t}`,style:Cb,children:o["edge.a11yDescription.default"]}),!n&&e.jsx(Tb,{rfId:t})]})}const zb=r.forwardRef(({position:t="top-left",children:n,className:o,style:r,...i},a)=>{const s=`${t}`.split("-");return e.jsx("div",{className:eh(["react-flow__panel",o,...s]),style:r,ref:a,...i,children:n})});function $b({proOptions:t,position:n="bottom-right"}){return(null==t?void 0:t.hideAttribution)?null:e.jsx(zb,{position:n,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:e.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}zb.displayName="Panel";const Rb=e=>{const t=[],n=[];for(const[,o]of e.nodeLookup)o.selected&&t.push(o.internals.userNode);for(const[,o]of e.edgeLookup)o.selected&&n.push(o);return{selectedNodes:t,selectedEdges:n}},Zb=e=>e.id;function jb(e,t){return _b(e.selectedNodes.map(Zb),t.selectedNodes.map(Zb))&&_b(e.selectedEdges.map(Zb),t.selectedEdges.map(Zb))}function Db({onSelectionChange:e}){const t=Eb(),{selectedNodes:n,selectedEdges:o}=Sb(Rb,jb);return r.useEffect(()=>{const r={nodes:n,edges:o};null==e||e(r),t.getState().onSelectionChangeHandlers.forEach(e=>e(r))},[n,o,e]),null}const Lb=e=>!!e.onSelectionChangeHandlers;function Vb({onSelectionChange:t}){const n=Sb(Lb);return t||n?e.jsx(Db,{onSelectionChange:t}):null}const Bb=[0,0],Fb={x:0,y:0,zoom:1},Hb=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","paneClickDistance","ariaLabelConfig","rfId"],Ub=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setPaneClickDistance:e.setPaneClickDistance}),Yb={translateExtent:ty,nodeOrigin:Bb,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1",paneClickDistance:0};function Kb(e){const{setNodes:t,setEdges:n,setMinZoom:o,setMaxZoom:i,setTranslateExtent:a,setNodeExtent:s,reset:l,setDefaultNodesAndEdges:u,setPaneClickDistance:c}=Sb(Ub,_b),d=Eb();r.useEffect(()=>(u(e.defaultNodes,e.defaultEdges),()=>{p.current=Yb,l()}),[]);const p=r.useRef(Yb);return r.useEffect(()=>{for(const r of Hb){const l=e[r];l!==p.current[r]&&(void 0!==e[r]&&("nodes"===r?t(l):"edges"===r?n(l):"minZoom"===r?o(l):"maxZoom"===r?i(l):"translateExtent"===r?a(l):"nodeExtent"===r?s(l):"paneClickDistance"===r?c(l):"ariaLabelConfig"===r?d.setState({ariaLabelConfig:Qy(l)}):"fitView"===r?d.setState({fitViewQueued:l}):"fitViewOptions"===r?d.setState({fitViewOptions:l}):d.setState({[r]:l})))}p.current=e},Hb.map(t=>e[t])),null}function Wb(){return"undefined"!=typeof window&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)"):null}const Xb="undefined"!=typeof document?document:null;function qb(e=null,t={target:Xb,actInsideInputWithModifier:!0}){const[n,o]=r.useState(!1),i=r.useRef(!1),a=r.useRef(new Set([])),[s,l]=r.useMemo(()=>{if(null!==e){const t=(Array.isArray(e)?e:[e]).filter(e=>"string"==typeof e).map(e=>e.replace("+","\n").replace("\n\n","\n+").split("\n")),n=t.reduce((e,t)=>e.concat(...t),[]);return[t,n]}return[[],[]]},[e]);return r.useEffect(()=>{const n=(null==t?void 0:t.target)??Xb,r=(null==t?void 0:t.actInsideInputWithModifier)??!0;if(null!==e){const e=e=>{var n,u;i.current=e.ctrlKey||e.metaKey||e.shiftKey||e.altKey;if((!i.current||i.current&&!r)&&rv(e))return!1;const c=Jb(e.code,l);if(a.current.add(e[c]),Gb(s,a.current,!1)){const r=(null==(u=null==(n=e.composedPath)?void 0:n.call(e))?void 0:u[0])||e.target,a="BUTTON"===(null==r?void 0:r.nodeName)||"A"===(null==r?void 0:r.nodeName);!1===t.preventDefault||!i.current&&a||e.preventDefault(),o(!0)}},u=e=>{const t=Jb(e.code,l);Gb(s,a.current,!0)?(o(!1),a.current.clear()):a.current.delete(e[t]),"Meta"===e.key&&a.current.clear(),i.current=!1},c=()=>{a.current.clear(),o(!1)};return null==n||n.addEventListener("keydown",e),null==n||n.addEventListener("keyup",u),window.addEventListener("blur",c),window.addEventListener("contextmenu",c),()=>{null==n||n.removeEventListener("keydown",e),null==n||n.removeEventListener("keyup",u),window.removeEventListener("blur",c),window.removeEventListener("contextmenu",c)}}},[e,o]),n}function Gb(e,t,n){return e.filter(e=>n||e.length===t.size).some(e=>e.every(e=>t.has(e)))}function Jb(e,t){return t.includes(e)?"code":"key"}function Qb(e,t){const n=[],o=new Map,r=[];for(const i of e)if("add"!==i.type)if("remove"===i.type||"replace"===i.type)o.set(i.id,[i]);else{const e=o.get(i.id);e?e.push(i):o.set(i.id,[i])}else r.push(i);for(const i of t){const e=o.get(i.id);if(!e){n.push(i);continue}if("remove"===e[0].type)continue;if("replace"===e[0].type){n.push({...e[0].item});continue}const t={...i};for(const n of e)e_(n,t);n.push(t)}return r.length&&r.forEach(e=>{void 0!==e.index?n.splice(e.index,0,{...e.item}):n.push({...e.item})}),n}function e_(e,t){switch(e.type){case"select":t.selected=e.selected;break;case"position":void 0!==e.position&&(t.position=e.position),void 0!==e.dragging&&(t.dragging=e.dragging);break;case"dimensions":void 0!==e.dimensions&&(t.measured??(t.measured={}),t.measured.width=e.dimensions.width,t.measured.height=e.dimensions.height,e.setAttributes&&(!0!==e.setAttributes&&"width"!==e.setAttributes||(t.width=e.dimensions.width),!0!==e.setAttributes&&"height"!==e.setAttributes||(t.height=e.dimensions.height))),"boolean"==typeof e.resizing&&(t.resizing=e.resizing)}}function t_(e,t){return Qb(e,t)}function n_(e,t){return Qb(e,t)}function o_(e,t){return{id:e,type:"select",selected:t}}function r_(e,t=new Set,n=!1){const o=[];for(const[r,i]of e){const e=t.has(r);void 0===i.selected&&!e||i.selected===e||(n&&(i.selected=e),o.push(o_(i.id,e)))}return o}function i_({items:e=[],lookup:t}){var n;const o=[],r=new Map(e.map(e=>[e.id,e]));for(const[i,a]of e.entries()){const e=t.get(a.id),r=(null==(n=null==e?void 0:e.internals)?void 0:n.userNode)??e;void 0!==r&&r!==a&&o.push({id:a.id,item:a,type:"replace"}),void 0===r&&o.push({item:a,type:"add",index:i})}for(const[i]of t){void 0===r.get(i)&&o.push({id:i,type:"remove"})}return o}function a_(e){return{id:e.id,type:"remove"}}const s_=e=>(e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e))(e);function l_(e){return r.forwardRef(e)}const u_="undefined"!=typeof window?r.useLayoutEffect:r.useEffect;function c_(e){const[t,n]=r.useState(BigInt(0)),[o]=r.useState(()=>function(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:n=>{t.push(n),e()}}}(()=>n(e=>e+BigInt(1))));return u_(()=>{const t=o.get();t.length&&(e(t),o.reset())},[t]),o}const d_=r.createContext(null);function p_({children:t}){const n=Eb(),o=c_(r.useCallback(e=>{const{nodes:t=[],setNodes:o,hasDefaultNodes:r,onNodesChange:i,nodeLookup:a,fitViewQueued:s}=n.getState();let l=t;for(const n of e)l="function"==typeof n?n(l):n;const u=i_({items:l,lookup:a});r&&o(l),u.length>0?null==i||i(u):s&&window.requestAnimationFrame(()=>{const{fitViewQueued:e,nodes:t,setNodes:o}=n.getState();e&&o(t)})},[])),i=c_(r.useCallback(e=>{const{edges:t=[],setEdges:o,hasDefaultEdges:r,onEdgesChange:i,edgeLookup:a}=n.getState();let s=t;for(const n of e)s="function"==typeof n?n(s):n;r?o(s):i&&i(i_({items:s,lookup:a}))},[])),a=r.useMemo(()=>({nodeQueue:o,edgeQueue:i}),[]);return e.jsx(d_.Provider,{value:a,children:t})}const h_=e=>!!e.panZoom;function f_(){const e=(()=>{const e=Eb();return r.useMemo(()=>({zoomIn:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1.2,{duration:null==t?void 0:t.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1/1.2,{duration:null==t?void 0:t.duration}):Promise.resolve(!1)},zoomTo:(t,n)=>{const{panZoom:o}=e.getState();return o?o.scaleTo(t,{duration:null==n?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,n)=>{const{transform:[o,r,i],panZoom:a}=e.getState();return a?(await a.setViewport({x:t.x??o,y:t.y??r,zoom:t.zoom??i},n),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,n,o]=e.getState().transform;return{x:t,y:n,zoom:o}},setCenter:async(t,n,o)=>e.getState().setCenter(t,n,o),fitBounds:async(t,n)=>{const{width:o,height:r,minZoom:i,maxZoom:a,panZoom:s}=e.getState(),l=Yy(t,o,r,i,a,(null==n?void 0:n.padding)??.1);return s?(await s.setViewport(l,{duration:null==n?void 0:n.duration,ease:null==n?void 0:n.ease,interpolate:null==n?void 0:n.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,n={})=>{const{transform:o,snapGrid:r,snapToGrid:i,domNode:a}=e.getState();if(!a)return t;const{x:s,y:l}=a.getBoundingClientRect(),u={x:t.x-s,y:t.y-l},c=n.snapGrid??r,d=n.snapToGrid??i;return Fy(u,o,d,c)},flowToScreenPosition:t=>{const{transform:n,domNode:o}=e.getState();if(!o)return t;const{x:r,y:i}=o.getBoundingClientRect(),a=Hy(t,n);return{x:a.x+r,y:a.y+i}}}),[])})(),t=Eb(),n=function(){const e=r.useContext(d_);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}(),o=Sb(h_),i=r.useMemo(()=>{const e=e=>t.getState().nodeLookup.get(e),o=e=>{n.nodeQueue.push(e)},r=e=>{n.edgeQueue.push(e)},i=e=>{var n,o;const{nodeLookup:r,nodeOrigin:i}=t.getState(),a=s_(e)?e:r.get(e.id),s=a.parentId?Gy(a.position,a.measured,a.parentId,r,i):a.position,l={...a,position:s,width:(null==(n=a.measured)?void 0:n.width)??a.width,height:(null==(o=a.measured)?void 0:o.height)??a.height};return $y(l)},a=(e,t,n={replace:!1})=>{o(o=>o.map(o=>{if(o.id===e){const e="function"==typeof t?t(o):t;return n.replace&&s_(e)?e:{...o,...e}}return o}))},s=(e,t,n={replace:!1})=>{r(o=>o.map(o=>{if(o.id===e){const e="function"==typeof t?t(o):t;return n.replace&&by(e)?e:{...o,...e}}return o}))};return{getNodes:()=>t.getState().nodes.map(e=>({...e})),getNode:t=>{var n;return null==(n=e(t))?void 0:n.internals.userNode},getInternalNode:e,getEdges:()=>{const{edges:e=[]}=t.getState();return e.map(e=>({...e}))},getEdge:e=>t.getState().edgeLookup.get(e),setNodes:o,setEdges:r,addNodes:e=>{const t=Array.isArray(e)?e:[e];n.nodeQueue.push(e=>[...e,...t])},addEdges:e=>{const t=Array.isArray(e)?e:[e];n.edgeQueue.push(e=>[...e,...t])},toObject:()=>{const{nodes:e=[],edges:n=[],transform:o}=t.getState(),[r,i,a]=o;return{nodes:e.map(e=>({...e})),edges:n.map(e=>({...e})),viewport:{x:r,y:i,zoom:a}}},deleteElements:async({nodes:e=[],edges:n=[]})=>{const{nodes:o,edges:r,onNodesDelete:i,onEdgesDelete:a,triggerNodeChanges:s,triggerEdgeChanges:l,onDelete:u,onBeforeDelete:c}=t.getState(),{nodes:d,edges:p}=await Cy({nodesToRemove:e,edgesToRemove:n,nodes:o,edges:r,onBeforeDelete:c}),h=p.length>0,f=d.length>0;if(h){const e=p.map(a_);null==a||a(p),l(e)}if(f){const e=d.map(a_);null==i||i(d),s(e)}return(f||h)&&(null==u||u({nodes:d,edges:p})),{deletedNodes:d,deletedEdges:p}},getIntersectingNodes:(e,n=!0,o)=>{const r=Dy(e),a=r?e:i(e),s=void 0!==o;return a?(o||t.getState().nodes).filter(o=>{const i=t.getState().nodeLookup.get(o.id);if(i&&!r&&(o.id===e.id||!i.internals.positionAbsolute))return!1;const l=$y(s?o:i),u=jy(l,a);return n&&u>0||u>=l.width*l.height||u>=a.width*a.height}):[]},isNodeIntersecting:(e,t,n=!0)=>{const o=Dy(e)?e:i(e);if(!o)return!1;const r=jy(o,t);return n&&r>0||r>=o.width*o.height},updateNode:a,updateNodeData:(e,t,n={replace:!1})=>{a(e,e=>{const o="function"==typeof t?t(e):t;return n.replace?{...e,data:o}:{...e,data:{...e.data,...o}}},n)},updateEdge:s,updateEdgeData:(e,t,n={replace:!1})=>{s(e,e=>{const o="function"==typeof t?t(e):t;return n.replace?{...e,data:o}:{...e,data:{...e.data,...o}}},n)},getNodesBounds:e=>{const{nodeLookup:n,nodeOrigin:o}=t.getState();return((e,t={nodeOrigin:[0,0]})=>{if(0===e.length)return{x:0,y:0,width:0,height:0};const n=e.reduce((e,n)=>{const o="string"==typeof n;let r=t.nodeLookup||o?void 0:n;t.nodeLookup&&(r=o?t.nodeLookup.get(n):_y(n)?n:t.nodeLookup.get(n.id));const i=r?Ry(r,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return Ty(e,i)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return zy(n)})(e,{nodeLookup:n,nodeOrigin:o})},getHandleConnections:({type:e,id:n,nodeId:o})=>{var r;return Array.from((null==(r=t.getState().connectionLookup.get(`${o}-${e}${n?`-${n}`:""}`))?void 0:r.values())??[])},getNodeConnections:({type:e,handleId:n,nodeId:o})=>{var r;return Array.from((null==(r=t.getState().connectionLookup.get(`${o}${e?n?`-${e}-${n}`:`-${e}`:""}`))?void 0:r.values())??[])},fitView:async e=>{const o=t.getState().fitViewResolver??function(){let e,t;return{promise:new Promise((n,o)=>{e=n,t=o}),resolve:e,reject:t}}();return t.setState({fitViewQueued:!0,fitViewOptions:e,fitViewResolver:o}),n.nodeQueue.push(e=>[...e]),o.promise}}},[]);return r.useMemo(()=>({...i,...e,viewportInitialized:o}),[o])}const m_=e=>e.selected,g_="undefined"!=typeof window?window:void 0;const y_={position:"absolute",width:"100%",height:"100%",top:0,left:0},v_=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib});function b_({onPaneContextMenu:t,zoomOnScroll:n=!0,zoomOnPinch:o=!0,panOnScroll:i=!1,panOnScrollSpeed:a=.5,panOnScrollMode:s=ay.Free,zoomOnDoubleClick:l=!0,panOnDrag:u=!0,defaultViewport:c,translateExtent:d,minZoom:p,maxZoom:h,zoomActivationKeyCode:f,preventScrolling:m=!0,children:g,noWheelClassName:y,noPanClassName:v,onViewportChange:b,isControlledViewport:_,paneClickDistance:w}){const x=Eb(),k=r.useRef(null),{userSelectionActive:S,lib:E}=Sb(v_,_b),C=qb(f),N=r.useRef();!function(e){const t=Eb();r.useEffect(()=>{const n=()=>{var n,o;if(!e.current)return!1;const r=tv(e.current);0!==r.height&&0!==r.width||null==(o=(n=t.getState()).onError)||o.call(n,"004",Kg()),t.setState({width:r.width||500,height:r.height||500})};if(e.current){n(),window.addEventListener("resize",n);const t=new ResizeObserver(()=>n());return t.observe(e.current),()=>{window.removeEventListener("resize",n),t&&e.current&&t.unobserve(e.current)}}},[])}(k);const I=r.useCallback(e=>{null==b||b({x:e[0],y:e[1],zoom:e[2]}),_||x.setState({transform:e})},[b,_]);return r.useEffect(()=>{if(k.current){N.current=Jv({domNode:k.current,minZoom:p,maxZoom:h,translateExtent:d,viewport:c,paneClickDistance:w,onDraggingChange:e=>x.setState({paneDragging:e}),onPanZoomStart:(e,t)=>{const{onViewportChangeStart:n,onMoveStart:o}=x.getState();null==o||o(e,t),null==n||n(t)},onPanZoom:(e,t)=>{const{onViewportChange:n,onMove:o}=x.getState();null==o||o(e,t),null==n||n(t)},onPanZoomEnd:(e,t)=>{const{onViewportChangeEnd:n,onMoveEnd:o}=x.getState();null==o||o(e,t),null==n||n(t)}});const{x:e,y:t,zoom:n}=N.current.getViewport();return x.setState({panZoom:N.current,transform:[e,t,n],domNode:k.current.closest(".react-flow")}),()=>{var e;null==(e=N.current)||e.destroy()}}},[]),r.useEffect(()=>{var e;null==(e=N.current)||e.update({onPaneContextMenu:t,zoomOnScroll:n,zoomOnPinch:o,panOnScroll:i,panOnScrollSpeed:a,panOnScrollMode:s,zoomOnDoubleClick:l,panOnDrag:u,zoomActivationKeyPressed:C,preventScrolling:m,noPanClassName:v,userSelectionActive:S,noWheelClassName:y,lib:E,onTransformChange:I})},[t,n,o,i,a,s,l,u,C,m,v,S,y,E,I]),e.jsx("div",{className:"react-flow__renderer",ref:k,style:y_,children:g})}const __=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function w_(){const{userSelectionActive:t,userSelectionRect:n}=Sb(__,_b);return t&&n?e.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:n.width,height:n.height,transform:`translate(${n.x}px, ${n.y}px)`}}):null}const x_=(e,t)=>n=>{n.target===t.current&&(null==e||e(n))},k_=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function S_({isSelecting:t,selectionKeyPressed:n,selectionMode:o=ly.Full,panOnDrag:i,selectionOnDrag:a,onSelectionStart:s,onSelectionEnd:l,onPaneClick:u,onPaneContextMenu:c,onPaneScroll:d,onPaneMouseEnter:p,onPaneMouseMove:h,onPaneMouseLeave:f,children:m}){const g=Eb(),{userSelectionActive:y,elementsSelectable:v,dragging:b,connectionInProgress:_}=Sb(k_,_b),w=v&&(t||y),x=r.useRef(null),k=r.useRef(),S=r.useRef(new Set),E=r.useRef(new Set),C=r.useRef(!1),N=r.useRef(!1),I=e=>{C.current||_?C.current=!1:(null==u||u(e),g.getState().resetSelectedElements(),g.setState({nodesSelectionActive:!1}))},O=d?e=>d(e):void 0,A=!0===i||Array.isArray(i)&&i.includes(0);return e.jsxs("div",{className:eh(["react-flow__pane",{draggable:A,dragging:b,selection:t}]),onClick:w?void 0:x_(I,x),onContextMenu:x_(e=>{Array.isArray(i)&&(null==i?void 0:i.includes(2))?e.preventDefault():null==c||c(e)},x),onWheel:x_(O,x),onPointerEnter:w?void 0:p,onPointerDown:w?e=>{var n,o;const{resetSelectedElements:r,domNode:i}=g.getState();if(k.current=null==i?void 0:i.getBoundingClientRect(),!v||!t||0!==e.button||e.target!==x.current||!k.current)return;null==(o=null==(n=e.target)?void 0:n.setPointerCapture)||o.call(n,e.pointerId),N.current=!0,C.current=!1;const{x:a,y:l}=av(e.nativeEvent,k.current);r(),g.setState({userSelectionRect:{width:0,height:0,startX:a,startY:l,x:a,y:l}}),null==s||s(e)}:h,onPointerMove:w?e=>{const{userSelectionRect:t,transform:n,nodeLookup:r,edgeLookup:i,connectionLookup:a,triggerNodeChanges:s,triggerEdgeChanges:l,defaultEdgeOptions:u}=g.getState();if(!k.current||!t)return;C.current=!0;const{x:c,y:d}=av(e.nativeEvent,k.current),{startX:p,startY:h}=t,f={startX:p,startY:h,x:c<p?c:p,y:d<h?d:h,width:Math.abs(c-p),height:Math.abs(d-h)},m=S.current,y=E.current;S.current=new Set(ky(r,f,n,o===ly.Partial,!0).map(e=>e.id)),E.current=new Set;const v=(null==u?void 0:u.selectable)??!0;for(const o of S.current){const e=a.get(o);if(e)for(const{edgeId:t}of e.values()){const e=i.get(t);e&&(e.selectable??v)&&E.current.add(t)}}if(!Jy(m,S.current)){s(r_(r,S.current,!0))}if(!Jy(y,E.current)){l(r_(i,E.current))}g.setState({userSelectionRect:f,userSelectionActive:!0,nodesSelectionActive:!1})}:h,onPointerUp:w?e=>{var t,o;if(0!==e.button||!N.current)return;null==(o=null==(t=e.target)?void 0:t.releasePointerCapture)||o.call(t,e.pointerId);const{userSelectionRect:r}=g.getState();!y&&r&&e.target===x.current&&(null==I||I(e)),g.setState({userSelectionActive:!1,userSelectionRect:null,nodesSelectionActive:S.current.size>0}),null==l||l(e),(n||a)&&(C.current=!1),N.current=!1}:void 0,onPointerLeave:f,ref:x,style:y_,children:[m,e.jsx(w_,{})]})}function E_({id:e,store:t,unselect:n=!1,nodeRef:o}){const{addSelectedNodes:r,unselectNodesAndEdges:i,multiSelectionActive:a,nodeLookup:s,onError:l}=t.getState(),u=s.get(e);u?(t.setState({nodesSelectionActive:!1}),u.selected?(n||u.selected&&a)&&(i({nodes:[u],edges:[]}),requestAnimationFrame(()=>{var e;return null==(e=null==o?void 0:o.current)?void 0:e.blur()})):r([e])):null==l||l("012",Qg(e))}function C_({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:o,nodeId:i,isSelectable:a,nodeClickDistance:s}){const l=Eb(),[u,c]=r.useState(!1),d=r.useRef();return r.useEffect(()=>{d.current=jv({getStoreItems:()=>l.getState(),onNodeMouseDown:t=>{E_({id:t,store:l,nodeRef:e})},onDragStart:()=>{c(!0)},onDragStop:()=>{c(!1)}})},[]),r.useEffect(()=>{var r,l;if(t)null==(r=d.current)||r.destroy();else if(e.current)return null==(l=d.current)||l.update({noDragClassName:n,handleSelector:o,domNode:e.current,isSelectable:a,nodeId:i,nodeClickDistance:s}),()=>{var e;null==(e=d.current)||e.destroy()}},[n,o,t,a,e,i]),u}function N_(){const e=Eb();return r.useCallback(t=>{const{nodeExtent:n,snapToGrid:o,snapGrid:r,nodesDraggable:i,onError:a,updateNodePositions:s,nodeLookup:l,nodeOrigin:u}=e.getState(),c=new Map,d=(e=>t=>t.selected&&(t.draggable||e&&void 0===t.draggable))(i),p=o?r[0]:5,h=o?r[1]:5,f=t.direction.x*p*t.factor,m=t.direction.y*h*t.factor;for(const[,e]of l){if(!d(e))continue;let t={x:e.internals.positionAbsolute.x+f,y:e.internals.positionAbsolute.y+m};o&&(t=By(t,r));const{position:i,positionAbsolute:s}=Ey({nodeId:e.id,nextPosition:t,nodeLookup:l,nodeExtent:n,nodeOrigin:u,onError:a});e.position=i,e.internals.positionAbsolute=s,c.set(e.id,e)}s(c)},[])}const I_=r.createContext(null),O_=I_.Provider;I_.Consumer;const A_=()=>r.useContext(I_),P_=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId});const T_=r.memo(l_(function({type:t="source",position:n=my.Top,isValidConnection:o,isConnectable:r=!0,isConnectableStart:i=!0,isConnectableEnd:a=!0,id:s,onConnect:l,children:u,className:c,onMouseDown:d,onTouchStart:p,...h},f){var m,g;const y=s||null,v="target"===t,b=Eb(),_=A_(),{connectOnClick:w,noPanClassName:x,rfId:k}=Sb(P_,_b),{connectingFrom:S,connectingTo:E,clickConnecting:C,isPossibleEndHandle:N,connectionInProcess:I,clickConnectionInProcess:O,valid:A}=Sb(((e,t,n)=>o=>{const{connectionClickStartHandle:r,connectionMode:i,connection:a}=o,{fromHandle:s,toHandle:l,isValid:u}=a,c=(null==l?void 0:l.nodeId)===e&&(null==l?void 0:l.id)===t&&(null==l?void 0:l.type)===n;return{connectingFrom:(null==s?void 0:s.nodeId)===e&&(null==s?void 0:s.id)===t&&(null==s?void 0:s.type)===n,connectingTo:c,clickConnecting:(null==r?void 0:r.nodeId)===e&&(null==r?void 0:r.id)===t&&(null==r?void 0:r.type)===n,isPossibleEndHandle:i===ry.Strict?(null==s?void 0:s.type)!==n:e!==(null==s?void 0:s.nodeId)||t!==(null==s?void 0:s.id),connectionInProcess:!!s,clickConnectionInProcess:!!r,valid:c&&u}})(_,y,t),_b);_||null==(g=(m=b.getState()).onError)||g.call(m,"010",Gg());const P=e=>{const{defaultEdgeOptions:t,onConnect:n,hasDefaultEdges:o}=b.getState(),r={...t,...e};if(o){const{edges:e,setEdges:t}=b.getState();t(mv(r,e))}null==n||n(r),null==l||l(r)},T=e=>{if(!_)return;const t=iv(e.nativeEvent);if(i&&(t&&0===e.button||!t)){const t=b.getState();Hv.onPointerDown(e.nativeEvent,{autoPanOnConnect:t.autoPanOnConnect,connectionMode:t.connectionMode,connectionRadius:t.connectionRadius,domNode:t.domNode,nodeLookup:t.nodeLookup,lib:t.lib,isTarget:v,handleId:y,nodeId:_,flowId:t.rfId,panBy:t.panBy,cancelConnection:t.cancelConnection,onConnectStart:t.onConnectStart,onConnectEnd:t.onConnectEnd,updateConnection:t.updateConnection,onConnect:P,isValidConnection:o||t.isValidConnection,getTransform:()=>b.getState().transform,getFromHandle:()=>b.getState().connection.fromHandle,autoPanSpeed:t.autoPanSpeed,dragThreshold:t.connectionDragThreshold})}t?null==d||d(e):null==p||p(e)};return e.jsx("div",{"data-handleid":y,"data-nodeid":_,"data-handlepos":n,"data-id":`${k}-${_}-${y}-${t}`,className:eh(["react-flow__handle",`react-flow__handle-${n}`,"nodrag",x,c,{source:!v,target:v,connectable:r,connectablestart:i,connectableend:a,clickconnecting:C,connectingfrom:S,connectingto:E,valid:A,connectionindicator:r&&(!I||N)&&(I||O?a:i)}]),onMouseDown:T,onTouchStart:T,onClick:w?e=>{const{onClickConnectStart:n,onClickConnectEnd:r,connectionClickStartHandle:a,connectionMode:s,isValidConnection:l,lib:u,rfId:c,nodeLookup:d,connection:p}=b.getState();if(!_||!a&&!i)return;if(!a)return null==n||n(e.nativeEvent,{nodeId:_,handleId:y,handleType:t}),void b.setState({connectionClickStartHandle:{nodeId:_,type:t,id:y}});const h=nv(e.target),f=o||l,{connection:m,isValid:g}=Hv.isValid(e.nativeEvent,{handle:{nodeId:_,id:y,type:t},connectionMode:s,fromNodeId:a.nodeId,fromHandleId:a.id||null,fromType:a.type,isValidConnection:f,flowId:c,doc:h,lib:u,nodeLookup:d});g&&m&&P(m);const v=structuredClone(p);delete v.inProgress,v.toPosition=v.toHandle?v.toHandle.position:null,null==r||r(e,v),b.setState({connectionClickStartHandle:null})}:void 0,ref:f,...h,children:u})}));const M_={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},z_={input:function({data:t,isConnectable:n,sourcePosition:o=my.Bottom}){return e.jsxs(e.Fragment,{children:[null==t?void 0:t.label,e.jsx(T_,{type:"source",position:o,isConnectable:n})]})},default:function({data:t,isConnectable:n,targetPosition:o=my.Top,sourcePosition:r=my.Bottom}){return e.jsxs(e.Fragment,{children:[e.jsx(T_,{type:"target",position:o,isConnectable:n}),null==t?void 0:t.label,e.jsx(T_,{type:"source",position:r,isConnectable:n})]})},output:function({data:t,isConnectable:n,targetPosition:o=my.Top}){return e.jsxs(e.Fragment,{children:[e.jsx(T_,{type:"target",position:o,isConnectable:n}),null==t?void 0:t.label]})},group:function(){return null}};const $_=e=>{const{width:t,height:n,x:o,y:r}=xy(e.nodeLookup,{filter:e=>!!e.selected});return{width:Ly(t)?t:null,height:Ly(n)?n:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${o}px,${r}px)`}};function R_({onSelectionContextMenu:t,noPanClassName:n,disableKeyboardA11y:o}){const i=Eb(),{width:a,height:s,transformString:l,userSelectionActive:u}=Sb($_,_b),c=N_(),d=r.useRef(null);if(r.useEffect(()=>{var e;o||null==(e=d.current)||e.focus({preventScroll:!0})},[o]),C_({nodeRef:d}),u||!a||!s)return null;const p=t?e=>{const n=i.getState().nodes.filter(e=>e.selected);t(e,n)}:void 0;return e.jsx("div",{className:eh(["react-flow__nodesselection","react-flow__container",n]),style:{transform:l},children:e.jsx("div",{ref:d,className:"react-flow__nodesselection-rect",onContextMenu:p,tabIndex:o?void 0:-1,onKeyDown:o?void 0:e=>{Object.prototype.hasOwnProperty.call(M_,e.key)&&(e.preventDefault(),c({direction:M_[e.key],factor:e.shiftKey?4:1}))},style:{width:a,height:s}})})}const Z_="undefined"!=typeof window?window:void 0,j_=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function D_({children:t,onPaneClick:n,onPaneMouseEnter:o,onPaneMouseMove:i,onPaneMouseLeave:a,onPaneContextMenu:s,onPaneScroll:l,paneClickDistance:u,deleteKeyCode:c,selectionKeyCode:d,selectionOnDrag:p,selectionMode:h,onSelectionStart:f,onSelectionEnd:m,multiSelectionKeyCode:g,panActivationKeyCode:y,zoomActivationKeyCode:v,elementsSelectable:b,zoomOnScroll:_,zoomOnPinch:w,panOnScroll:x,panOnScrollSpeed:k,panOnScrollMode:S,zoomOnDoubleClick:E,panOnDrag:C,defaultViewport:N,translateExtent:I,minZoom:O,maxZoom:A,preventScrolling:P,onSelectionContextMenu:T,noWheelClassName:M,noPanClassName:z,disableKeyboardA11y:$,onViewportChange:R,isControlledViewport:Z}){const{nodesSelectionActive:j,userSelectionActive:D}=Sb(j_),L=qb(d,{target:Z_}),V=qb(y,{target:Z_}),B=V||C,F=V||x,H=p&&!0!==B,U=L||D||H;return function({deleteKeyCode:e,multiSelectionKeyCode:t}){const n=Eb(),{deleteElements:o}=f_(),i=qb(e,{actInsideInputWithModifier:!1}),a=qb(t,{target:g_});r.useEffect(()=>{if(i){const{edges:e,nodes:t}=n.getState();o({nodes:t.filter(m_),edges:e.filter(m_)}),n.setState({nodesSelectionActive:!1})}},[i]),r.useEffect(()=>{n.setState({multiSelectionActive:a})},[a])}({deleteKeyCode:c,multiSelectionKeyCode:g}),e.jsx(b_,{onPaneContextMenu:s,elementsSelectable:b,zoomOnScroll:_,zoomOnPinch:w,panOnScroll:F,panOnScrollSpeed:k,panOnScrollMode:S,zoomOnDoubleClick:E,panOnDrag:!L&&B,defaultViewport:N,translateExtent:I,minZoom:O,maxZoom:A,zoomActivationKeyCode:v,preventScrolling:P,noWheelClassName:M,noPanClassName:z,onViewportChange:R,isControlledViewport:Z,paneClickDistance:u,children:e.jsxs(S_,{onSelectionStart:f,onSelectionEnd:m,onPaneClick:n,onPaneMouseEnter:o,onPaneMouseMove:i,onPaneMouseLeave:a,onPaneContextMenu:s,onPaneScroll:l,panOnDrag:B,isSelecting:!!U,selectionMode:h,selectionKeyPressed:L,selectionOnDrag:H,children:[t,j&&e.jsx(R_,{onSelectionContextMenu:T,noPanClassName:z,disableKeyboardA11y:$})]})})}D_.displayName="FlowRenderer";const L_=r.memo(D_);function V_(e){return Sb(r.useCallback((e=>t=>e?ky(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(e=>e.id):Array.from(t.nodeLookup.keys()))(e),[e]),_b)}const B_=e=>e.updateNodeInternals;function F_({id:t,onClick:n,onMouseEnter:o,onMouseMove:i,onMouseLeave:a,onContextMenu:s,onDoubleClick:l,nodesDraggable:u,elementsSelectable:c,nodesConnectable:d,nodesFocusable:p,resizeObserver:h,noDragClassName:f,noPanClassName:m,disableKeyboardA11y:g,rfId:y,nodeTypes:v,nodeClickDistance:b,onError:_}){const{node:w,internals:x,isParent:k}=Sb(e=>{const n=e.nodeLookup.get(t),o=e.parentLookup.has(t);return{node:n,internals:n.internals,isParent:o}},_b);let S=w.type||"default",E=(null==v?void 0:v[S])||z_[S];void 0===E&&(null==_||_("003",Yg(S)),S="default",E=(null==v?void 0:v.default)||z_.default);const C=!!(w.draggable||u&&void 0===w.draggable),N=!!(w.selectable||c&&void 0===w.selectable),I=!!(w.connectable||d&&void 0===w.connectable),O=!!(w.focusable||p&&void 0===w.focusable),A=Eb(),P=qy(w),T=function({node:e,nodeType:t,hasDimensions:n,resizeObserver:o}){const i=Eb(),a=r.useRef(null),s=r.useRef(null),l=r.useRef(e.sourcePosition),u=r.useRef(e.targetPosition),c=r.useRef(t),d=n&&!!e.internals.handleBounds;return r.useEffect(()=>{!a.current||e.hidden||d&&s.current===a.current||(s.current&&(null==o||o.unobserve(s.current)),null==o||o.observe(a.current),s.current=a.current)},[d,e.hidden]),r.useEffect(()=>()=>{s.current&&(null==o||o.unobserve(s.current),s.current=null)},[]),r.useEffect(()=>{if(a.current){const n=c.current!==t,o=l.current!==e.sourcePosition,r=u.current!==e.targetPosition;(n||o||r)&&(c.current=t,l.current=e.sourcePosition,u.current=e.targetPosition,i.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:a.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),a}({node:w,nodeType:S,hasDimensions:P,resizeObserver:h}),M=C_({nodeRef:T,disabled:w.hidden||!C,noDragClassName:f,handleSelector:w.dragHandle,nodeId:t,isSelectable:N,nodeClickDistance:b}),z=N_();if(w.hidden)return null;const $=Xy(w),R=function(e){var t,n,o,r;return void 0===e.internals.handleBounds?{width:e.width??e.initialWidth??(null==(t=e.style)?void 0:t.width),height:e.height??e.initialHeight??(null==(n=e.style)?void 0:n.height)}:{width:e.width??(null==(o=e.style)?void 0:o.width),height:e.height??(null==(r=e.style)?void 0:r.height)}}(w),Z=N||C||n||o||i||a,j=o?e=>o(e,{...x.userNode}):void 0,D=i?e=>i(e,{...x.userNode}):void 0,L=a?e=>a(e,{...x.userNode}):void 0,V=s?e=>s(e,{...x.userNode}):void 0,B=l?e=>l(e,{...x.userNode}):void 0;return e.jsx("div",{className:eh(["react-flow__node",`react-flow__node-${S}`,{[m]:C},w.className,{selected:w.selected,selectable:N,parent:k,draggable:C,dragging:M}]),ref:T,style:{zIndex:x.z,transform:`translate(${x.positionAbsolute.x}px,${x.positionAbsolute.y}px)`,pointerEvents:Z?"all":"none",visibility:P?"visible":"hidden",...w.style,...R},"data-id":t,"data-testid":`rf__node-${t}`,onMouseEnter:j,onMouseMove:D,onMouseLeave:L,onContextMenu:V,onClick:e=>{const{selectNodesOnDrag:o,nodeDragThreshold:r}=A.getState();N&&(!o||!C||r>0)&&E_({id:t,store:A,nodeRef:T}),n&&n(e,{...x.userNode})},onDoubleClick:B,onKeyDown:O?e=>{if(!rv(e.nativeEvent)&&!g)if(ny.includes(e.key)&&N){const n="Escape"===e.key;E_({id:t,store:A,unselect:n,nodeRef:T})}else if(C&&w.selected&&Object.prototype.hasOwnProperty.call(M_,e.key)){e.preventDefault();const{ariaLabelConfig:t}=A.getState();A.setState({ariaLiveMessage:t["node.a11yDescription.ariaLiveMessage"]({direction:e.key.replace("Arrow","").toLowerCase(),x:~~x.positionAbsolute.x,y:~~x.positionAbsolute.y})}),z({direction:M_[e.key],factor:e.shiftKey?4:1})}}:void 0,tabIndex:O?0:void 0,onFocus:O?()=>{var e;if(g||!(null==(e=T.current)?void 0:e.matches(":focus-visible")))return;const{transform:n,width:o,height:r,autoPanOnNodeFocus:i,setCenter:a}=A.getState();if(!i)return;ky(new Map([[t,w]]),{x:0,y:0,width:o,height:r},n,!0).length>0||a(w.position.x+$.width/2,w.position.y+$.height/2,{zoom:n[2]})}:void 0,role:w.ariaRole??(O?"group":void 0),"aria-roledescription":"node","aria-describedby":g?void 0:`${Ib}-${y}`,"aria-label":w.ariaLabel,...w.domAttributes,children:e.jsx(O_,{value:t,children:e.jsx(E,{id:t,data:w.data,type:S,positionAbsoluteX:x.positionAbsolute.x,positionAbsoluteY:x.positionAbsolute.y,selected:w.selected??!1,selectable:N,draggable:C,deletable:w.deletable??!0,isConnectable:I,sourcePosition:w.sourcePosition,targetPosition:w.targetPosition,dragging:M,dragHandle:w.dragHandle,zIndex:x.z,parentId:w.parentId,...$})})})}const H_=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function U_(t){const{nodesDraggable:n,nodesConnectable:o,nodesFocusable:i,elementsSelectable:a,onError:s}=Sb(H_,_b),l=V_(t.onlyRenderVisibleElements),u=function(){const e=Sb(B_),[t]=r.useState(()=>"undefined"==typeof ResizeObserver?null:new ResizeObserver(t=>{const n=new Map;t.forEach(e=>{const t=e.target.getAttribute("data-id");n.set(t,{id:t,nodeElement:e.target,force:!0})}),e(n)}));return r.useEffect(()=>()=>{null==t||t.disconnect()},[t]),t}();return e.jsx("div",{className:"react-flow__nodes",style:y_,children:l.map(r=>e.jsx(F_,{id:r,nodeTypes:t.nodeTypes,nodeExtent:t.nodeExtent,onClick:t.onNodeClick,onMouseEnter:t.onNodeMouseEnter,onMouseMove:t.onNodeMouseMove,onMouseLeave:t.onNodeMouseLeave,onContextMenu:t.onNodeContextMenu,onDoubleClick:t.onNodeDoubleClick,noDragClassName:t.noDragClassName,noPanClassName:t.noPanClassName,rfId:t.rfId,disableKeyboardA11y:t.disableKeyboardA11y,resizeObserver:u,nodesDraggable:n,nodesConnectable:o,nodesFocusable:i,elementsSelectable:a,nodeClickDistance:t.nodeClickDistance,onError:s},r))})}U_.displayName="NodeRenderer";const Y_=r.memo(U_);const K_={[hy.Arrow]:({color:t="none",strokeWidth:n=1})=>e.jsx("polyline",{style:{stroke:t,strokeWidth:n},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),[hy.ArrowClosed]:({color:t="none",strokeWidth:n=1})=>e.jsx("polyline",{style:{stroke:t,fill:t,strokeWidth:n},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})};const W_=({id:t,type:n,color:o,width:i=12.5,height:a=12.5,markerUnits:s="strokeWidth",strokeWidth:l,orient:u="auto-start-reverse"})=>{const c=function(e){const t=Eb();return r.useMemo(()=>{var n,o;return Object.prototype.hasOwnProperty.call(K_,e)?K_[e]:(null==(o=(n=t.getState()).onError)||o.call(n,"009",Xg(e)),null)},[e])}(n);return c?e.jsx("marker",{className:"react-flow__arrowhead",id:t,markerWidth:`${i}`,markerHeight:`${a}`,viewBox:"-10 -10 20 20",markerUnits:s,orient:u,refX:"0",refY:"0",children:e.jsx(c,{color:o,strokeWidth:l})}):null},X_=({defaultColor:t,rfId:n})=>{const o=Sb(e=>e.edges),i=Sb(e=>e.defaultEdgeOptions),a=r.useMemo(()=>{const e=function(e,{id:t,defaultColor:n,defaultMarkerStart:o,defaultMarkerEnd:r}){const i=new Set;return e.reduce((e,a)=>([a.markerStart||o,a.markerEnd||r].forEach(o=>{if(o&&"object"==typeof o){const r=Ev(o,t);i.has(r)||(e.push({id:r,color:o.color||n,...o}),i.add(r))}}),e),[]).sort((e,t)=>e.id.localeCompare(t.id))}(o,{id:n,defaultColor:t,defaultMarkerStart:null==i?void 0:i.markerStart,defaultMarkerEnd:null==i?void 0:i.markerEnd});return e},[o,i,n,t]);return a.length?e.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:e.jsx("defs",{children:a.map(t=>e.jsx(W_,{id:t.id,type:t.type,color:t.color,width:t.width,height:t.height,markerUnits:t.markerUnits,strokeWidth:t.strokeWidth,orient:t.orient},t.id))})}):null};X_.displayName="MarkerDefinitions";var q_=r.memo(X_);function G_({x:t,y:n,label:o,labelStyle:i,labelShowBg:a=!0,labelBgStyle:s,labelBgPadding:l=[2,4],labelBgBorderRadius:u=2,children:c,className:d,...p}){const[h,f]=r.useState({x:1,y:0,width:0,height:0}),m=eh(["react-flow__edge-textwrapper",d]),g=r.useRef(null);return r.useEffect(()=>{if(g.current){const e=g.current.getBBox();f({x:e.x,y:e.y,width:e.width,height:e.height})}},[o]),o?e.jsxs("g",{transform:`translate(${t-h.width/2} ${n-h.height/2})`,className:m,visibility:h.width?"visible":"hidden",...p,children:[a&&e.jsx("rect",{width:h.width+2*l[0],x:-l[0],y:-l[1],height:h.height+2*l[1],className:"react-flow__edge-textbg",style:s,rx:u,ry:u}),e.jsx("text",{className:"react-flow__edge-text",y:h.height/2,dy:"0.3em",ref:g,style:i,children:o}),c]}):null}G_.displayName="EdgeText";const J_=r.memo(G_);function Q_({path:t,labelX:n,labelY:o,label:r,labelStyle:i,labelShowBg:a,labelBgStyle:s,labelBgPadding:l,labelBgBorderRadius:u,interactionWidth:c=20,...d}){return e.jsxs(e.Fragment,{children:[e.jsx("path",{...d,d:t,fill:"none",className:eh(["react-flow__edge-path",d.className])}),c&&e.jsx("path",{d:t,fill:"none",strokeOpacity:0,strokeWidth:c,className:"react-flow__edge-interaction"}),r&&Ly(n)&&Ly(o)?e.jsx(J_,{x:n,y:o,label:r,labelStyle:i,labelShowBg:a,labelBgStyle:s,labelBgPadding:l,labelBgBorderRadius:u}):null]})}function ew({pos:e,x1:t,y1:n,x2:o,y2:r}){return e===my.Left||e===my.Right?[.5*(t+o),n]:[t,.5*(n+r)]}function tw({sourceX:e,sourceY:t,sourcePosition:n=my.Bottom,targetX:o,targetY:r,targetPosition:i=my.Top}){const[a,s]=ew({pos:n,x1:e,y1:t,x2:o,y2:r}),[l,u]=ew({pos:i,x1:o,y1:r,x2:e,y2:t}),[c,d,p,h]=lv({sourceX:e,sourceY:t,targetX:o,targetY:r,sourceControlX:a,sourceControlY:s,targetControlX:l,targetControlY:u});return[`M${e},${t} C${a},${s} ${l},${u} ${o},${r}`,c,d,p,h]}function nw(t){return r.memo(({id:n,sourceX:o,sourceY:r,targetX:i,targetY:a,sourcePosition:s,targetPosition:l,label:u,labelStyle:c,labelShowBg:d,labelBgStyle:p,labelBgPadding:h,labelBgBorderRadius:f,style:m,markerEnd:g,markerStart:y,interactionWidth:v})=>{const[b,_,w]=tw({sourceX:o,sourceY:r,sourcePosition:s,targetX:i,targetY:a,targetPosition:l}),x=t.isInternal?void 0:n;return e.jsx(Q_,{id:x,path:b,labelX:_,labelY:w,label:u,labelStyle:c,labelShowBg:d,labelBgStyle:p,labelBgPadding:h,labelBgBorderRadius:f,style:m,markerEnd:g,markerStart:y,interactionWidth:v})})}const ow=nw({isInternal:!1}),rw=nw({isInternal:!0});function iw(t){return r.memo(({id:n,sourceX:o,sourceY:r,targetX:i,targetY:a,label:s,labelStyle:l,labelShowBg:u,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:p,style:h,sourcePosition:f=my.Bottom,targetPosition:m=my.Top,markerEnd:g,markerStart:y,pathOptions:v,interactionWidth:b})=>{const[_,w,x]=_v({sourceX:o,sourceY:r,sourcePosition:f,targetX:i,targetY:a,targetPosition:m,borderRadius:null==v?void 0:v.borderRadius,offset:null==v?void 0:v.offset,stepPosition:null==v?void 0:v.stepPosition}),k=t.isInternal?void 0:n;return e.jsx(Q_,{id:k,path:_,labelX:w,labelY:x,label:s,labelStyle:l,labelShowBg:u,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:p,style:h,markerEnd:g,markerStart:y,interactionWidth:b})})}ow.displayName="SimpleBezierEdge",rw.displayName="SimpleBezierEdgeInternal";const aw=iw({isInternal:!1}),sw=iw({isInternal:!0});function lw(t){return r.memo(({id:n,...o})=>{var i;const a=t.isInternal?void 0:n;return e.jsx(aw,{...o,id:a,pathOptions:r.useMemo(()=>{var e;return{borderRadius:0,offset:null==(e=o.pathOptions)?void 0:e.offset}},[null==(i=o.pathOptions)?void 0:i.offset])})})}aw.displayName="SmoothStepEdge",sw.displayName="SmoothStepEdgeInternal";const uw=lw({isInternal:!1}),cw=lw({isInternal:!0});function dw(t){return r.memo(({id:n,sourceX:o,sourceY:r,targetX:i,targetY:a,label:s,labelStyle:l,labelShowBg:u,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:p,style:h,markerEnd:f,markerStart:m,interactionWidth:g})=>{const[y,v,b]=gv({sourceX:o,sourceY:r,targetX:i,targetY:a}),_=t.isInternal?void 0:n;return e.jsx(Q_,{id:_,path:y,labelX:v,labelY:b,label:s,labelStyle:l,labelShowBg:u,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:p,style:h,markerEnd:f,markerStart:m,interactionWidth:g})})}uw.displayName="StepEdge",cw.displayName="StepEdgeInternal";const pw=dw({isInternal:!1}),hw=dw({isInternal:!0});function fw(t){return r.memo(({id:n,sourceX:o,sourceY:r,targetX:i,targetY:a,sourcePosition:s=my.Bottom,targetPosition:l=my.Top,label:u,labelStyle:c,labelShowBg:d,labelBgStyle:p,labelBgPadding:h,labelBgBorderRadius:f,style:m,markerEnd:g,markerStart:y,pathOptions:v,interactionWidth:b})=>{const[_,w,x]=dv({sourceX:o,sourceY:r,sourcePosition:s,targetX:i,targetY:a,targetPosition:l,curvature:null==v?void 0:v.curvature}),k=t.isInternal?void 0:n;return e.jsx(Q_,{id:k,path:_,labelX:w,labelY:x,label:u,labelStyle:c,labelShowBg:d,labelBgStyle:p,labelBgPadding:h,labelBgBorderRadius:f,style:m,markerEnd:g,markerStart:y,interactionWidth:b})})}pw.displayName="StraightEdge",hw.displayName="StraightEdgeInternal";const mw=fw({isInternal:!1}),gw=fw({isInternal:!0});mw.displayName="BezierEdge",gw.displayName="BezierEdgeInternal";const yw={default:gw,straight:hw,step:cw,smoothstep:sw,simplebezier:rw},vw={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},bw=(e,t,n)=>n===my.Left?e-t:n===my.Right?e+t:e,_w=(e,t,n)=>n===my.Top?e-t:n===my.Bottom?e+t:e,ww="react-flow__edgeupdater";function xw({position:t,centerX:n,centerY:o,radius:r=10,onMouseDown:i,onMouseEnter:a,onMouseOut:s,type:l}){return e.jsx("circle",{onMouseDown:i,onMouseEnter:a,onMouseOut:s,className:eh([ww,`${ww}-${l}`]),cx:bw(n,r,t),cy:_w(o,r,t),r:r,stroke:"transparent",fill:"transparent"})}function kw({isReconnectable:t,reconnectRadius:n,edge:o,sourceX:r,sourceY:i,targetX:a,targetY:s,sourcePosition:l,targetPosition:u,onReconnect:c,onReconnectStart:d,onReconnectEnd:p,setReconnecting:h,setUpdateHover:f}){const m=Eb(),g=(e,t)=>{if(0!==e.button)return;const{autoPanOnConnect:n,domNode:r,isValidConnection:i,connectionMode:a,connectionRadius:s,lib:l,onConnectStart:u,onConnectEnd:f,cancelConnection:g,nodeLookup:y,rfId:v,panBy:b,updateConnection:_}=m.getState(),w="target"===t.type;Hv.onPointerDown(e.nativeEvent,{autoPanOnConnect:n,connectionMode:a,connectionRadius:s,domNode:r,handleId:t.id,nodeId:t.nodeId,nodeLookup:y,isTarget:w,edgeUpdaterType:t.type,lib:l,flowId:v,cancelConnection:g,panBy:b,isValidConnection:i,onConnect:e=>null==c?void 0:c(o,e),onConnectStart:(n,r)=>{h(!0),null==d||d(e,o,t.type),null==u||u(n,r)},onConnectEnd:f,onReconnectEnd:(e,n)=>{h(!1),null==p||p(e,o,t.type,n)},updateConnection:_,getTransform:()=>m.getState().transform,getFromHandle:()=>m.getState().connection.fromHandle,dragThreshold:m.getState().connectionDragThreshold})},y=()=>f(!0),v=()=>f(!1);return e.jsxs(e.Fragment,{children:[(!0===t||"source"===t)&&e.jsx(xw,{position:l,centerX:r,centerY:i,radius:n,onMouseDown:e=>g(e,{nodeId:o.target,id:o.targetHandle??null,type:"target"}),onMouseEnter:y,onMouseOut:v,type:"source"}),(!0===t||"target"===t)&&e.jsx(xw,{position:u,centerX:a,centerY:s,radius:n,onMouseDown:e=>g(e,{nodeId:o.source,id:o.sourceHandle??null,type:"source"}),onMouseEnter:y,onMouseOut:v,type:"target"})]})}function Sw({id:t,edgesFocusable:n,edgesReconnectable:o,elementsSelectable:i,onClick:a,onDoubleClick:s,onContextMenu:l,onMouseEnter:u,onMouseMove:c,onMouseLeave:d,reconnectRadius:p,onReconnect:h,onReconnectStart:f,onReconnectEnd:m,rfId:g,edgeTypes:y,noPanClassName:v,onError:b,disableKeyboardA11y:_}){let w=Sb(e=>e.edgeLookup.get(t));const x=Sb(e=>e.defaultEdgeOptions);w=x?{...x,...w}:w;let k=w.type||"default",S=(null==y?void 0:y[k])||yw[k];void 0===S&&(null==b||b("011",Jg(k)),k="default",S=(null==y?void 0:y.default)||yw.default);const E=!!(w.focusable||n&&void 0===w.focusable),C=void 0!==h&&(w.reconnectable||o&&void 0===w.reconnectable),N=!!(w.selectable||i&&void 0===w.selectable),I=r.useRef(null),[O,A]=r.useState(!1),[P,T]=r.useState(!1),M=Eb(),{zIndex:z,sourceX:$,sourceY:R,targetX:Z,targetY:j,sourcePosition:D,targetPosition:L}=Sb(r.useCallback(e=>{const n=e.nodeLookup.get(w.source),o=e.nodeLookup.get(w.target);if(!n||!o)return{zIndex:w.zIndex,...vw};const r=function(e){var t;const{sourceNode:n,targetNode:o}=e;if(!wv(n)||!wv(o))return null;const r=n.internals.handleBounds||xv(n.handles),i=o.internals.handleBounds||xv(o.handles),a=Sv((null==r?void 0:r.source)??[],e.sourceHandle),s=Sv(e.connectionMode===ry.Strict?(null==i?void 0:i.target)??[]:((null==i?void 0:i.target)??[]).concat((null==i?void 0:i.source)??[]),e.targetHandle);if(!a||!s)return null==(t=e.onError)||t.call(e,"008",qg(a?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const l=(null==a?void 0:a.position)||my.Bottom,u=(null==s?void 0:s.position)||my.Top,c=kv(n,a,l),d=kv(o,s,u);return{sourceX:c.x,sourceY:c.y,targetX:d.x,targetY:d.y,sourcePosition:l,targetPosition:u}}({id:t,sourceNode:n,targetNode:o,sourceHandle:w.sourceHandle||null,targetHandle:w.targetHandle||null,connectionMode:e.connectionMode,onError:b}),i=function({sourceNode:e,targetNode:t,selected:n=!1,zIndex:o,elevateOnSelect:r=!1}){return void 0!==o?o:(r&&n?1e3:0)+Math.max(e.parentId?e.internals.z:0,t.parentId?t.internals.z:0)}({selected:w.selected,zIndex:w.zIndex,sourceNode:n,targetNode:o,elevateOnSelect:e.elevateEdgesOnSelect});return{zIndex:i,...r||vw}},[w.source,w.target,w.sourceHandle,w.targetHandle,w.selected,w.zIndex]),_b),V=r.useMemo(()=>w.markerStart?`url('#${Ev(w.markerStart,g)}')`:void 0,[w.markerStart,g]),B=r.useMemo(()=>w.markerEnd?`url('#${Ev(w.markerEnd,g)}')`:void 0,[w.markerEnd,g]);if(w.hidden||null===$||null===R||null===Z||null===j)return null;const F=s?e=>{s(e,{...w})}:void 0,H=l?e=>{l(e,{...w})}:void 0,U=u?e=>{u(e,{...w})}:void 0,Y=c?e=>{c(e,{...w})}:void 0,K=d?e=>{d(e,{...w})}:void 0;return e.jsx("svg",{style:{zIndex:z},children:e.jsxs("g",{className:eh(["react-flow__edge",`react-flow__edge-${k}`,w.className,v,{selected:w.selected,animated:w.animated,inactive:!N&&!a,updating:O,selectable:N}]),onClick:e=>{var n;const{addSelectedEdges:o,unselectNodesAndEdges:r,multiSelectionActive:i}=M.getState();N&&(M.setState({nodesSelectionActive:!1}),w.selected&&i?(r({nodes:[],edges:[w]}),null==(n=I.current)||n.blur()):o([t])),a&&a(e,w)},onDoubleClick:F,onContextMenu:H,onMouseEnter:U,onMouseMove:Y,onMouseLeave:K,onKeyDown:E?e=>{var n;if(!_&&ny.includes(e.key)&&N){const{unselectNodesAndEdges:o,addSelectedEdges:r}=M.getState();"Escape"===e.key?(null==(n=I.current)||n.blur(),o({edges:[w]})):r([t])}}:void 0,tabIndex:E?0:void 0,role:w.ariaRole??(E?"group":"img"),"aria-roledescription":"edge","data-id":t,"data-testid":`rf__edge-${t}`,"aria-label":null===w.ariaLabel?void 0:w.ariaLabel||`Edge from ${w.source} to ${w.target}`,"aria-describedby":E?`${Ob}-${g}`:void 0,ref:I,...w.domAttributes,children:[!P&&e.jsx(S,{id:t,source:w.source,target:w.target,type:w.type,selected:w.selected,animated:w.animated,selectable:N,deletable:w.deletable??!0,label:w.label,labelStyle:w.labelStyle,labelShowBg:w.labelShowBg,labelBgStyle:w.labelBgStyle,labelBgPadding:w.labelBgPadding,labelBgBorderRadius:w.labelBgBorderRadius,sourceX:$,sourceY:R,targetX:Z,targetY:j,sourcePosition:D,targetPosition:L,data:w.data,style:w.style,sourceHandleId:w.sourceHandle,targetHandleId:w.targetHandle,markerStart:V,markerEnd:B,pathOptions:"pathOptions"in w?w.pathOptions:void 0,interactionWidth:w.interactionWidth}),C&&e.jsx(kw,{edge:w,isReconnectable:C,reconnectRadius:p,onReconnect:h,onReconnectStart:f,onReconnectEnd:m,sourceX:$,sourceY:R,targetX:Z,targetY:j,sourcePosition:D,targetPosition:L,setUpdateHover:A,setReconnecting:T})]})})}const Ew=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function Cw({defaultMarkerColor:t,onlyRenderVisibleElements:n,rfId:o,edgeTypes:i,noPanClassName:a,onReconnect:s,onEdgeContextMenu:l,onEdgeMouseEnter:u,onEdgeMouseMove:c,onEdgeMouseLeave:d,onEdgeClick:p,reconnectRadius:h,onEdgeDoubleClick:f,onReconnectStart:m,onReconnectEnd:g,disableKeyboardA11y:y}){const{edgesFocusable:v,edgesReconnectable:b,elementsSelectable:_,onError:w}=Sb(Ew,_b),x=(k=n,Sb(r.useCallback(e=>{if(!k)return e.edges.map(e=>e.id);const t=[];if(e.width&&e.height)for(const n of e.edges){const o=e.nodeLookup.get(n.source),r=e.nodeLookup.get(n.target);o&&r&&hv({sourceNode:o,targetNode:r,width:e.width,height:e.height,transform:e.transform})&&t.push(n.id)}return t},[k]),_b));var k;return e.jsxs("div",{className:"react-flow__edges",children:[e.jsx(q_,{defaultColor:t,rfId:o}),x.map(t=>e.jsx(Sw,{id:t,edgesFocusable:v,edgesReconnectable:b,elementsSelectable:_,noPanClassName:a,onReconnect:s,onContextMenu:l,onMouseEnter:u,onMouseMove:c,onMouseLeave:d,onClick:p,reconnectRadius:h,onDoubleClick:f,onReconnectStart:m,onReconnectEnd:g,rfId:o,onError:w,edgeTypes:i,disableKeyboardA11y:y},t))]})}Cw.displayName="EdgeRenderer";const Nw=r.memo(Cw),Iw=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function Ow({children:t}){const n=Sb(Iw);return e.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:n},children:t})}const Aw=e=>{var t;return null==(t=e.panZoom)?void 0:t.syncViewport};function Pw(e){return e.connection.inProgress?{...e.connection,to:Fy(e.connection.to,e.transform)}:{...e.connection}}function Tw(e){return Sb(Pw,_b)}const Mw=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function zw({containerStyle:t,style:n,type:o,component:r}){const{nodesConnectable:i,width:a,height:s,isValid:l,inProgress:u}=Sb(Mw,_b);return!!(a&&i&&u)?e.jsx("svg",{style:t,width:a,height:s,className:"react-flow__connectionline react-flow__container",children:e.jsx("g",{className:eh(["react-flow__connection",vy(l)]),children:e.jsx($w,{style:n,type:o,CustomComponent:r,isValid:l})})}):null}const $w=({style:t,type:n=dy.Bezier,CustomComponent:o,isValid:r})=>{const{inProgress:i,from:a,fromNode:s,fromHandle:l,fromPosition:u,to:c,toNode:d,toHandle:p,toPosition:h}=Tw();if(!i)return;if(o)return e.jsx(o,{connectionLineType:n,connectionLineStyle:t,fromNode:s,fromHandle:l,fromX:a.x,fromY:a.y,toX:c.x,toY:c.y,fromPosition:u,toPosition:h,connectionStatus:vy(r),toNode:d,toHandle:p});let f="";const m={sourceX:a.x,sourceY:a.y,sourcePosition:u,targetX:c.x,targetY:c.y,targetPosition:h};switch(n){case dy.Bezier:[f]=dv(m);break;case dy.SimpleBezier:[f]=tw(m);break;case dy.Step:[f]=_v({...m,borderRadius:0});break;case dy.SmoothStep:[f]=_v(m);break;default:[f]=gv(m)}return e.jsx("path",{d:f,fill:"none",className:"react-flow__connection-path",style:t})};$w.displayName="ConnectionLine";const Rw={};function Zw(e=Rw){r.useRef(e),Eb(),r.useEffect(()=>{},[e])}function jw({nodeTypes:t,edgeTypes:n,onInit:o,onNodeClick:i,onEdgeClick:a,onNodeDoubleClick:s,onEdgeDoubleClick:l,onNodeMouseEnter:u,onNodeMouseMove:c,onNodeMouseLeave:d,onNodeContextMenu:p,onSelectionContextMenu:h,onSelectionStart:f,onSelectionEnd:m,connectionLineType:g,connectionLineStyle:y,connectionLineComponent:v,connectionLineContainerStyle:b,selectionKeyCode:_,selectionOnDrag:w,selectionMode:x,multiSelectionKeyCode:k,panActivationKeyCode:S,zoomActivationKeyCode:E,deleteKeyCode:C,onlyRenderVisibleElements:N,elementsSelectable:I,defaultViewport:O,translateExtent:A,minZoom:P,maxZoom:T,preventScrolling:M,defaultMarkerColor:z,zoomOnScroll:$,zoomOnPinch:R,panOnScroll:Z,panOnScrollSpeed:j,panOnScrollMode:D,zoomOnDoubleClick:L,panOnDrag:V,onPaneClick:B,onPaneMouseEnter:F,onPaneMouseMove:H,onPaneMouseLeave:U,onPaneScroll:Y,onPaneContextMenu:K,paneClickDistance:W,nodeClickDistance:X,onEdgeContextMenu:q,onEdgeMouseEnter:G,onEdgeMouseMove:J,onEdgeMouseLeave:Q,reconnectRadius:ee,onReconnect:te,onReconnectStart:ne,onReconnectEnd:oe,noDragClassName:re,noWheelClassName:ie,noPanClassName:ae,disableKeyboardA11y:se,nodeExtent:le,rfId:ue,viewport:ce,onViewportChange:de}){return Zw(t),Zw(n),Eb(),r.useRef(!1),r.useEffect(()=>{},[]),function(e){const t=f_(),n=r.useRef(!1);r.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}(o),function(e){const t=Sb(Aw),n=Eb();r.useEffect(()=>{e&&(null==t||t(e),n.setState({transform:[e.x,e.y,e.zoom]}))},[e,t])}(ce),e.jsx(L_,{onPaneClick:B,onPaneMouseEnter:F,onPaneMouseMove:H,onPaneMouseLeave:U,onPaneContextMenu:K,onPaneScroll:Y,paneClickDistance:W,deleteKeyCode:C,selectionKeyCode:_,selectionOnDrag:w,selectionMode:x,onSelectionStart:f,onSelectionEnd:m,multiSelectionKeyCode:k,panActivationKeyCode:S,zoomActivationKeyCode:E,elementsSelectable:I,zoomOnScroll:$,zoomOnPinch:R,zoomOnDoubleClick:L,panOnScroll:Z,panOnScrollSpeed:j,panOnScrollMode:D,panOnDrag:V,defaultViewport:O,translateExtent:A,minZoom:P,maxZoom:T,onSelectionContextMenu:h,preventScrolling:M,noDragClassName:re,noWheelClassName:ie,noPanClassName:ae,disableKeyboardA11y:se,onViewportChange:de,isControlledViewport:!!ce,children:e.jsxs(Ow,{children:[e.jsx(Nw,{edgeTypes:n,onEdgeClick:a,onEdgeDoubleClick:l,onReconnect:te,onReconnectStart:ne,onReconnectEnd:oe,onlyRenderVisibleElements:N,onEdgeContextMenu:q,onEdgeMouseEnter:G,onEdgeMouseMove:J,onEdgeMouseLeave:Q,reconnectRadius:ee,defaultMarkerColor:z,noPanClassName:ae,disableKeyboardA11y:se,rfId:ue}),e.jsx(zw,{style:y,type:g,component:v,containerStyle:b}),e.jsx("div",{className:"react-flow__edgelabel-renderer"}),e.jsx(Y_,{nodeTypes:t,onNodeClick:i,onNodeDoubleClick:s,onNodeMouseEnter:u,onNodeMouseMove:c,onNodeMouseLeave:d,onNodeContextMenu:p,nodeClickDistance:X,onlyRenderVisibleElements:N,noPanClassName:ae,noDragClassName:re,disableKeyboardA11y:se,nodeExtent:le,rfId:ue}),e.jsx("div",{className:"react-flow__viewport-portal"})]})})}jw.displayName="GraphView";const Dw=r.memo(jw),Lw=({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:r,height:i,fitView:a,fitViewOptions:s,minZoom:l=.5,maxZoom:u=2,nodeOrigin:c,nodeExtent:d}={})=>{const p=new Map,h=new Map,f=new Map,m=new Map,g=o??t??[],y=n??e??[],v=c??[0,0],b=d??ty;zv(f,m,g);const _=Ov(y,p,h,{nodeOrigin:v,nodeExtent:b,elevateNodesOnSelect:!1});let w=[0,0,1];if(a&&r&&i){const e=xy(p,{filter:e=>!(!e.width&&!e.initialWidth||!e.height&&!e.initialHeight)}),{x:t,y:n,zoom:o}=Yy(e,r,i,l,u,(null==s?void 0:s.padding)??.1);w=[t,n,o]}return{rfId:"1",width:0,height:0,transform:w,nodes:y,nodesInitialized:_,nodeLookup:p,parentLookup:h,edges:g,edgeLookup:m,connectionLookup:f,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:void 0!==n,hasDefaultEdges:void 0!==o,panZoom:null,minZoom:l,maxZoom:u,translateExtent:ty,nodeExtent:b,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:ry.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:v,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:a??!1,fitViewOptions:s,fitViewResolver:null,connection:{...cy},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:Vy,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:oy}},Vw=({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:r,height:i,fitView:a,fitViewOptions:s,minZoom:l,maxZoom:u,nodeOrigin:c,nodeExtent:d})=>{return p=(p,h)=>{async function f(){const{nodeLookup:e,panZoom:t,fitViewOptions:n,fitViewResolver:o,width:r,height:i,minZoom:a,maxZoom:s}=h();t&&(await Sy({nodes:e,width:r,height:i,panZoom:t,minZoom:a,maxZoom:s},n),null==o||o.resolve(!0),p({fitViewResolver:null}))}return{...Lw({nodes:e,edges:t,width:r,height:i,fitView:a,fitViewOptions:s,minZoom:l,maxZoom:u,nodeOrigin:c,nodeExtent:d,defaultNodes:n,defaultEdges:o}),setNodes:e=>{const{nodeLookup:t,parentLookup:n,nodeOrigin:o,elevateNodesOnSelect:r,fitViewQueued:i}=h(),a=Ov(e,t,n,{nodeOrigin:o,nodeExtent:d,elevateNodesOnSelect:r,checkEquality:!0});i&&a?(f(),p({nodes:e,nodesInitialized:a,fitViewQueued:!1,fitViewOptions:void 0})):p({nodes:e,nodesInitialized:a})},setEdges:e=>{const{connectionLookup:t,edgeLookup:n}=h();zv(t,n,e),p({edges:e})},setDefaultNodesAndEdges:(e,t)=>{if(e){const{setNodes:t}=h();t(e),p({hasDefaultNodes:!0})}if(t){const{setEdges:e}=h();e(t),p({hasDefaultEdges:!0})}},updateNodeInternals:e=>{const{triggerNodeChanges:t,nodeLookup:n,parentLookup:o,domNode:r,nodeOrigin:i,nodeExtent:a,debug:s,fitViewQueued:l}=h(),{changes:u,updatedInternals:c}=function(e,t,n,o,r,i){const a=null==o?void 0:o.querySelector(".xyflow__viewport");let s=!1;if(!a)return{changes:[],updatedInternals:s};const l=[],u=window.getComputedStyle(a),{m22:c}=new window.DOMMatrixReadOnly(u.transform),d=[];for(const p of e.values()){const e=t.get(p.id);if(!e)continue;if(e.hidden){t.set(e.id,{...e,internals:{...e.internals,handleBounds:void 0}}),s=!0;continue}const o=tv(p.nodeElement),a=e.measured.width!==o.width||e.measured.height!==o.height;if(o.width&&o.height&&(a||!e.internals.handleBounds||p.force)){const u=p.nodeElement.getBoundingClientRect(),h=Wy(e.extent)?e.extent:i;let{positionAbsolute:f}=e.internals;e.parentId&&"parent"===e.extent?f=Oy(f,o,t.get(e.parentId)):h&&(f=Iy(f,h,o));const m={...e,measured:o,internals:{...e.internals,positionAbsolute:f,handleBounds:{source:sv("source",p.nodeElement,u,c,e.id),target:sv("target",p.nodeElement,u,c,e.id)}}};t.set(e.id,m),e.parentId&&Av(m,t,n,{nodeOrigin:r}),s=!0,a&&(l.push({id:e.id,type:"dimensions",dimensions:o}),e.expandParent&&e.parentId&&d.push({id:e.id,parentId:e.parentId,rect:$y(m,r)}))}}if(d.length>0){const e=Tv(d,t,n,r);l.push(...e)}return{changes:l,updatedInternals:s}}(e,n,o,r,i,a);c&&(function(e,t,n){const o=Iv(Cv,n);for(const r of e.values())if(r.parentId)Av(r,e,t,o);else{const e=wy(r,o.nodeOrigin),t=Wy(r.extent)?r.extent:o.nodeExtent,n=Iy(e,t,Xy(r));r.internals.positionAbsolute=n}}(n,o,{nodeOrigin:i,nodeExtent:a}),l?(f(),p({fitViewQueued:!1,fitViewOptions:void 0})):p({}),(null==u?void 0:u.length)>0&&(null==t||t(u)))},updateNodePositions:(e,t=!1)=>{const n=[],o=[],{nodeLookup:r,triggerNodeChanges:i}=h();for(const[a,s]of e){const e=r.get(a),i=!!((null==e?void 0:e.expandParent)&&(null==e?void 0:e.parentId)&&(null==s?void 0:s.position)),l={id:a,type:"position",position:i?{x:Math.max(0,s.position.x),y:Math.max(0,s.position.y)}:s.position,dragging:t};i&&e.parentId&&n.push({id:a,parentId:e.parentId,rect:{...s.internals.positionAbsolute,width:s.measured.width??0,height:s.measured.height??0}}),o.push(l)}if(n.length>0){const{parentLookup:e,nodeOrigin:t}=h(),i=Tv(n,r,e,t);o.push(...i)}i(o)},triggerNodeChanges:e=>{const{onNodesChange:t,setNodes:n,nodes:o,hasDefaultNodes:r,debug:i}=h();(null==e?void 0:e.length)&&(r&&n(t_(e,o)),null==t||t(e))},triggerEdgeChanges:e=>{const{onEdgesChange:t,setEdges:n,edges:o,hasDefaultEdges:r,debug:i}=h();(null==e?void 0:e.length)&&(r&&n(n_(e,o)),null==t||t(e))},addSelectedNodes:e=>{const{multiSelectionActive:t,edgeLookup:n,nodeLookup:o,triggerNodeChanges:r,triggerEdgeChanges:i}=h();t?r(e.map(e=>o_(e,!0))):(r(r_(o,new Set([...e]),!0)),i(r_(n)))},addSelectedEdges:e=>{const{multiSelectionActive:t,edgeLookup:n,nodeLookup:o,triggerNodeChanges:r,triggerEdgeChanges:i}=h();t?i(e.map(e=>o_(e,!0))):(i(r_(n,new Set([...e]))),r(r_(o,new Set,!0)))},unselectNodesAndEdges:({nodes:e,edges:t}={})=>{const{edges:n,nodes:o,nodeLookup:r,triggerNodeChanges:i,triggerEdgeChanges:a}=h(),s=t||n,l=(e||o).map(e=>{const t=r.get(e.id);return t&&(t.selected=!1),o_(e.id,!1)}),u=s.map(e=>o_(e.id,!1));i(l),a(u)},setMinZoom:e=>{const{panZoom:t,maxZoom:n}=h();null==t||t.setScaleExtent([e,n]),p({minZoom:e})},setMaxZoom:e=>{const{panZoom:t,minZoom:n}=h();null==t||t.setScaleExtent([n,e]),p({maxZoom:e})},setTranslateExtent:e=>{var t;null==(t=h().panZoom)||t.setTranslateExtent(e),p({translateExtent:e})},setPaneClickDistance:e=>{var t;null==(t=h().panZoom)||t.setClickDistance(e)},resetSelectedElements:()=>{const{edges:e,nodes:t,triggerNodeChanges:n,triggerEdgeChanges:o,elementsSelectable:r}=h();if(!r)return;const i=t.reduce((e,t)=>t.selected?[...e,o_(t.id,!1)]:e,[]),a=e.reduce((e,t)=>t.selected?[...e,o_(t.id,!1)]:e,[]);n(i),o(a)},setNodeExtent:e=>{const{nodes:t,nodeLookup:n,parentLookup:o,nodeOrigin:r,elevateNodesOnSelect:i,nodeExtent:a}=h();e[0][0]===a[0][0]&&e[0][1]===a[0][1]&&e[1][0]===a[1][0]&&e[1][1]===a[1][1]||(Ov(t,n,o,{nodeOrigin:r,nodeExtent:e,elevateNodesOnSelect:i,checkEquality:!1}),p({nodeExtent:e}))},panBy:e=>{const{transform:t,width:n,height:o,panZoom:r,translateExtent:i}=h();return async function({delta:e,panZoom:t,transform:n,translateExtent:o,width:r,height:i}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const a=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[r,i]],o),s=!!a&&(a.x!==n[0]||a.y!==n[1]||a.k!==n[2]);return Promise.resolve(s)}({delta:e,panZoom:r,transform:t,translateExtent:i,width:n,height:o})},setCenter:async(e,t,n)=>{const{width:o,height:r,maxZoom:i,panZoom:a}=h();if(!a)return Promise.resolve(!1);const s=void 0!==(null==n?void 0:n.zoom)?n.zoom:i;return await a.setViewport({x:o/2-e*s,y:r/2-t*s,zoom:s},{duration:null==n?void 0:n.duration,ease:null==n?void 0:n.ease,interpolate:null==n?void 0:n.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{p({connection:{...cy}})},updateConnection:e=>{p({connection:e})},reset:()=>p({...Lw()})}},h=Object.is,p?bb(p,h):bb;var p,h};function Bw({initialNodes:t,initialEdges:n,defaultNodes:o,defaultEdges:i,initialWidth:a,initialHeight:s,initialMinZoom:l,initialMaxZoom:u,initialFitViewOptions:c,fitView:d,nodeOrigin:p,nodeExtent:h,children:f}){const[m]=r.useState(()=>Vw({nodes:t,edges:n,defaultNodes:o,defaultEdges:i,width:a,height:s,fitView:d,minZoom:l,maxZoom:u,fitViewOptions:c,nodeOrigin:p,nodeExtent:h}));return e.jsx(xb,{value:m,children:e.jsx(p_,{children:f})})}function Fw({children:t,nodes:n,edges:o,defaultNodes:i,defaultEdges:a,width:s,height:l,fitView:u,fitViewOptions:c,minZoom:d,maxZoom:p,nodeOrigin:h,nodeExtent:f}){return r.useContext(wb)?e.jsx(e.Fragment,{children:t}):e.jsx(Bw,{initialNodes:n,initialEdges:o,defaultNodes:i,defaultEdges:a,initialWidth:s,initialHeight:l,fitView:u,initialFitViewOptions:c,initialMinZoom:d,initialMaxZoom:p,nodeOrigin:h,nodeExtent:f,children:t})}const Hw={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};var Uw,Yw,Kw=l_(function({nodes:t,edges:n,defaultNodes:o,defaultEdges:i,className:a,nodeTypes:s,edgeTypes:l,onNodeClick:u,onEdgeClick:c,onInit:d,onMove:p,onMoveStart:h,onMoveEnd:f,onConnect:m,onConnectStart:g,onConnectEnd:y,onClickConnectStart:v,onClickConnectEnd:b,onNodeMouseEnter:_,onNodeMouseMove:w,onNodeMouseLeave:x,onNodeContextMenu:k,onNodeDoubleClick:S,onNodeDragStart:E,onNodeDrag:C,onNodeDragStop:N,onNodesDelete:I,onEdgesDelete:O,onDelete:A,onSelectionChange:P,onSelectionDragStart:T,onSelectionDrag:M,onSelectionDragStop:z,onSelectionContextMenu:$,onSelectionStart:R,onSelectionEnd:Z,onBeforeDelete:j,connectionMode:D,connectionLineType:L=dy.Bezier,connectionLineStyle:V,connectionLineComponent:B,connectionLineContainerStyle:F,deleteKeyCode:H="Backspace",selectionKeyCode:U="Shift",selectionOnDrag:Y=!1,selectionMode:K=ly.Full,panActivationKeyCode:W="Space",multiSelectionKeyCode:X=(Ky()?"Meta":"Control"),zoomActivationKeyCode:q=(Ky()?"Meta":"Control"),snapToGrid:G,snapGrid:J,onlyRenderVisibleElements:Q=!1,selectNodesOnDrag:ee,nodesDraggable:te,autoPanOnNodeFocus:ne,nodesConnectable:oe,nodesFocusable:re,nodeOrigin:ie=Bb,edgesFocusable:ae,edgesReconnectable:se,elementsSelectable:le=!0,defaultViewport:ue=Fb,minZoom:ce=.5,maxZoom:de=2,translateExtent:pe=ty,preventScrolling:he=!0,nodeExtent:fe,defaultMarkerColor:me="#b1b1b7",zoomOnScroll:ge=!0,zoomOnPinch:ye=!0,panOnScroll:ve=!1,panOnScrollSpeed:be=.5,panOnScrollMode:_e=ay.Free,zoomOnDoubleClick:we=!0,panOnDrag:xe=!0,onPaneClick:ke,onPaneMouseEnter:Se,onPaneMouseMove:Ee,onPaneMouseLeave:Ce,onPaneScroll:Ne,onPaneContextMenu:Ie,paneClickDistance:Oe=0,nodeClickDistance:Ae=0,children:Pe,onReconnect:Te,onReconnectStart:Me,onReconnectEnd:ze,onEdgeContextMenu:$e,onEdgeDoubleClick:Re,onEdgeMouseEnter:Ze,onEdgeMouseMove:je,onEdgeMouseLeave:De,reconnectRadius:Le=10,onNodesChange:Ve,onEdgesChange:Be,noDragClassName:Fe="nodrag",noWheelClassName:He="nowheel",noPanClassName:Ue="nopan",fitView:Ye,fitViewOptions:Ke,connectOnClick:We,attributionPosition:Xe,proOptions:qe,defaultEdgeOptions:Ge,elevateNodesOnSelect:Je,elevateEdgesOnSelect:Qe,disableKeyboardA11y:et=!1,autoPanOnConnect:tt,autoPanOnNodeDrag:nt,autoPanSpeed:ot,connectionRadius:rt,isValidConnection:it,onError:at,style:st,id:lt,nodeDragThreshold:ut,connectionDragThreshold:ct,viewport:dt,onViewportChange:pt,width:ht,height:ft,colorMode:mt="light",debug:gt,onScroll:yt,ariaLabelConfig:vt,...bt},_t){const wt=lt||"1",xt=function(e){var t;const[n,o]=r.useState("system"===e?null:e);return r.useEffect(()=>{if("system"!==e)return void o(e);const t=Wb(),n=()=>o((null==t?void 0:t.matches)?"dark":"light");return n(),null==t||t.addEventListener("change",n),()=>{null==t||t.removeEventListener("change",n)}},[e]),null!==n?n:(null==(t=Wb())?void 0:t.matches)?"dark":"light"}(mt),kt=r.useCallback(e=>{e.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),null==yt||yt(e)},[yt]);return e.jsx("div",{"data-testid":"rf__wrapper",...bt,onScroll:kt,style:{...st,...Hw},ref:_t,className:eh(["react-flow",a,xt]),id:lt,role:"application",children:e.jsxs(Fw,{nodes:t,edges:n,width:ht,height:ft,fitView:Ye,fitViewOptions:Ke,minZoom:ce,maxZoom:de,nodeOrigin:ie,nodeExtent:fe,children:[e.jsx(Dw,{onInit:d,onNodeClick:u,onEdgeClick:c,onNodeMouseEnter:_,onNodeMouseMove:w,onNodeMouseLeave:x,onNodeContextMenu:k,onNodeDoubleClick:S,nodeTypes:s,edgeTypes:l,connectionLineType:L,connectionLineStyle:V,connectionLineComponent:B,connectionLineContainerStyle:F,selectionKeyCode:U,selectionOnDrag:Y,selectionMode:K,deleteKeyCode:H,multiSelectionKeyCode:X,panActivationKeyCode:W,zoomActivationKeyCode:q,onlyRenderVisibleElements:Q,defaultViewport:ue,translateExtent:pe,minZoom:ce,maxZoom:de,preventScrolling:he,zoomOnScroll:ge,zoomOnPinch:ye,zoomOnDoubleClick:we,panOnScroll:ve,panOnScrollSpeed:be,panOnScrollMode:_e,panOnDrag:xe,onPaneClick:ke,onPaneMouseEnter:Se,onPaneMouseMove:Ee,onPaneMouseLeave:Ce,onPaneScroll:Ne,onPaneContextMenu:Ie,paneClickDistance:Oe,nodeClickDistance:Ae,onSelectionContextMenu:$,onSelectionStart:R,onSelectionEnd:Z,onReconnect:Te,onReconnectStart:Me,onReconnectEnd:ze,onEdgeContextMenu:$e,onEdgeDoubleClick:Re,onEdgeMouseEnter:Ze,onEdgeMouseMove:je,onEdgeMouseLeave:De,reconnectRadius:Le,defaultMarkerColor:me,noDragClassName:Fe,noWheelClassName:He,noPanClassName:Ue,rfId:wt,disableKeyboardA11y:et,nodeExtent:fe,viewport:dt,onViewportChange:pt}),e.jsx(Kb,{nodes:t,edges:n,defaultNodes:o,defaultEdges:i,onConnect:m,onConnectStart:g,onConnectEnd:y,onClickConnectStart:v,onClickConnectEnd:b,nodesDraggable:te,autoPanOnNodeFocus:ne,nodesConnectable:oe,nodesFocusable:re,edgesFocusable:ae,edgesReconnectable:se,elementsSelectable:le,elevateNodesOnSelect:Je,elevateEdgesOnSelect:Qe,minZoom:ce,maxZoom:de,nodeExtent:fe,onNodesChange:Ve,onEdgesChange:Be,snapToGrid:G,snapGrid:J,connectionMode:D,translateExtent:pe,connectOnClick:We,defaultEdgeOptions:Ge,fitView:Ye,fitViewOptions:Ke,onNodesDelete:I,onEdgesDelete:O,onDelete:A,onNodeDragStart:E,onNodeDrag:C,onNodeDragStop:N,onSelectionDrag:M,onSelectionDragStart:T,onSelectionDragStop:z,onMove:p,onMoveStart:h,onMoveEnd:f,noPanClassName:Ue,nodeOrigin:ie,rfId:wt,autoPanOnConnect:tt,autoPanOnNodeDrag:nt,autoPanSpeed:ot,onError:at,connectionRadius:rt,isValidConnection:it,selectNodesOnDrag:ee,nodeDragThreshold:ut,connectionDragThreshold:ct,onBeforeDelete:j,paneClickDistance:Oe,debug:gt,ariaLabelConfig:vt}),e.jsx(Vb,{onSelectionChange:P}),Pe,e.jsx($b,{proOptions:qe,position:Xe}),e.jsx(Mb,{rfId:wt,disableKeyboardA11y:et})]})})});function Ww(e){const[t,n]=r.useState(e),o=r.useCallback(e=>n(t=>t_(e,t)),[]);return[t,n,o]}function Xw(e){const[t,n]=r.useState(e),o=r.useCallback(e=>n(t=>n_(e,t)),[]);return[t,n,o]}function qw({dimensions:t,lineWidth:n,variant:o,className:r}){return e.jsx("path",{strokeWidth:n,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`,className:eh(["react-flow__background-pattern",o,r])})}function Gw({radius:t,className:n}){return e.jsx("circle",{cx:t,cy:t,r:t,className:eh(["react-flow__background-pattern","dots",n])})}(Yw=Uw||(Uw={})).Lines="lines",Yw.Dots="dots",Yw.Cross="cross";const Jw={[Uw.Dots]:1,[Uw.Lines]:1,[Uw.Cross]:6},Qw=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function ex({id:t,variant:n=Uw.Dots,gap:o=20,size:i,lineWidth:a=1,offset:s=0,color:l,bgColor:u,style:c,className:d,patternClassName:p}){const h=r.useRef(null),{transform:f,patternId:m}=Sb(Qw,_b),g=i||Jw[n],y=n===Uw.Dots,v=n===Uw.Cross,b=Array.isArray(o)?o:[o,o],_=[b[0]*f[2]||1,b[1]*f[2]||1],w=g*f[2],x=Array.isArray(s)?s:[s,s],k=v?[w,w]:_,S=[x[0]*f[2]||1+k[0]/2,x[1]*f[2]||1+k[1]/2],E=`${m}${t||""}`;return e.jsxs("svg",{className:eh(["react-flow__background",d]),style:{...c,...y_,"--xy-background-color-props":u,"--xy-background-pattern-color-props":l},ref:h,"data-testid":"rf__background",children:[e.jsx("pattern",{id:E,x:f[0]%_[0],y:f[1]%_[1],width:_[0],height:_[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${S[0]},-${S[1]})`,children:y?e.jsx(Gw,{radius:w/2,className:p}):e.jsx(qw,{dimensions:k,lineWidth:a,variant:n,className:p})}),e.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${E})`})]})}ex.displayName="Background";const tx=r.memo(ex);function nx(){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:e.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function ox(){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:e.jsx("path",{d:"M0 0h32v4.2H0z"})})}function rx(){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:e.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function ix(){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:e.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function ax(){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:e.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function sx({children:t,className:n,...o}){return e.jsx("button",{type:"button",className:eh(["react-flow__controls-button",n]),...o,children:t})}const lx=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function ux({style:t,showZoom:n=!0,showFitView:o=!0,showInteractive:r=!0,fitViewOptions:i,onZoomIn:a,onZoomOut:s,onFitView:l,onInteractiveChange:u,className:c,children:d,position:p="bottom-left",orientation:h="vertical","aria-label":f}){const m=Eb(),{isInteractive:g,minZoomReached:y,maxZoomReached:v,ariaLabelConfig:b}=Sb(lx,_b),{zoomIn:_,zoomOut:w,fitView:x}=f_(),k="horizontal"===h?"horizontal":"vertical";return e.jsxs(zb,{className:eh(["react-flow__controls",k,c]),position:p,style:t,"data-testid":"rf__controls","aria-label":f??b["controls.ariaLabel"],children:[n&&e.jsxs(e.Fragment,{children:[e.jsx(sx,{onClick:()=>{_(),null==a||a()},className:"react-flow__controls-zoomin",title:b["controls.zoomIn.ariaLabel"],"aria-label":b["controls.zoomIn.ariaLabel"],disabled:v,children:e.jsx(nx,{})}),e.jsx(sx,{onClick:()=>{w(),null==s||s()},className:"react-flow__controls-zoomout",title:b["controls.zoomOut.ariaLabel"],"aria-label":b["controls.zoomOut.ariaLabel"],disabled:y,children:e.jsx(ox,{})})]}),o&&e.jsx(sx,{className:"react-flow__controls-fitview",onClick:()=>{x(i),null==l||l()},title:b["controls.fitView.ariaLabel"],"aria-label":b["controls.fitView.ariaLabel"],children:e.jsx(rx,{})}),r&&e.jsx(sx,{className:"react-flow__controls-interactive",onClick:()=>{m.setState({nodesDraggable:!g,nodesConnectable:!g,elementsSelectable:!g}),null==u||u(!g)},title:b["controls.interactive.ariaLabel"],"aria-label":b["controls.interactive.ariaLabel"],children:g?e.jsx(ax,{}):e.jsx(ix,{})}),d]})}ux.displayName="Controls";const cx=r.memo(ux);const dx=r.memo(function({id:t,x:n,y:o,width:r,height:i,style:a,color:s,strokeColor:l,strokeWidth:u,className:c,borderRadius:d,shapeRendering:p,selected:h,onClick:f}){const{background:m,backgroundColor:g}=a||{},y=s||m||g;return e.jsx("rect",{className:eh(["react-flow__minimap-node",{selected:h},c]),x:n,y:o,rx:d,ry:d,width:r,height:i,style:{fill:y,stroke:l,strokeWidth:u},shapeRendering:p,onClick:f?e=>f(e,t):void 0})}),px=e=>e.nodes.map(e=>e.id),hx=e=>e instanceof Function?e:()=>e;const fx=r.memo(function({id:t,nodeColorFunc:n,nodeStrokeColorFunc:o,nodeClassNameFunc:r,nodeBorderRadius:i,nodeStrokeWidth:a,shapeRendering:s,NodeComponent:l,onClick:u}){const{node:c,x:d,y:p,width:h,height:f}=Sb(e=>{const{internals:n}=e.nodeLookup.get(t),o=n.userNode,{x:r,y:i}=n.positionAbsolute,{width:a,height:s}=Xy(o);return{node:o,x:r,y:i,width:a,height:s}},_b);return c&&!c.hidden&&qy(c)?e.jsx(l,{x:d,y:p,width:h,height:f,style:c.style,selected:!!c.selected,className:r(c),color:n(c),borderRadius:i,strokeColor:o(c),strokeWidth:a,shapeRendering:s,onClick:u,id:c.id}):null});var mx=r.memo(function({nodeStrokeColor:t,nodeColor:n,nodeClassName:o="",nodeBorderRadius:r=5,nodeStrokeWidth:i,nodeComponent:a=dx,onClick:s}){const l=Sb(px,_b),u=hx(n),c=hx(t),d=hx(o),p="undefined"==typeof window||window.chrome?"crispEdges":"geometricPrecision";return e.jsx(e.Fragment,{children:l.map(t=>e.jsx(fx,{id:t,nodeColorFunc:u,nodeStrokeColorFunc:c,nodeClassNameFunc:d,nodeBorderRadius:r,nodeStrokeWidth:i,NodeComponent:a,onClick:s,shapeRendering:p},t))})});const gx=e=>!e.hidden,yx=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?Zy(xy(e.nodeLookup,{filter:gx}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}};function vx({style:t,className:n,nodeStrokeColor:o,nodeColor:i,nodeClassName:a="",nodeBorderRadius:s=5,nodeStrokeWidth:l,nodeComponent:u,bgColor:c,maskColor:d,maskStrokeColor:p,maskStrokeWidth:h,position:f="bottom-right",onClick:m,onNodeClick:g,pannable:y=!1,zoomable:v=!1,ariaLabel:b,inversePan:_,zoomStep:w=10,offsetScale:x=5}){const k=Eb(),S=r.useRef(null),{boundingRect:E,viewBB:C,rfId:N,panZoom:I,translateExtent:O,flowWidth:A,flowHeight:P,ariaLabelConfig:T}=Sb(yx,_b),M=(null==t?void 0:t.width)??200,z=(null==t?void 0:t.height)??150,$=E.width/M,R=E.height/z,Z=Math.max($,R),j=Z*M,D=Z*z,L=x*Z,V=E.x-(j-E.width)/2-L,B=E.y-(D-E.height)/2-L,F=j+2*L,H=D+2*L,U=`react-flow__minimap-desc-${N}`,Y=r.useRef(0),K=r.useRef();Y.current=Z,r.useEffect(()=>{if(S.current&&I)return K.current=function({domNode:e,panZoom:t,getTransform:n,getViewScale:o}){const r=bf(e);return{update:function({translateExtent:e,width:i,height:a,zoomStep:s=10,pannable:l=!0,zoomable:u=!0,inversePan:c=!1}){let d=[0,0];const p=Hg().on("start",e=>{"mousedown"!==e.sourceEvent.type&&"touchstart"!==e.sourceEvent.type||(d=[e.sourceEvent.clientX??e.sourceEvent.touches[0].clientX,e.sourceEvent.clientY??e.sourceEvent.touches[0].clientY])}).on("zoom",l?r=>{const s=n();if("mousemove"!==r.sourceEvent.type&&"touchmove"!==r.sourceEvent.type||!t)return;const l=[r.sourceEvent.clientX??r.sourceEvent.touches[0].clientX,r.sourceEvent.clientY??r.sourceEvent.touches[0].clientY],u=[l[0]-d[0],l[1]-d[1]];d=l;const p=o()*Math.max(s[2],Math.log(s[2]))*(c?-1:1),h={x:s[0]-u[0]*p,y:s[1]-u[1]*p},f=[[0,0],[i,a]];t.setViewportConstrained({x:h.x,y:h.y,zoom:s[2]},f,e)}:null).on("zoom.wheel",u?e=>{const o=n();if("wheel"!==e.sourceEvent.type||!t)return;const r=-e.sourceEvent.deltaY*(1===e.sourceEvent.deltaMode?.05:e.sourceEvent.deltaMode?1:.002)*s,i=o[2]*Math.pow(2,r);t.scaleTo(i)}:null);r.call(p,{})},destroy:function(){r.on("zoom",null)},pointer:_f}}({domNode:S.current,panZoom:I,getTransform:()=>k.getState().transform,getViewScale:()=>Y.current}),()=>{var e;null==(e=K.current)||e.destroy()}},[I]),r.useEffect(()=>{var e;null==(e=K.current)||e.update({translateExtent:O,width:A,height:P,inversePan:_,pannable:y,zoomStep:w,zoomable:v})},[y,v,_,w,O,A,P]);const W=m?e=>{var t;const[n,o]=(null==(t=K.current)?void 0:t.pointer(e))||[0,0];m(e,{x:n,y:o})}:void 0,X=g?r.useCallback((e,t)=>{const n=k.getState().nodeLookup.get(t).internals.userNode;g(e,n)},[]):void 0,q=b??T["minimap.ariaLabel"];return e.jsx(zb,{position:f,style:{...t,"--xy-minimap-background-color-props":"string"==typeof c?c:void 0,"--xy-minimap-mask-background-color-props":"string"==typeof d?d:void 0,"--xy-minimap-mask-stroke-color-props":"string"==typeof p?p:void 0,"--xy-minimap-mask-stroke-width-props":"number"==typeof h?h*Z:void 0,"--xy-minimap-node-background-color-props":"string"==typeof i?i:void 0,"--xy-minimap-node-stroke-color-props":"string"==typeof o?o:void 0,"--xy-minimap-node-stroke-width-props":"number"==typeof l?l:void 0},className:eh(["react-flow__minimap",n]),"data-testid":"rf__minimap",children:e.jsxs("svg",{width:M,height:z,viewBox:`${V} ${B} ${F} ${H}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":U,ref:S,onClick:W,children:[q&&e.jsx("title",{id:U,children:q}),e.jsx(mx,{onClick:X,nodeColor:i,nodeStrokeColor:o,nodeBorderRadius:s,nodeClassName:a,nodeStrokeWidth:l,nodeComponent:u}),e.jsx("path",{className:"react-flow__minimap-mask",d:`M${V-L},${B-L}h${F+2*L}v${H+2*L}h${-F-2*L}z\n        M${C.x},${C.y}h${C.width}v${C.height}h${-C.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}vx.displayName="MiniMap",r.memo(vx);const bx={[Qv.Line]:"right",[Qv.Handle]:"bottom-right"};r.memo(function({nodeId:t,position:n,variant:o=Qv.Handle,className:i,style:a,children:s,color:l,minWidth:u=10,minHeight:c=10,maxWidth:d=Number.MAX_VALUE,maxHeight:p=Number.MAX_VALUE,keepAspectRatio:h=!1,resizeDirection:f,autoScale:m=!0,shouldResize:g,onResizeStart:y,onResize:v,onResizeEnd:b}){const _=A_(),w="string"==typeof t?t:_,x=Eb(),k=r.useRef(null),S=o===Qv.Handle,E=Sb(r.useCallback((C=S&&m,e=>C?`${Math.max(1/e.transform[2],1)}`:void 0),[S,m]),_b);var C;const N=r.useRef(null),I=n??bx[o];r.useEffect(()=>{if(k.current&&w)return N.current||(N.current=lb({domNode:k.current,nodeId:w,getStoreItems:()=>{const{nodeLookup:e,transform:t,snapGrid:n,snapToGrid:o,nodeOrigin:r,domNode:i}=x.getState();return{nodeLookup:e,transform:t,snapGrid:n,snapToGrid:o,nodeOrigin:r,paneDomNode:i}},onChange:(e,t)=>{const{triggerNodeChanges:n,nodeLookup:o,parentLookup:r,nodeOrigin:i}=x.getState(),a=[],s={x:e.x,y:e.y},l=o.get(w);if(l&&l.expandParent&&l.parentId){const t=l.origin??i,n=e.width??l.measured.width??0,u=e.height??l.measured.height??0,c=Tv([{id:l.id,parentId:l.parentId,rect:{width:n,height:u,...Gy({x:e.x??l.position.x,y:e.y??l.position.y},{width:n,height:u},l.parentId,o,t)}}],o,r,i);a.push(...c),s.x=e.x?Math.max(t[0]*n,e.x):void 0,s.y=e.y?Math.max(t[1]*u,e.y):void 0}if(void 0!==s.x&&void 0!==s.y){const e={id:w,type:"position",position:{...s}};a.push(e)}if(void 0!==e.width&&void 0!==e.height){const t={id:w,type:"dimensions",resizing:!0,setAttributes:!f||("horizontal"===f?"width":"height"),dimensions:{width:e.width,height:e.height}};a.push(t)}for(const u of t){const e={...u,type:"position"};a.push(e)}n(a)},onEnd:({width:e,height:t})=>{const n={id:w,type:"dimensions",resizing:!1,dimensions:{width:e,height:t}};x.getState().triggerNodeChanges([n])}})),N.current.update({controlPosition:I,boundaries:{minWidth:u,minHeight:c,maxWidth:d,maxHeight:p},keepAspectRatio:h,resizeDirection:f,onResizeStart:y,onResize:v,onResizeEnd:b,shouldResize:g}),()=>{var e;null==(e=N.current)||e.destroy()}},[I,u,c,d,p,h,y,v,b,g]);const O=I.split("-");return e.jsx("div",{className:eh(["react-flow__resize-control","nodrag",...O,o,i]),ref:k,style:{...a,scale:E,...l&&{[S?"backgroundColor":"borderColor"]:l}},children:s})});export{Qe as A,Vs as B,sl as C,Ys as D,Qs as E,mt as F,Op as G,T_ as H,_t as I,Ww as J,Xw as K,f_ as L,mv as M,Kw as N,cx as O,my as P,tx as Q,Bw as R,Uw as S,Lt as T,qt as U,hy as V,ma as _,Us as a,ra as b,Js as c,bi as d,na as e,ca as f,ya as g,bs as h,ks as i,ul as j,Gs as k,As as l,Yi as m,Bi as n,je as o,Fs as p,qi as q,Fe as r,Ze as s,qs as t,la as u,Pa as v,cl as w,ha as x,za as y,Ws as z};
